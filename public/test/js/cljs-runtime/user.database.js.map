{"version":3,"sources":["user/database.cljs"],"mappings":"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","names":["user.database/mark-account-for-removal","uid","removal-date","tick.core/>>","tick.core.date","tick.core/new-period","path","G__413028","db.core/database-update","user.database/mark-account-for-restore","G__413030","user.database/lookup-userinfo","temp__5755__auto__","cljs.core/deref","_","re_frame.core.subscribe","G__413032","db.core/on-value-reaction","user.database/+memo-lookup-username","G__413036","user.database/lookup-username","temp__5757__auto__","G__413040","user.database/lookup-by-litteralkeyid","id","cljs.core.get","cljs.core.into","cljs.core.map","p__413048","vec__413049","cljs.core.nth","a","b","c","d","cljs.core.comp","cljs.core.juxt","p1__413043#","cljs.core.subs","cljs.core/str","cljs.core/val","cljs.core.filter","p__413052","vec__413053","k","v","and__5041__auto__","cljs.core/not","cljs.core/seq","G__413056","user.database/lookup-alias","u","G__413061","alias","cljs.core/empty?","navn","or__5043__auto__","user.database/lookup-phone","phone","G__413082","p__413078","vec__413079","p__413071","vec__413073","cljs.core._EQ_","cljs.core/first","cljs.core/second","user.database/request-booking-xf","p__413088","vec__413090","map__413093","cljs.core/--destructure-map","request-booking","user.database/not-yet-accepted-booking-xf","p__413094","vec__413095","map__413099","booking-godkjent","user.database/accepted-booking-xf","p__413104","vec__413107","map__413110","var_args","args__5772__auto__","len__5766__auto__","i__5767__auto__","argseq__5773__auto__","cljs.core/IndexedSeq","user.database/booking-users","seq413113","self__5752__auto__","xf","cljs.core.transduce","cljs.core.apply","cljs.core/comp","cljs.core/conj","G__413116","user.database/locked","field","icon-fn","path-fn","schpaa.style.button/round-normal-listitem","G__413119","G__413120","cljs.core/name","cljs.core/apply","schpaa.style.ornament/icon","G__413124","user.database/listitem","lambdaisland.ornament/styled","p__413148","vec__413149","map__413152","p1__413141#","p1__413142#","p1__413143#","p1__413144#","user.database/booking-users-listitem","ekspert","v\u00e5ttkort","telefon","v\u00e5ttkortnr","schpaa.style.ornament/row-std","re-frame.core/dispatch","booking.ico/showdetails","schpaa.style.ornament/text1","booking.ico/member","booking.ico/admin"],"sourcesContent":["(ns user.database\n  (:require [db.core :as db]\n            [tick.core :as t']\n            [schpaa.debug :as l]\n            [tick.core :as t]\n            [re-frame.core :as rf]\n            [clojure.walk :as walk]\n    ;extract!\n            [lambdaisland.ornament :as o]\n            [schpaa.style.ornament :as sc]\n            [booking.ico :as ico]\n            [schpaa.style.button :as scb]))\n\n(defn mark-account-for-removal [uid]\n  (let [removal-date (t/>> (t/date) (t/new-period 14 :days))\n        path [\"beskjeder\" uid]]\n    (db/database-update\n      {:path  path\n       :value {:removal-date (str removal-date)}})))\n\n(defn mark-account-for-restore [uid]\n  (let [removal-date (t/>> (t/date) (t/new-period 14 :days))\n        path [\"beskjeder\" uid]]\n    (db/database-update\n      {:path  path\n       :value {:removal-date nil}})))\n\n(comment\n  (let [values (-> data :values)\n        uid (-> values :uid)\n        values (dissoc values :uid)]\n    (db/firestore-set {:path [\"users2\" uid] :value values})\n    (db/database-update {:path [\"users\" uid] :value values})\n    (tap> values)\n    st))\n\n(defn lookup-userinfo [uid]\n  (if-some [_ @(rf/subscribe [::db/user-auth])]\n    @(db/on-value-reaction {:path [\"users\" uid]})\n    nil))\n\n(defn +memo-lookup-username [uid]\n\n  (if-some [_ @(rf/subscribe [::db/user-auth])]\n    (:navn @(db/on-value-reaction {:path [\"users\" uid]}))\n    nil))\n\n#_(def lookup-username (memoize +memo-lookup-username))\n(defn lookup-username [uid]\n  (when-some [_ @(rf/subscribe [::db/user-auth])]\n    (:navn @(db/on-value-reaction {:path [\"users\" uid]}))))\n\n(defn lookup-by-litteralkeyid [id]\n  (when-some [_ @(rf/subscribe [::db/user-auth])]\n    (get (into {}\n               (map (fn [[a b c d]] [a [b c d]])\n                    (map (comp (juxt (comp #(subs % 4 7) str :n\u00f8kkelnummer)\n                                     :navn\n                                     :telefon\n                                     :uid) val)\n                         (filter (fn [[k v]] (and (:godkjent v) (not (:utmeldt v)) (seq (:n\u00f8kkelnummer v)) #_(:n\u00f8kkelvakt v)))\n                                 @(db/on-value-reaction {:path [\"users\"]}))))) id)))\n\n(defn lookup-alias [uid]\n  (when-some [_ @(rf/subscribe [::db/user-auth])]\n    (let [u @(db/on-value-reaction {:path [\"users\" uid]})\n          alias (if (empty? (:alias u)) nil (:alias u))\n          navn (if (empty? (:navn u)) nil (:navn u))]\n\n      (or alias navn uid (str \"failed<lookup-alias>'\" uid \"'\")))))\n\n(defn lookup-phone [phone]\n  (if-some [_ @(rf/subscribe [::db/user-auth])]\n    (->> @(db/on-value-reaction {:path [\"users\"]})\n         (map (fn [[k v]] [(:telefon v) (:uid v)]))\n         (into {})\n         (filter (fn [[a b]] (= (str a) (str phone))))\n         first\n         second)\n    nil))\n\n(lookup-phone \"92491949\")\n\n(comment\n  (do\n    (->> @(db/on-value-reaction {:path [\"users\"]})\n         (map (fn [[k v]] [(:telefon v) (:navn v)]))\n         (into {})\n         (filter (fn [[a b]] (= (str a) (str \"92491949\")))))))\n\n\n\n;region\n\n(def request-booking-xf\n  (filter (fn [[_ {:keys [request-booking]}]] (some? request-booking))))\n\n(def not-yet-accepted-booking-xf\n  (filter (fn [[_ {:keys [booking-godkjent]}]] (true? booking-godkjent))))\n\n(def accepted-booking-xf\n  (filter (fn [[_ {:keys [booking-godkjent]}]] (false? booking-godkjent))))\n\n(defn booking-users [& xf]\n  (transduce\n    (apply comp xf)\n    conj\n    []\n    @(db/on-value-reaction {:path [\"users\"]})))\n\n(defn locked [field icon-fn path-fn k v]\n  [scb/round-normal-listitem\n   {:on-click #(db/database-update\n                 {:path  (path-fn (name k))\n                  :value {field (not (field v))}})}\n   [apply sc/icon (icon-fn (field v))]])\n\n(o/defstyled listitem :div\n  :flex :justify-between :p-1\n  {:padding-block  \"var(--size-2)\"\n   :padding-inline \"var(--size-3)\"\n   :border-radius  \"var(--radius-0)\"\n   :-background    [:rgba 0 0 0 0.05]})\n\n(defn booking-users-listitem [[k {:keys [navn ekspert v\u00e5ttkort booking-godkjent telefon v\u00e5ttkortnr] :as v}]]\n  [listitem\n   [sc/row-std {:style {:align-items :center}}\n    [scb/round-normal-listitem {:on-click #(rf/dispatch [:lab/show-userinfo v])} [sc/icon ico/showdetails]]\n    [sc/text1 navn]\n    [:div.grow]\n    [sc/text1 telefon]\n    [locked\n     :booking-godkjent\n     #(-> [{:style {:color (if % \"var(--button)\" :blue)}} (if % ico/member ico/member)])\n     #(-> [\"users\" %]) k v]\n    [locked\n     :ekspert\n     #(-> [{:style {:color (if % \"var(--button)\" :red)}} (if % ico/admin ico/admin)])\n     #(-> [\"users\" %]) k v]]])\n"]}