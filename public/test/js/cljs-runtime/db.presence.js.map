{"version":3,"sources":["db/presence.cljs"],"mappings":";;AASA,uBAAA,vBAAMA,sDAAUC;AAAhB,AACE,IAAMC,mBAAiB,AAACC,yDAAI,AAACC,mEAAa,CAAA,6DAAA,LAAiBH;IACrDI,gBAAc,AAACF,yDAAI,AAACC,mEAAa,CAAA,6DAAA,LAAiBH;IAClDK,eAAa,4HAAA,5HAACH,yDAAI,AAACC;AAFzB,AAGE,OAACG,6DAAQD,aACA,WAASE;AAAT,AACE,oBAAM,AAAMA;AAAZ,AACE,IAAMC,MAAI,AAACC,0DAAKR;AAAhB,AACE,AAAI,AAACS,kEAAaF;;AAClB,AAACG,yDAASH,IAAI,AAACI;;OACX,AAACF,kEAAaN,zEACd,4FAAM,AAACQ;;AALf","names":["db.presence/presence","uid","myConnectionsRef","js/module$node_modules$firebase$database$dist$index_esm.ref","js/module$node_modules$firebase$database$dist$index_esm.getDatabase","lastOnlineRef","connectedRef","js/module$node_modules$firebase$database$dist$index_esm.onValue","snap","con","js/module$node_modules$firebase$database$dist$index_esm.push","js/module$node_modules$firebase$database$dist$index_esm.onDisconnect","js/module$node_modules$firebase$database$dist$index_esm.set","js/module$node_modules$firebase$database$dist$index_esm.serverTimestamp"],"sourcesContent":["(ns db.presence\n  (:require [re-frame.core :as rf]\n            [\"firebase/database\" :as rtdb :refer [onDisconnect getDatabase ref onValue push set goOffline goOnline serverTimestamp]]\n            ;[app.config :refer [version]]\n            ;[app.system.database.rtdb :as rtdb]\n            ;[app.system.database.common :refer [database-ref]]\n            [cljs-time.core :as t]\n            #_[schpaa.lib.debug :as l]))\n\n(defn presence [uid]\n  (let [myConnectionsRef (ref (getDatabase) (str \"presence/\" uid \"/connections\"))\n        lastOnlineRef (ref (getDatabase) (str \"presence/\" uid \"/lastOnline\"))\n        connectedRef (ref (getDatabase) \".info/connected\")]\n    (onValue connectedRef\n             (fn [^js snap]\n               (when (.val snap)\n                 (let [con (push myConnectionsRef)]\n                   (-> (onDisconnect con) .remove)\n                   (rtdb/set con (serverTimestamp))\n                   (-> (onDisconnect lastOnlineRef)\n                       (.set (serverTimestamp)))))))))\n\n;region discarded\n"]}