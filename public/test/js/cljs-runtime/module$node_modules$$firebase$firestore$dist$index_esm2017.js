shadow$provide.module$node_modules$$firebase$firestore$dist$index_esm2017=function(global,require,module,exports){function O(t,...e){N.logLevel<=_logger.LogLevel.DEBUG&&(e=e.map(B),N.debug(`Firestore (${x}): ${t}`,...e))}function F(t,...e){N.logLevel<=_logger.LogLevel.ERROR&&(e=e.map(B),N.error(`Firestore (${x}): ${t}`,...e))}function $(t,...e){N.logLevel<=_logger.LogLevel.WARN&&(e=e.map(B),N.warn(`Firestore (${x}): ${t}`,...e))}function B(t){if("string"==typeof t)return t;try{return e$jscomp$0=t,
JSON.stringify(e$jscomp$0)}catch(e){return t}var e$jscomp$0}function L(t="Unexpected state"){t=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: `+t;throw F(t),Error(t);}function U(t,e){t||L()}function rt(t,e){return t<e?-1:t>e?1:0}function ot(t$jscomp$0,e,n){return t$jscomp$0.length===e.length&&t$jscomp$0.every((t,s)=>n(t,e[s]))}function ht(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function lt(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,
t[n])}function ft(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Tt(t){t||L();if("string"==typeof t){var e=0;const n=It.exec(t);n||L();n[1]&&(e=n[1],e=(e+"000000000").substr(0,9),e=Number(e));return{seconds:Math.floor((new Date(t)).getTime()/1E3),nanos:e}}return{seconds:Et(t.seconds),nanos:Et(t.nanos)}}function Et(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function At(t){return"string"==typeof t?pt.fromBase64String(t):pt.fromUint8Array(t)}
function Rt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Pt(t){t=t.mapValue.fields.__previous_value__;return Rt(t)?Pt(t):t}function bt(t){t=Tt(t.mapValue.fields.__local_write_time__.timestampValue);return new at(t.seconds,t.nanos)}function Dt(t){return 0===t&&1/t==-1/0}function Ct(t){return"number"==typeof t&&Number.isInteger(t)&&!Dt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=
Number.MIN_SAFE_INTEGER}function Mt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Rt(t)?4:Ht(t)?9:10:L()}function Ot(t$jscomp$1,e$jscomp$0){if(t$jscomp$1===e$jscomp$0)return!0;const n=Mt(t$jscomp$1);if(n!==Mt(e$jscomp$0))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t$jscomp$1.booleanValue===
e$jscomp$0.booleanValue;case 4:return bt(t$jscomp$1).isEqual(bt(e$jscomp$0));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;t=Tt(t.timestampValue);e=Tt(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(t$jscomp$1,e$jscomp$0);case 5:return t$jscomp$1.stringValue===e$jscomp$0.stringValue;case 6:return function(t,e){return At(t.bytesValue).isEqual(At(e.bytesValue))}(t$jscomp$1,
e$jscomp$0);case 7:return t$jscomp$1.referenceValue===e$jscomp$0.referenceValue;case 8:return function(t,e){return Et(t.geoPointValue.latitude)===Et(e.geoPointValue.latitude)&&Et(t.geoPointValue.longitude)===Et(e.geoPointValue.longitude)}(t$jscomp$1,e$jscomp$0);case 2:return function(t,e){return"integerValue"in t&&"integerValue"in e?Et(t.integerValue)===Et(e.integerValue):"doubleValue"in t&&"doubleValue"in e?(t=Et(t.doubleValue),e=Et(e.doubleValue),t===e?Dt(t)===Dt(e):isNaN(t)&&isNaN(e)):!1}(t$jscomp$1,
e$jscomp$0);case 9:return ot(t$jscomp$1.arrayValue.values||[],e$jscomp$0.arrayValue.values||[],Ot);case 10:return function(t$jscomp$0,e){t$jscomp$0=t$jscomp$0.mapValue.fields||{};e=e.mapValue.fields||{};if(ht(t$jscomp$0)!==ht(e))return!1;for(const t in t$jscomp$0)if(t$jscomp$0.hasOwnProperty(t)&&(void 0===e[t]||!Ot(t$jscomp$0[t],e[t])))return!1;return!0}(t$jscomp$1,e$jscomp$0);default:return L()}}function Ft(t$jscomp$0,e){return void 0!==(t$jscomp$0.values||[]).find(t=>Ot(t,e))}function $t(t$jscomp$1,
e$jscomp$1){if(t$jscomp$1===e$jscomp$1)return 0;const n$jscomp$0=Mt(t$jscomp$1),s$jscomp$0=Mt(e$jscomp$1);if(n$jscomp$0!==s$jscomp$0)return rt(n$jscomp$0,s$jscomp$0);switch(n$jscomp$0){case 0:case 9007199254740991:return 0;case 1:return rt(t$jscomp$1.booleanValue,e$jscomp$1.booleanValue);case 2:return function(t,e){t=Et(t.integerValue||t.doubleValue);e=Et(e.integerValue||e.doubleValue);return t<e?-1:t>e?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(t$jscomp$1,e$jscomp$1);case 3:return Bt(t$jscomp$1.timestampValue,
e$jscomp$1.timestampValue);case 4:return Bt(bt(t$jscomp$1),bt(e$jscomp$1));case 5:return rt(t$jscomp$1.stringValue,e$jscomp$1.stringValue);case 6:return function(t,e){t=At(t);e=At(e);return t.compareTo(e)}(t$jscomp$1.bytesValue,e$jscomp$1.bytesValue);case 7:return function(t$jscomp$0,e$jscomp$0){t$jscomp$0=t$jscomp$0.split("/");e$jscomp$0=e$jscomp$0.split("/");for(let t=0;t<t$jscomp$0.length&&t<e$jscomp$0.length;t++){const e=rt(t$jscomp$0[t],e$jscomp$0[t]);if(0!==e)return e}return rt(t$jscomp$0.length,
e$jscomp$0.length)}(t$jscomp$1.referenceValue,e$jscomp$1.referenceValue);case 8:return function(t,e){const n=rt(Et(t.latitude),Et(e.latitude));return 0!==n?n:rt(Et(t.longitude),Et(e.longitude))}(t$jscomp$1.geoPointValue,e$jscomp$1.geoPointValue);case 9:return function(t$jscomp$0,e$jscomp$0){t$jscomp$0=t$jscomp$0.values||[];e$jscomp$0=e$jscomp$0.values||[];for(let t=0;t<t$jscomp$0.length&&t<e$jscomp$0.length;++t){const e=$t(t$jscomp$0[t],e$jscomp$0[t]);if(e)return e}return rt(t$jscomp$0.length,e$jscomp$0.length)}(t$jscomp$1.arrayValue,
e$jscomp$1.arrayValue);case 10:return function(t$jscomp$0,e$jscomp$0){t$jscomp$0=t$jscomp$0.fields||{};const s=Object.keys(t$jscomp$0);e$jscomp$0=e$jscomp$0.fields||{};const r=Object.keys(e$jscomp$0);s.sort();r.sort();for(let t=0;t<s.length&&t<r.length;++t){var e=rt(s[t],r[t]);if(0!==e)return e;e=$t(t$jscomp$0[s[t]],e$jscomp$0[r[t]]);if(0!==e)return e}return rt(s.length,r.length)}(t$jscomp$1.mapValue,e$jscomp$1.mapValue);default:throw L();}}function Bt(t,e){if("string"==typeof t&&"string"==typeof e&&
t.length===e.length)return rt(t,e);t=Tt(t);e=Tt(e);const i=rt(t.seconds,e.seconds);return 0!==i?i:rt(t.nanos,e.nanos)}function Ut(t$jscomp$0){return"nullValue"in t$jscomp$0?"null":"booleanValue"in t$jscomp$0?""+t$jscomp$0.booleanValue:"integerValue"in t$jscomp$0?""+t$jscomp$0.integerValue:"doubleValue"in t$jscomp$0?""+t$jscomp$0.doubleValue:"timestampValue"in t$jscomp$0?function(t){t=Tt(t);return`time(${t.seconds},${t.nanos})`}(t$jscomp$0.timestampValue):"stringValue"in t$jscomp$0?t$jscomp$0.stringValue:
"bytesValue"in t$jscomp$0?At(t$jscomp$0.bytesValue).toBase64():"referenceValue"in t$jscomp$0?(n$jscomp$0=t$jscomp$0.referenceValue,xt.fromName(n$jscomp$0).toString()):"geoPointValue"in t$jscomp$0?`geo(${(e$jscomp$0=t$jscomp$0.geoPointValue).latitude},${e$jscomp$0.longitude})`:"arrayValue"in t$jscomp$0?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Ut(s);return e+"]"}(t$jscomp$0.arrayValue):"mapValue"in t$jscomp$0?function(t){const e=Object.keys(t.fields||{}).sort();let n=
"{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Ut(t.fields[i])}`;return n+"}"}(t$jscomp$0.mapValue):L();var e$jscomp$0,n$jscomp$0}function qt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Kt(t){return!!t&&"integerValue"in t}function Gt(t){return!!t&&"arrayValue"in t}function Qt(t){return!!t&&"nullValue"in t}function jt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Wt(t){return!!t&&"mapValue"in
t}function zt(t$jscomp$0){if(t$jscomp$0.geoPointValue)return{geoPointValue:Object.assign({},t$jscomp$0.geoPointValue)};if(t$jscomp$0.timestampValue&&"object"==typeof t$jscomp$0.timestampValue)return{timestampValue:Object.assign({},t$jscomp$0.timestampValue)};if(t$jscomp$0.mapValue){const e={mapValue:{fields:{}}};return lt(t$jscomp$0.mapValue.fields,(t,n)=>e.mapValue.fields[t]=zt(n)),e}if(t$jscomp$0.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t$jscomp$0.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=
zt(t$jscomp$0.arrayValue.values[n]);return e}return Object.assign({},t$jscomp$0)}function Ht(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Xt(t,e){return void 0===t?e:void 0===e||0<$t(t,e)?t:e}function Zt(t,e){return void 0===t?e:void 0===e||0>$t(t,e)?t:e}function ee(t$jscomp$0){const e=[];return lt(t$jscomp$0.fields,(t,n$jscomp$0)=>{t=new mt([t]);if(Wt(n$jscomp$0))if(n$jscomp$0=ee(n$jscomp$0.mapValue).fields,0===n$jscomp$0.length)e.push(t);else for(const n of n$jscomp$0)e.push(t.child(n));
else e.push(t)}),new gt(e)}function ie(t$jscomp$0){return t$jscomp$0.fields.find(t=>2===t.kind)}function re(t$jscomp$0){return t$jscomp$0.fields.filter(t=>2!==t.kind)}function ae(t,e){var n=t.toTimestamp().seconds;t=t.toTimestamp().nanoseconds+1;n=ct.fromTimestamp(1E9===t?new at(n+1,0):new at(n,t));return new he(n,xt.empty(),e)}function de(t,e=null,n=[],s=[],i=null,r=null,o=null){return new fe(t,e,n,s,i,r,o)}function _e(t$jscomp$1){if(null===t$jscomp$1.P){let t$jscomp$0=t$jscomp$1.path.canonicalString();
null!==t$jscomp$1.collectionGroup&&(t$jscomp$0+="|cg:"+t$jscomp$1.collectionGroup);t$jscomp$0=t$jscomp$0+"|f:"+t$jscomp$1.filters.map(t=>{return(e=t).field.canonicalString()+e.op.toString()+Ut(e.value);var e}).join(",");t$jscomp$0=t$jscomp$0+"|ob:"+t$jscomp$1.orderBy.map(t=>t.field.canonicalString()+t.dir).join(",");null==t$jscomp$1.limit||(t$jscomp$0+="|l:",t$jscomp$0+=t$jscomp$1.limit);t$jscomp$1.startAt&&(t$jscomp$0+="|lb:",t$jscomp$0+=t$jscomp$1.startAt.inclusive?"b:":"a:",t$jscomp$0+=t$jscomp$1.startAt.position.map(t=>
Ut(t)).join(","));t$jscomp$1.endAt&&(t$jscomp$0+="|ub:",t$jscomp$0+=t$jscomp$1.endAt.inclusive?"a:":"b:",t$jscomp$0+=t$jscomp$1.endAt.position.map(t=>Ut(t)).join(","));t$jscomp$1.P=t$jscomp$0}return t$jscomp$1.P}function we(t$jscomp$0){let e$jscomp$0=t$jscomp$0.path.canonicalString();return null!==t$jscomp$0.collectionGroup&&(e$jscomp$0+=" collectionGroup\x3d"+t$jscomp$0.collectionGroup),0<t$jscomp$0.filters.length&&(e$jscomp$0+=`, filters: [${t$jscomp$0.filters.map(t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Ut(e.value)}`;
var e}).join(", ")}]`),null==t$jscomp$0.limit||(e$jscomp$0+=", limit: "+t$jscomp$0.limit),0<t$jscomp$0.orderBy.length&&(e$jscomp$0+=`, orderBy: [${t$jscomp$0.orderBy.map(t=>`${t.field.canonicalString()} (${t.dir})`).join(", ")}]`),t$jscomp$0.startAt&&(e$jscomp$0+=", startAt: ",e$jscomp$0+=t$jscomp$0.startAt.inclusive?"b:":"a:",e$jscomp$0+=t$jscomp$0.startAt.position.map(t=>Ut(t)).join(",")),t$jscomp$0.endAt&&(e$jscomp$0+=", endAt: ",e$jscomp$0+=t$jscomp$0.endAt.inclusive?"a:":"b:",e$jscomp$0+=t$jscomp$0.endAt.position.map(t=>
Ut(t)).join(",")),`Target(${e$jscomp$0})`}function me(t$jscomp$0,e$jscomp$0){if(t$jscomp$0.limit!==e$jscomp$0.limit||t$jscomp$0.orderBy.length!==e$jscomp$0.orderBy.length)return!1;for(let n=0;n<t$jscomp$0.orderBy.length;n++){var t=t$jscomp$0.orderBy[n],e=e$jscomp$0.orderBy[n];if(t.dir!==e.dir||!t.field.isEqual(e.field))return!1}if(t$jscomp$0.filters.length!==e$jscomp$0.filters.length)return!1;for(t=0;t<t$jscomp$0.filters.length;t++)if(n$jscomp$0=t$jscomp$0.filters[t],s=e$jscomp$0.filters[t],n$jscomp$0.op!==
s.op||!n$jscomp$0.field.isEqual(s.field)||!Ot(n$jscomp$0.value,s.value))return!1;var n$jscomp$0,s;return t$jscomp$0.collectionGroup===e$jscomp$0.collectionGroup&&!!t$jscomp$0.path.isEqual(e$jscomp$0.path)&&!!ke(t$jscomp$0.startAt,e$jscomp$0.startAt)&&ke(t$jscomp$0.endAt,e$jscomp$0.endAt)}function ge(t){return xt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function ye(t$jscomp$0,e){return t$jscomp$0.filters.filter(t=>t instanceof Te&&t.field.isEqual(e))}function pe(t$jscomp$0,
e$jscomp$0,n$jscomp$0){let s,i=!0;for(var n of ye(t$jscomp$0,e$jscomp$0)){var t=void 0;let e=!0;switch(n.op){case "\x3c":case "\x3c\x3d":t=n.value;t="nullValue"in t?kt:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?qt(vt.empty(),xt.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:
"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:L();break;case "\x3d\x3d":case "in":case "\x3e\x3d":t=n.value;break;case "\x3e":t=n.value;e=!1;break;case "!\x3d":case "not-in":t=kt}Xt(s,t)===t&&(s=t,i=e)}if(null!==n$jscomp$0)for(n=0;n<t$jscomp$0.orderBy.length;++n)if(t$jscomp$0.orderBy[n].field.isEqual(e$jscomp$0)){t$jscomp$0=n$jscomp$0.position[n];Xt(s,t$jscomp$0)===t$jscomp$0&&(s=t$jscomp$0,i=n$jscomp$0.inclusive);break}return{value:s,inclusive:i}}function Ie(t$jscomp$0,e$jscomp$0,
n$jscomp$0){let s,i=!0;for(var n of ye(t$jscomp$0,e$jscomp$0)){var t=void 0;let e=!0;switch(n.op){case "\x3e\x3d":case "\x3e":t=n.value;t="nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?qt(vt.empty(),xt.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:
"arrayValue"in t?{mapValue:{}}:"mapValue"in t?Nt:L();e=!1;break;case "\x3d\x3d":case "in":case "\x3c\x3d":t=n.value;break;case "\x3c":t=n.value;e=!1;break;case "!\x3d":case "not-in":t=Nt}Zt(s,t)===t&&(s=t,i=e)}if(null!==n$jscomp$0)for(n=0;n<t$jscomp$0.orderBy.length;++n)if(t$jscomp$0.orderBy[n].field.isEqual(e$jscomp$0)){t$jscomp$0=n$jscomp$0.position[n];Zt(s,t$jscomp$0)===t$jscomp$0&&(s=t$jscomp$0,i=n$jscomp$0.inclusive);break}return{value:s,inclusive:i}}function Pe(t$jscomp$0,e){var n;return((null===
(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>xt.fromName(t.referenceValue))}function Ne(t,e,n){var s=0;for(let i=0;i<t.position.length;i++){const r=e[i];s=t.position[i];s=r.field.isKeyField()?xt.comparator(xt.fromName(s.referenceValue),n.key):$t(s,n.data.field(r.field));if("desc"===r.dir&&(s*=-1),0!==s)break}return s}function ke(t,e){if(null===t)return null===e;if(null===e||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ot(t.position[n],
e.position[n]))return!1;return!0}function $e(t){return null!=t.limit&&"F"===t.limitType}function Be(t){return null!=t.limit&&"L"===t.limitType}function Le(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Ue(t){for(const e of t.filters)if(e.S())return e.field;return null}function Ke(t$jscomp$0){if(null===t$jscomp$0.D){t$jscomp$0.D=[];var t=Ue(t$jscomp$0);const n=Le(t$jscomp$0);if(null!==t&&null===n)t.isKeyField()||t$jscomp$0.D.push(new Ce(t)),t$jscomp$0.D.push(new Ce(mt.keyField(),
"asc"));else{t=!1;for(var n$jscomp$0 of t$jscomp$0.explicitOrderBy)t$jscomp$0.D.push(n$jscomp$0),n$jscomp$0.field.isKeyField()&&(t=!0);t||(n$jscomp$0=0<t$jscomp$0.explicitOrderBy.length?t$jscomp$0.explicitOrderBy[t$jscomp$0.explicitOrderBy.length-1].dir:"asc",t$jscomp$0.D.push(new Ce(mt.keyField(),n$jscomp$0)))}}return t$jscomp$0.D}function Ge(t$jscomp$0){if(!t$jscomp$0.C)if("F"===t$jscomp$0.limitType)t$jscomp$0.C=de(t$jscomp$0.path,t$jscomp$0.collectionGroup,Ke(t$jscomp$0),t$jscomp$0.filters,t$jscomp$0.limit,
t$jscomp$0.startAt,t$jscomp$0.endAt);else{const t=[];for(var n of Ke(t$jscomp$0))t.push(new Ce(n.field,"desc"===n.dir?"asc":"desc"));n=t$jscomp$0.endAt?new De(t$jscomp$0.endAt.position,!t$jscomp$0.endAt.inclusive):null;const s=t$jscomp$0.startAt?new De(t$jscomp$0.startAt.position,!t$jscomp$0.startAt.inclusive):null;t$jscomp$0.C=de(t$jscomp$0.path,t$jscomp$0.collectionGroup,t,t$jscomp$0.filters,t$jscomp$0.limit,n,s)}return t$jscomp$0.C}function Qe(t,e,n){return new Me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),
t.filters.slice(),e,n,t.startAt,t.endAt)}function je(t,e){return me(Ge(t),Ge(e))&&t.limitType===e.limitType}function We(t){return`${_e(Ge(t))}|lt:${t.limitType}`}function ze(t){return`Query(target=${we(Ge(t))}; limitType=${t.limitType})`}function He(t$jscomp$1,e$jscomp$1){return e$jscomp$1.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):xt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t$jscomp$1,
e$jscomp$1)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t$jscomp$1,e$jscomp$1)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t$jscomp$1,e$jscomp$1)&&function(t$jscomp$0,e$jscomp$0){return t$jscomp$0.startAt&&!function(t,e,n){e=Ne(t,e,n);return t.inclusive?0>=e:0>e}(t$jscomp$0.startAt,Ke(t$jscomp$0),e$jscomp$0)||t$jscomp$0.endAt&&!function(t,e,n){e=Ne(t,e,n);return t.inclusive?0<=e:0<e}(t$jscomp$0.endAt,
Ke(t$jscomp$0),e$jscomp$0)?!1:!0}(t$jscomp$1,e$jscomp$1)}function Je(t){return t.collectionGroup||(1==t.path.length%2?t.path.lastSegment():t.path.get(t.path.length-2))}function Ye(t$jscomp$0){return(e$jscomp$0,n)=>{let s=!1;for(const i of Ke(t$jscomp$0)){a:{var JSCompiler_inline_result=i;var e=e$jscomp$0;var JSCompiler_temp=n;if(JSCompiler_inline_result.field.isKeyField())JSCompiler_temp=xt.comparator(e.key,JSCompiler_temp.key);else{var t=JSCompiler_inline_result.field;e=e.data.field(t);JSCompiler_temp=
JSCompiler_temp.data.field(t);JSCompiler_temp=null!==e&&null!==JSCompiler_temp?$t(e,JSCompiler_temp):L()}switch(JSCompiler_inline_result.dir){case "asc":JSCompiler_inline_result=JSCompiler_temp;break a;case "desc":JSCompiler_inline_result=-1*JSCompiler_temp;break a;default:JSCompiler_inline_result=L()}}if(0!==JSCompiler_inline_result)return JSCompiler_inline_result;s=s||i.field.isKeyField()}return 0}}function Ze(t,e){if(t.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};
if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dt(e)?"-0":e}}function en(t,e){return Ct(e)?{integerValue:""+e}:Ze(t,e)}function sn(t$jscomp$0,e$jscomp$0,n){return t$jscomp$0 instanceof un?function(t,e){t={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(t.fields.__previous_value__=e),{mapValue:t}}(n,e$jscomp$0):t$jscomp$0 instanceof an?cn(t$jscomp$0,e$jscomp$0):t$jscomp$0 instanceof hn?ln(t$jscomp$0,
e$jscomp$0):function(t,e){e=on(t,e);var JSCompiler_temp_const=Et(e.integerValue||e.doubleValue);var JSCompiler_inline_result=t.k;JSCompiler_inline_result=Et(JSCompiler_inline_result.integerValue||JSCompiler_inline_result.doubleValue);JSCompiler_temp_const+=JSCompiler_inline_result;return Kt(e)&&Kt(t.k)?{integerValue:""+JSCompiler_temp_const}:Ze(t.M,JSCompiler_temp_const)}(t$jscomp$0,e$jscomp$0)}function on(t,e){return t instanceof fn?Kt(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}function cn(t$jscomp$0,
e$jscomp$0){e$jscomp$0=_n(e$jscomp$0);for(const e of t$jscomp$0.elements)e$jscomp$0.some(t=>Ot(t,e))||e$jscomp$0.push(e);return{arrayValue:{values:e$jscomp$0}}}function ln(t$jscomp$0,e$jscomp$0){e$jscomp$0=_n(e$jscomp$0);for(const e of t$jscomp$0.elements)e$jscomp$0=e$jscomp$0.filter(t=>!Ot(t,e));return{arrayValue:{values:e$jscomp$0}}}function _n(t){return Gt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function pn(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):
void 0===t.exists||t.exists===e.isFoundDocument()}function Tn(t$jscomp$0,e$jscomp$0,n$jscomp$0){t$jscomp$0 instanceof bn?function(t,e,n){const s=t.value.clone();t=Sn(t.fieldTransforms,e,n.transformResults);s.setAll(t);e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t$jscomp$0,e$jscomp$0,n$jscomp$0):t$jscomp$0 instanceof Vn?function(t,e,n){if(!pn(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Sn(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(vn(t));
i.setAll(s);e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t$jscomp$0,e$jscomp$0,n$jscomp$0):e$jscomp$0.convertToNoDocument(n$jscomp$0.version).setHasCommittedMutations()}function En(t$jscomp$0,e$jscomp$0,n$jscomp$0){t$jscomp$0 instanceof bn?function(t,e,n){if(pn(t.precondition,e)){var s=t.value.clone();t=Dn(t.fieldTransforms,n,e);s.setAll(t);e.convertToFoundDocument(Pn(e),s).setHasLocalMutations()}}(t$jscomp$0,e$jscomp$0,n$jscomp$0):t$jscomp$0 instanceof Vn?function(t,e,n){if(pn(t.precondition,
e)){n=Dn(t.fieldTransforms,n,e);var i=e.data;i.setAll(vn(t));i.setAll(n);e.convertToFoundDocument(Pn(e),i).setHasLocalMutations()}}(t$jscomp$0,e$jscomp$0,n$jscomp$0):function(t,e){pn(t.precondition,e)&&e.convertToNoDocument(ct.min())}(t$jscomp$0,e$jscomp$0)}function Rn(t$jscomp$1,e$jscomp$1){return t$jscomp$1.type===e$jscomp$1.type&&!!t$jscomp$1.key.isEqual(e$jscomp$1.key)&&!!t$jscomp$1.precondition.isEqual(e$jscomp$1.precondition)&&!!function(t$jscomp$0,e$jscomp$0){return void 0===t$jscomp$0&&void 0===
e$jscomp$0||!(!t$jscomp$0||!e$jscomp$0)&&ot(t$jscomp$0,e$jscomp$0,(t,e)=>{var JSCompiler_temp;if(JSCompiler_temp=t.field.isEqual(e.field))t=t.transform,e=e.transform,JSCompiler_temp=t instanceof an&&e instanceof an||t instanceof hn&&e instanceof hn?ot(t.elements,e.elements,Ot):t instanceof fn&&e instanceof fn?Ot(t.k,e.k):t instanceof un&&e instanceof un;return JSCompiler_temp})}(t$jscomp$1.fieldTransforms,e$jscomp$1.fieldTransforms)&&(0===t$jscomp$1.type?t$jscomp$1.value.isEqual(e$jscomp$1.value):
1!==t$jscomp$1.type||t$jscomp$1.data.isEqual(e$jscomp$1.data)&&t$jscomp$1.fieldMask.isEqual(e$jscomp$1.fieldMask))}function Pn(t){return t.isFoundDocument()?t.version:ct.min()}function vn(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function Sn(t,e,n$jscomp$0){const s=new Map;t.length===n$jscomp$0.length||L();for(let i=0;i<n$jscomp$0.length;i++){var r=t[i],o=r.transform,u=e.data.field(r.field),JSCompiler_temp_const=s,JSCompiler_temp_const$jscomp$0=
JSCompiler_temp_const.set;r=r.field;var n=n$jscomp$0[i];o=o instanceof an?cn(o,u):o instanceof hn?ln(o,u):n;JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,r,o)}return s}function Dn(t,e,n){const s=new Map;for(const i of t){t=i.transform;const r=n.data.field(i.field);s.set(i.field,sn(t,r,e))}return s}function On(t){switch(t){default:return L();case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;
case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0}}function Fn(t){if(void 0===t)return F("GRPC error has no .code"),G.UNKNOWN;switch(t){case kn.OK:return G.OK;case kn.CANCELLED:return G.CANCELLED;case kn.UNKNOWN:return G.UNKNOWN;case kn.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case kn.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case kn.INTERNAL:return G.INTERNAL;
case kn.UNAVAILABLE:return G.UNAVAILABLE;case kn.UNAUTHENTICATED:return G.UNAUTHENTICATED;case kn.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case kn.NOT_FOUND:return G.NOT_FOUND;case kn.ALREADY_EXISTS:return G.ALREADY_EXISTS;case kn.PERMISSION_DENIED:return G.PERMISSION_DENIED;case kn.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case kn.ABORTED:return G.ABORTED;case kn.OUT_OF_RANGE:return G.OUT_OF_RANGE;case kn.UNIMPLEMENTED:return G.UNIMPLEMENTED;case kn.DATA_LOSS:return G.DATA_LOSS;default:return L()}}
function Gn(t){return t.hasNext()?t.getNext():void 0}function Hn(){return new $n(t=>t.toString(),(t,e)=>t.isEqual(e))}function Xn(...t){let e=Yn;for(const n of t)e=e.add(n);return e}function ds(t,e){return t.N?`${(new Date(1E3*e.seconds)).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _s(t,e){return t.N?e.toBase64():e.toUint8Array()}function ms(t){t||L();var JSCompiler_temp_const=ct,JSCompiler_temp_const$jscomp$0=
JSCompiler_temp_const.fromTimestamp;t=Tt(t);t=new at(t.seconds,t.nanos);return JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,t)}function gs(t,e){return(new _t(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString()}function ys(t){t=_t.fromString(t);Gs(t)||L();return t}function Is(t,e){e=ys(e);if(e.get(1)!==t.databaseId.projectId)throw new Q(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);
if(e.get(3)!==t.databaseId.database)throw new Q(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new xt(Rs(e))}function Ts(t,e){return gs(t.databaseId,e)}function Es(t){t=ys(t);return 4===t.length?_t.emptyPath():Rs(t)}function As(t){return(new _t(["projects",t.databaseId.projectId,"databases",t.databaseId.database])).canonicalString()}function Rs(t){4<t.length&&"documents"===t.get(4)||L();return t.popFirst(5)}function Ps(t,e,n){return{name:gs(t.databaseId,
e.path),fields:n.value.mapValue.fields}}function bs(t,e,n){t=Is(t,e.name);const i=ms(e.updateTime);e=new te({mapValue:{fields:e.fields}});e=ne.newFoundDocument(t,i,e);return n&&e.setHasCommittedMutations(),n?e.setHasCommittedMutations():e}function Vs(t$jscomp$0,e$jscomp$0){return"found"in e$jscomp$0?function(t,e){e.found||L();e.found.name;e.found.updateTime;t=Is(t,e.found.name);const s=ms(e.found.updateTime);e=new te({mapValue:{fields:e.found.fields}});return ne.newFoundDocument(t,s,e)}(t$jscomp$0,
e$jscomp$0):"missing"in e$jscomp$0?function(t,e){e.missing||L();e.readTime||L();t=Is(t,e.missing);e=ms(e.readTime);return ne.newNoDocument(t,e)}(t$jscomp$0,e$jscomp$0):L()}function vs(t$jscomp$0,e$jscomp$0){if("targetChange"in e$jscomp$0){e$jscomp$0.targetChange;var s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:L()}(e$jscomp$0.targetChange.targetChangeType||"NO_CHANGE"),i=e$jscomp$0.targetChange.targetIds||[];t$jscomp$0=function(t,e){t.N?(void 0===
e||"string"==typeof e||L(),t=pt.fromBase64String(e||"")):(void 0===e||e instanceof Uint8Array||L(),t=pt.fromUint8Array(e||new Uint8Array));return t}(t$jscomp$0,e$jscomp$0.targetChange.resumeToken);e$jscomp$0=(e$jscomp$0=e$jscomp$0.targetChange.cause)&&function(t){const e=void 0===t.code?G.UNKNOWN:Fn(t.code);return new Q(e,t.message||"")}(e$jscomp$0);t$jscomp$0=new rs(s,i,t$jscomp$0,e$jscomp$0||null)}else if("documentChange"in e$jscomp$0)e$jscomp$0.documentChange,s=e$jscomp$0.documentChange,s.document,
s.document.name,s.document.updateTime,t$jscomp$0=Is(t$jscomp$0,s.document.name),i=ms(s.document.updateTime),e$jscomp$0=new te({mapValue:{fields:s.document.fields}}),t$jscomp$0=ne.newFoundDocument(t$jscomp$0,i,e$jscomp$0),t$jscomp$0=new ss(s.targetIds||[],s.removedTargetIds||[],t$jscomp$0.key,t$jscomp$0);else if("documentDelete"in e$jscomp$0)e$jscomp$0.documentDelete,s=e$jscomp$0.documentDelete,s.document,t$jscomp$0=Is(t$jscomp$0,s.document),i=s.readTime?ms(s.readTime):ct.min(),t$jscomp$0=ne.newNoDocument(t$jscomp$0,
i),t$jscomp$0=new ss([],s.removedTargetIds||[],t$jscomp$0.key,t$jscomp$0);else if("documentRemove"in e$jscomp$0)e$jscomp$0.documentRemove,s=e$jscomp$0.documentRemove,s.document,t$jscomp$0=Is(t$jscomp$0,s.document),t$jscomp$0=new ss([],s.removedTargetIds||[],t$jscomp$0,null);else{if(!("filter"in e$jscomp$0))return L();e$jscomp$0.filter;t$jscomp$0=e$jscomp$0.filter;t$jscomp$0.targetId;s=new Nn(t$jscomp$0.count||0);t$jscomp$0=new is(t$jscomp$0.targetId,s)}return t$jscomp$0}function Ss(t$jscomp$1,e$jscomp$0){let n;
if(e$jscomp$0 instanceof bn)n={update:Ps(t$jscomp$1,e$jscomp$0.key,e$jscomp$0.value)};else if(e$jscomp$0 instanceof Cn)n={delete:gs(t$jscomp$1.databaseId,e$jscomp$0.key.path)};else if(e$jscomp$0 instanceof Vn)n={update:Ps(t$jscomp$1,e$jscomp$0.key,e$jscomp$0.data),updateMask:Ks(e$jscomp$0.fieldMask)};else{if(!(e$jscomp$0 instanceof xn))return L();n={verify:gs(t$jscomp$1.databaseId,e$jscomp$0.key.path)}}return 0<e$jscomp$0.fieldTransforms.length&&(n.updateTransforms=e$jscomp$0.fieldTransforms.map(t$jscomp$0=>
function(t,e){t=e.transform;if(t instanceof un)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof an)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof hn)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof fn)return{fieldPath:e.field.canonicalString(),increment:t.k};throw L();}(0,t$jscomp$0))),e$jscomp$0.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==
e.updateTime?{updateTime:ds(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:L()}(t$jscomp$1,e$jscomp$0.precondition)),n}function Ds(t$jscomp$1,e$jscomp$0){const n$jscomp$0=e$jscomp$0.currentDocument?function(t){return void 0!==t.updateTime?yn.updateTime(ms(t.updateTime)):void 0!==t.exists?yn.exists(t.exists):yn.none()}(e$jscomp$0.currentDocument):yn.none();var s=e$jscomp$0.updateTransforms?e$jscomp$0.updateTransforms.map(e=>{let n=null;"setToServerValue"in e?("REQUEST_TIME"===e.setToServerValue||
L(),n=new un):"appendMissingElements"in e?n=new an(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new hn(e.removeAllFromArray.values||[]):"increment"in e?n=new fn(t$jscomp$1,e.increment):L();e=mt.fromServerFormat(e.fieldPath);return new wn(e,n)}):[];if(e$jscomp$0.update){e$jscomp$0.update.name;const i=Is(t$jscomp$1,e$jscomp$0.update.name),r=new te({mapValue:{fields:e$jscomp$0.update.fields}});return e$jscomp$0.updateMask?(e$jscomp$0=function(t$jscomp$0){return new gt((t$jscomp$0.fieldPaths||
[]).map(t=>mt.fromServerFormat(t)))}(e$jscomp$0.updateMask),new Vn(i,r,e$jscomp$0,n$jscomp$0,s)):new bn(i,r,n$jscomp$0,s)}return e$jscomp$0.delete?(s=Is(t$jscomp$1,e$jscomp$0.delete),new Cn(s,n$jscomp$0)):e$jscomp$0.verify?(s=Is(t$jscomp$1,e$jscomp$0.verify),new xn(s,n$jscomp$0)):L()}function Cs(t$jscomp$0,e){t$jscomp$0&&0<t$jscomp$0.length?(void 0!==e||L(),t$jscomp$0=t$jscomp$0.map(t=>{let n=t.updateTime?ms(t.updateTime):ms(e);return n.isEqual(ct.min())&&(n=ms(e)),new gn(n,t.transformResults||[])})):
t$jscomp$0=[];return t$jscomp$0}function Ns(t$jscomp$2,e$jscomp$0){const n={structuredQuery:{}};var s=e$jscomp$0.path;null!==e$jscomp$0.collectionGroup?(n.parent=Ts(t$jscomp$2,s),n.structuredQuery.from=[{collectionId:e$jscomp$0.collectionGroup,allDescendants:!0}]):(n.parent=Ts(t$jscomp$2,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);(s=function(t$jscomp$1){if(0!==t$jscomp$1.length)return t$jscomp$1=t$jscomp$1.map(t$jscomp$0=>function(t){if("\x3d\x3d"===t.op){if(jt(t.value))return{unaryFilter:{field:Bs(t.field),
op:"IS_NAN"}};if(Qt(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NULL"}}}else if("!\x3d"===t.op){if(jt(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NOT_NAN"}};if(Qt(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bs(t.field),op:ls[t.op],value:t.value}}}(t$jscomp$0)),1===t$jscomp$1.length?t$jscomp$1[0]:{compositeFilter:{op:"AND",filters:t$jscomp$1}}}(e$jscomp$0.filters))&&(n.structuredQuery.where=s);(s=function(t$jscomp$0){if(0!==t$jscomp$0.length)return t$jscomp$0.map(t=>
({field:Bs(t.field),direction:hs[t.dir]}))}(e$jscomp$0.orderBy))&&(n.structuredQuery.orderBy=s);t$jscomp$2=function(t,e){return t.N||null==e?e:{value:e}}(t$jscomp$2,e$jscomp$0.limit);var u;return null!==t$jscomp$2&&(n.structuredQuery.limit=t$jscomp$2),e$jscomp$0.startAt&&(n.structuredQuery.startAt={before:(u=e$jscomp$0.startAt).inclusive,values:u.position}),e$jscomp$0.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e$jscomp$0.endAt)),n}function ks(t$jscomp$0){let e$jscomp$0=
Es(t$jscomp$0.parent);t$jscomp$0=t$jscomp$0.structuredQuery;var s=t$jscomp$0.from?t$jscomp$0.from.length:0;let i=null;0<s&&(1===s||L(),s=t$jscomp$0.from[0],s.allDescendants?i=s.collectionId:e$jscomp$0=e$jscomp$0.child(s.collectionId));s=[];t$jscomp$0.where&&(s=Os(t$jscomp$0.where));let o=[];t$jscomp$0.orderBy&&(o=t$jscomp$0.orderBy.map(t=>{var JSCompiler_temp_const=mt.fromServerFormat(t.field.fieldPath);a:switch(t.direction){case "ASCENDING":t="asc";break a;case "DESCENDING":t="desc";break a;default:t=
void 0}return new Ce(JSCompiler_temp_const,t)}));let u=null;t$jscomp$0.limit&&(u=function(t){let e;return e="object"==typeof t?t.value:t,null==e?null:e}(t$jscomp$0.limit));let a=null;t$jscomp$0.startAt&&(a=function(t){return new De(t.values||[],!!t.before)}(t$jscomp$0.startAt));let c=null;return t$jscomp$0.endAt&&(c=function(t){return new De(t.values||[],!t.before)}(t$jscomp$0.endAt)),new Me(e$jscomp$0,i,o,s,u,"F",a,c)}function Ms(t$jscomp$0,e$jscomp$0){t$jscomp$0=function(t,e){switch(e){case 0:return null;
case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return L()}}(0,e$jscomp$0.purpose);return null==t$jscomp$0?null:{"goog-listen-tags":t$jscomp$0}}function Os(t$jscomp$0){return t$jscomp$0?void 0!==t$jscomp$0.unaryFilter?[qs(t$jscomp$0)]:void 0!==t$jscomp$0.fieldFilter?[Us(t$jscomp$0)]:void 0!==t$jscomp$0.compositeFilter?t$jscomp$0.compositeFilter.filters.map(t=>Os(t)).reduce((t,e)=>t.concat(e)):L():[]}function Bs(t){return{fieldPath:t.canonicalString()}}function Us(t$jscomp$0){return Te.create(mt.fromServerFormat(t$jscomp$0.fieldFilter.field.fieldPath),
function(t){switch(t){case "EQUAL":return"\x3d\x3d";case "NOT_EQUAL":return"!\x3d";case "GREATER_THAN":return"\x3e";case "GREATER_THAN_OR_EQUAL":return"\x3e\x3d";case "LESS_THAN":return"\x3c";case "LESS_THAN_OR_EQUAL":return"\x3c\x3d";case "ARRAY_CONTAINS":return"array-contains";case "IN":return"in";case "NOT_IN":return"not-in";case "ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(t$jscomp$0.fieldFilter.op),t$jscomp$0.fieldFilter.value)}function qs(t){switch(t.unaryFilter.op){case "IS_NAN":return t=
mt.fromServerFormat(t.unaryFilter.field.fieldPath),Te.create(t,"\x3d\x3d",{doubleValue:NaN});case "IS_NULL":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),Te.create(t,"\x3d\x3d",{nullValue:"NULL_VALUE"});case "IS_NOT_NAN":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),Te.create(t,"!\x3d",{doubleValue:NaN});case "IS_NOT_NULL":return t=mt.fromServerFormat(t.unaryFilter.field.fieldPath),Te.create(t,"!\x3d",{nullValue:"NULL_VALUE"});default:return L()}}function Ks(t$jscomp$0){const e=
[];return t$jscomp$0.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Gs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Qs(t$jscomp$0){var e$jscomp$0="";for(let n=0;n<t$jscomp$0.length;n++){0<e$jscomp$0.length&&(e$jscomp$0+="");var t=t$jscomp$0.get(n);const s$jscomp$0=t.length;for(let e=0;e<s$jscomp$0;e++){const s=t.charAt(e);switch(s){case "\x00":e$jscomp$0+="";break;case "":e$jscomp$0+="";break;default:e$jscomp$0+=s}}}return e$jscomp$0+
""}function zs(t){const e$jscomp$0=t.length;2<=e$jscomp$0||L();if(2===e$jscomp$0)return""===t.charAt(0)&&""===t.charAt(1)||L(),_t.emptyPath();const n=e$jscomp$0-2,s=[];let i="";for(var r=0;r<e$jscomp$0;){const e=t.indexOf("",r);(0>e||e>n)&&L();switch(t.charAt(e+1)){case "":r=t.substring(r,e);let o;0===i.length?o=r:(i+=r,o=i,i="");s.push(o);break;case "":i+=t.substring(r,e);i+="\x00";break;case "":i+=t.substring(r,e+1);break;default:L()}r=e+2}return new _t(s)}function Ys(t,e,n){return[t,Qs(e),
n]}function Ri(t){return"IndexedDbTransactionError"===t.name}function bi(t$jscomp$0){return new pi((e,n)=>{t$jscomp$0.onsuccess=t=>{e(t.target.result)};t$jscomp$0.onerror=t=>{t=vi(t.target.error);n(t)}})}function vi(t$jscomp$0){const e=Ti.Vt((0,_util.getUA)());if(12.2<=e&&13>e&&0<=t$jscomp$0.message.indexOf("An internal error was encountered in the Indexed Database server")){const t=new Q("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown 'An internal error was encountered in the Indexed Database server'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
return Vi||(Vi=!0,setTimeout(()=>{throw t;},0)),t}return t$jscomp$0}function Di(t,e){return Ti.xt(t.Ht,e)}function Fi(t,e){const n=e.key,s={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:$i(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())t=t.Jt,e={name:gs(t.databaseId,e.key.path),fields:e.data.value.mapValue.fields,updateTime:ds(t,e.version.toTimestamp())},s.document=e;else if(e.isNoDocument())s.noDocument=
{path:n.path.toArray(),readTime:Bi(e.version)};else{if(!e.isUnknownDocument())return L();s.unknownDocument={path:n.path.toArray(),version:Bi(e.version)}}return s}function $i(t){t=t.toTimestamp();return[t.seconds,t.nanoseconds]}function Bi(t){t=t.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Li(t){t=new at(t.seconds,t.nanoseconds);return ct.fromTimestamp(t)}function Ui(t$jscomp$0,e$jscomp$0){const n=(e$jscomp$0.baseMutations||[]).map(e=>Ds(t$jscomp$0.Jt,e));for(var t=0;t<
e$jscomp$0.mutations.length-1;++t){var n$jscomp$0=e$jscomp$0.mutations[t];t+1<e$jscomp$0.mutations.length&&void 0!==e$jscomp$0.mutations[t+1].transform&&(n$jscomp$0.updateTransforms=e$jscomp$0.mutations[t+1].transform.fieldTransforms,e$jscomp$0.mutations.splice(t+1,1),++t)}t=e$jscomp$0.mutations.map(e=>Ds(t$jscomp$0.Jt,e));n$jscomp$0=at.fromMillis(e$jscomp$0.localWriteTimeMs);return new Ci(e$jscomp$0.batchId,n$jscomp$0,n,t)}function qi(t){const e=Li(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?
Li(t.lastLimboFreeSnapshotVersion):ct.min();var s;void 0!==t.query.documents?(1===(s=t.query).documents.length||L(),s=Ge(new Me(Es(s.documents[0])))):s=Ge(ks(t.query));return new ki(s,t.targetId,0,t.lastListenSequenceNumber,e,n,pt.fromBase64String(t.resumeToken))}function Ki(t,e){const n=Bi(e.snapshotVersion),s=Bi(e.lastLimboFreeSnapshotVersion);t=ge(e.target)?{documents:[Ts(t.Jt,e.target.path)]}:Ns(t.Jt,e.target);const r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:_e(e.target),
readTime:n,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:t}}function Gi(t){const e=ks({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Qe(e,e.limit,"L"):e}function Qi(t,e){return new Ni(e.largestBatchId,Ds(t.Jt,e.overlayMutation))}function ji(t,e){const n=e.path.lastSegment();return[t,Qs(e.path.popLast()),n]}function Yi(t){return Di(t,"documentOverlays")}function tr(t$jscomp$0){let e$jscomp$0=0;for(let n=0;8>n;++n){a:{var t=
255&t$jscomp$0[n];if(0===t){var JSCompiler_inline_result=8;break a}let e=0;JSCompiler_inline_result=(0==t>>4&&(e+=4,t<<=4),0==t>>6&&(e+=2,t<<=2),0==t>>7&&(e+=1),e)}if(e$jscomp$0+=JSCompiler_inline_result,8!==JSCompiler_inline_result)break}return Math.ceil((64-e$jscomp$0)/8)}function or(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=ur(t.arrayValue,e.arrayValue),0!==n?n:(n=ur(t.directionalValue,e.directionalValue),0!==n?n:xt.comparator(t.documentKey,e.documentKey)))}function ur(t,e){for(let n=0;n<
t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}function _r(t){return Di(t,"indexEntries")}function wr(t){return Di(t,"indexConfiguration")}function mr(t){return Di(t,"indexState")}function pr(t$jscomp$0,e$jscomp$0,n$jscomp$0){var s=t$jscomp$0.store("mutations");t$jscomp$0=t$jscomp$0.store("documentMutations");const r=[],o=IDBKeyRange.only(n$jscomp$0.batchId);let u=0;s=s.Wt({range:o},(t,e,n)=>(u++,n.delete()));r.push(s.next(()=>{1===u||L()}));const c=[];for(const t of n$jscomp$0.mutations)s=
Ys(e$jscomp$0,t.key.path,n$jscomp$0.batchId),r.push(t$jscomp$0.delete(s)),c.push(t.key);return pi.waitFor(r).next(()=>c)}function Ir(t){if(!t)return 0;if(t.document)t=t.document;else if(t.unknownDocument)t=t.unknownDocument;else{if(!t.noDocument)throw L();t=t.noDocument}return JSON.stringify(t).length}function Er(t$jscomp$0,e,n$jscomp$0){n$jscomp$0=[e,Qs(n$jscomp$0.path)];const i=n$jscomp$0[1];n$jscomp$0=IDBKeyRange.lowerBound(n$jscomp$0);let o=!1;return Rr(t$jscomp$0).Wt({range:n$jscomp$0,jt:!0},
(t,n,s)=>{const [r,u]=t;r===e&&u===i&&(o=!0);s.done()}).next(()=>o)}function Ar(t){return Di(t,"mutations")}function Rr(t){return Di(t,"documentMutations")}function vr(t){return Di(t,"targets")}function Dr(t){return Di(t,"targetDocuments")}function Cr(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t.code!==G.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;O("LocalStore",
"Unexpectedly lost primary lease")})}function xr([t,e],[n,s]){t=rt(t,n);return 0===t?rt(e,s):t}function Fr(t,e){var JSCompiler_temp_const=Dr(t),JSCompiler_temp_const$jscomp$0=JSCompiler_temp_const.put;t=t.currentSequenceNumber;e={targetId:0,path:Qs(e.path),sequenceNumber:t};return JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,e)}function qr(t){return Di(t,"remoteDocumentsV14")}function Kr(t){t=t.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Gr(t,e){const n=
e.documentKey.path.toArray();return[t,$i(e.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function Qr(t$jscomp$0,e){t$jscomp$0=t$jscomp$0.path.toArray();e=e.path.toArray();let i=0;for(let t=0;t<t$jscomp$0.length-2&&t<e.length-2;++t)if(i=rt(t$jscomp$0[t],e[t]),i)return i;return i=rt(t$jscomp$0.length,e.length),i||(i=rt(t$jscomp$0[t$jscomp$0.length-2],e[e.length-2]),i||rt(t$jscomp$0[t$jscomp$0.length-1],e[e.length-1]))}function Wr(t){t.createObjectStore("targetDocuments",{keyPath:si}).createIndex("documentTargetsIndex",
ii,{unique:!0});t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ni,{unique:!0});t.createObjectStore("targetGlobal")}function Jr(t){return Di(t,"owner")}function Yr(t){return Di(t,"clientMetadata")}function Xr(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function io(t$jscomp$1,e$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return yield t$jscomp$1.persistence.runTransaction("Handle user change",
"readonly",t$jscomp$0=>{let s;return t$jscomp$1.Bs.getAllMutationBatches(t$jscomp$0).next(i=>(s=i,t$jscomp$1.ai(e$jscomp$1),t$jscomp$1.Bs.getAllMutationBatches(t$jscomp$0))).next(e$jscomp$0=>{const i=[],r=[];let o=Xn();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e$jscomp$0){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return t$jscomp$1.ci.Ks(t$jscomp$0,o).next(t=>({hi:t,removedBatchIds:i,addedBatchIds:r}))})})})}function ro(t$jscomp$2,
e$jscomp$1){return t$jscomp$2.persistence.runTransaction("Acknowledge batch","readwrite-primary",t$jscomp$1=>{const s$jscomp$0=e$jscomp$1.batch.keys(),i$jscomp$0=t$jscomp$2.ui.newChangeBuffer({trackRemovals:!0});return function(t$jscomp$0,e$jscomp$0,n,s){const i=n.batch,r$jscomp$0=i.keys();let o=pi.resolve();return r$jscomp$0.forEach(t=>{o=o.next(()=>s.getEntry(e$jscomp$0,t)).next(e=>{const r=n.docVersions.get(t);null!==r||L();0>e.version.compareTo(r)&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&
(e.setReadTime(n.commitVersion),s.addEntry(e)))})}),o.next(()=>t$jscomp$0.Bs.removeMutationBatch(e$jscomp$0,i))}(t$jscomp$2,t$jscomp$1,e$jscomp$1,i$jscomp$0).next(()=>i$jscomp$0.apply(t$jscomp$1)).next(()=>t$jscomp$2.Bs.performConsistencyCheck(t$jscomp$1)).next(()=>t$jscomp$2.ci.Ks(t$jscomp$1,s$jscomp$0))})}function oo(t$jscomp$0){return t$jscomp$0.persistence.runTransaction("Get last remote snapshot version","readonly",t=>t$jscomp$0.fs.getLastRemoteSnapshotVersion(t))}function uo(t$jscomp$1,e$jscomp$1){const s$jscomp$0=
e$jscomp$1.snapshotVersion;let i=t$jscomp$1.ii;return t$jscomp$1.persistence.runTransaction("Apply remote event","readwrite-primary",t$jscomp$0=>{const r$jscomp$0=t$jscomp$1.ui.newChangeBuffer({trackRemovals:!0});i=t$jscomp$1.ii;const o=[];e$jscomp$1.targetChanges.forEach((r,u)=>{const a=i.get(u);if(a){o.push(t$jscomp$1.fs.removeMatchingKeys(t$jscomp$0,r.removedDocuments,u).next(()=>t$jscomp$1.fs.addMatchingKeys(t$jscomp$0,r.addedDocuments,u)));var c=a.withSequenceNumber(t$jscomp$0.currentSequenceNumber);
e$jscomp$1.targetMismatches.has(u)?c=c.withResumeToken(pt.EMPTY_BYTE_STRING,ct.min()).withLastLimboFreeSnapshotVersion(ct.min()):0<r.resumeToken.approximateByteSize()&&(c=c.withResumeToken(r.resumeToken,s$jscomp$0));i=i.insert(u,c);(function(t,e,n){return 0===t.resumeToken.approximateByteSize()||3E8<=e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()?!0:0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size})(a,c,r)&&o.push(t$jscomp$1.fs.updateTargetData(t$jscomp$0,
c))}});let u$jscomp$0=Qn;if(e$jscomp$1.documentUpdates.forEach(s=>{e$jscomp$1.resolvedLimboDocuments.has(s)&&o.push(t$jscomp$1.persistence.referenceDelegate.updateLimboDocument(t$jscomp$0,s))}),o.push(ao(t$jscomp$0,r$jscomp$0,e$jscomp$1.documentUpdates).next(t=>{u$jscomp$0=t})),!s$jscomp$0.isEqual(ct.min())){const e$jscomp$0=t$jscomp$1.fs.getLastRemoteSnapshotVersion(t$jscomp$0).next(e=>t$jscomp$1.fs.setTargetsMetadata(t$jscomp$0,t$jscomp$0.currentSequenceNumber,s$jscomp$0));o.push(e$jscomp$0)}return pi.waitFor(o).next(()=>
r$jscomp$0.apply(t$jscomp$0)).next(()=>t$jscomp$1.ci.Gs(t$jscomp$0,u$jscomp$0)).next(()=>u$jscomp$0)}).then(t=>(t$jscomp$1.ii=i,t))}function ao(t$jscomp$0,e,n$jscomp$0){let s$jscomp$0=Xn();return n$jscomp$0.forEach(t=>s$jscomp$0=s$jscomp$0.add(t)),e.getEntries(t$jscomp$0,s$jscomp$0).next(t=>{let s=Qn;return n$jscomp$0.forEach((n,i)=>{const r=t.get(n);i.isNoDocument()&&i.version.isEqual(ct.min())?(e.removeEntry(n,i.readTime),s=s.insert(n,i)):!r.isValidDocument()||0<i.version.compareTo(r.version)||
0===i.version.compareTo(r.version)&&r.hasPendingWrites?(e.addEntry(i),s=s.insert(n,i)):O("LocalStore","Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)}),s})}function co(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),t$jscomp$0.Bs.getNextMutationBatchAfterBatchId(t,e)))}function ho(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Allocate target","readwrite",t=>{let s;
return t$jscomp$0.fs.getTargetData(t,e).next(i$jscomp$0=>i$jscomp$0?(s=i$jscomp$0,pi.resolve(s)):t$jscomp$0.fs.allocateTargetId(t).next(i=>(s=new ki(e,i,0,t.currentSequenceNumber),t$jscomp$0.fs.addTargetData(t,s).next(()=>s))))}).then(t=>{const s=t$jscomp$0.ii.get(t.targetId);return(null===s||0<t.snapshotVersion.compareTo(s.snapshotVersion))&&(t$jscomp$0.ii=t$jscomp$0.ii.insert(t.targetId,t),t$jscomp$0.ri.set(e,t.targetId)),t})}function lo(t$jscomp$0,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i=
t$jscomp$0.ii.get(e),r=n?"readwrite":"readwrite-primary";try{n||(yield t$jscomp$0.persistence.runTransaction("Release target",r,t=>t$jscomp$0.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Ri(t))throw t;O("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}t$jscomp$0.ii=t$jscomp$0.ii.remove(e);t$jscomp$0.ri.delete(i.target)})}function fo(t$jscomp$1,e$jscomp$0,n$jscomp$0){let i$jscomp$0=ct.min(),r=Xn();return t$jscomp$1.persistence.runTransaction("Execute query",
"readonly",t$jscomp$0=>function(t,e,n){const i=t.ri.get(n);return void 0!==i?pi.resolve(t.ii.get(i)):t.fs.getTargetData(e,n)}(t$jscomp$1,t$jscomp$0,Ge(e$jscomp$0)).next(e=>{if(e)return i$jscomp$0=e.lastLimboFreeSnapshotVersion,t$jscomp$1.fs.getMatchingKeysForTargetId(t$jscomp$0,e.targetId).next(t=>{r=t})}).next(()=>t$jscomp$1.si.Qs(t$jscomp$0,e$jscomp$0,n$jscomp$0?i$jscomp$0:ct.min(),n$jscomp$0?r:Xn())).next(t=>(mo(t$jscomp$1,Je(e$jscomp$0),t),{documents:t,li:r})))}function _o(t$jscomp$1,e){const s=
t$jscomp$1.fs,i=t$jscomp$1.ii.get(e);return i?Promise.resolve(i.target):t$jscomp$1.persistence.runTransaction("Get target data","readonly",t$jscomp$0=>s.Et(t$jscomp$0,e).next(t=>t?t.target:null))}function wo(t$jscomp$0,e){const s=t$jscomp$0.oi.get(e)||ct.min();return t$jscomp$0.persistence.runTransaction("Get new document changes","readonly",t=>t$jscomp$0.ui.getAllFromCollectionGroup(t,e,ae(s,-1),Number.MAX_SAFE_INTEGER)).then(t=>(mo(t$jscomp$0,e,t),t))}function mo(t$jscomp$0,e$jscomp$0,n){let s=
ct.min();n.forEach((t,e)=>{0<e.readTime.compareTo(s)&&(s=e.readTime)});t$jscomp$0.oi.set(e$jscomp$0,s)}function go(t$jscomp$0,e$jscomp$0,n$jscomp$0,s$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let r=Xn(),o=Qn;for(const t of n$jscomp$0){const n=e$jscomp$0.fi(t.metadata.name);t.document&&(r=r.add(n));const s=e$jscomp$0.di(t);s.setReadTime(e$jscomp$0._i(t.metadata.readTime));o=o.insert(n,s)}const u=t$jscomp$0.ui.newChangeBuffer({trackRemovals:!0}),a=yield ho(t$jscomp$0,
Ge(new Me(_t.fromString(`__bundle__/docs/${s$jscomp$0}`))));return t$jscomp$0.persistence.runTransaction("Apply bundle documents","readwrite",t=>ao(t,u,o).next(e=>(u.apply(t),e)).next(e=>t$jscomp$0.fs.removeMatchingKeysForTargetId(t,a.targetId).next(()=>t$jscomp$0.fs.addMatchingKeys(t,r,a.targetId)).next(()=>t$jscomp$0.ci.Gs(t,e)).next(()=>e)))})}function yo(t$jscomp$0,e,n=Xn()){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=yield ho(t$jscomp$0,Ge(Gi(e.bundledQuery)));return t$jscomp$0.persistence.runTransaction("Save named query",
"readwrite",t=>{var r=ms(e.readTime);if(0<=s.snapshotVersion.compareTo(r))return t$jscomp$0._s.saveNamedQuery(t,e);r=s.withResumeToken(pt.EMPTY_BYTE_STRING,r);return t$jscomp$0.ii=t$jscomp$0.ii.insert(r.targetId,r),t$jscomp$0.fs.updateTargetData(t,r).next(()=>t$jscomp$0.fs.removeMatchingKeysForTargetId(t,s.targetId)).next(()=>t$jscomp$0.fs.addMatchingKeys(t,n,s.targetId)).next(()=>t$jscomp$0._s.saveNamedQuery(t,e))})})}function Co(t,e,n){t=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&
(t+=`_${e.uid}`),t}function xo(t,e){return`firestore_targets_${t}_${e}`}function jo(){return"undefined"!=typeof document?document:null}function eu(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(cu(t))for(const e of t.du)yield e(!0)})}function nu(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(const e of t.du)yield e(!1)})}function su(t,e){t.lu.has(e.targetId)||(t.lu.set(e.targetId,e),au(t)?uu(t):Vu(t).xo()&&ru(t,e))}function iu(t,e){const s=Vu(t);t.lu.delete(e);
s.xo()&&(t.mu.Z(e),Vu(t).Wo(e));0===t.lu.size&&(s.xo()?s.Mo():cu(t)&&t.wu.set("Unknown"))}function ru(t,e){t.mu.Z(e.targetId);Vu(t).jo(e)}function uu(t){t.mu=new us({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.lu.get(e)||null});Vu(t).start();t.wu.ru()}function au(t){return cu(t)&&!Vu(t).Co()&&0<t.lu.size}function cu(t){return 0===t.fu.size}function lu(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.lu.forEach((e,n)=>{ru(t,e)})})}function fu(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.mu=
void 0;au(t)?(t.wu.au(e),uu(t)):t.wu.set("Unknown")})}function du(t$jscomp$0,e$jscomp$2,n$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t$jscomp$0.wu.set("Online"),e$jscomp$2 instanceof rs&&2===e$jscomp$2.state&&e$jscomp$2.cause)try{yield function(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const n=e.cause;for(const s of e.targetIds)t.lu.has(s)&&(yield t.remoteSyncer.rejectListen(s,n),t.lu.delete(s),t.mu.removeTarget(s))})}(t$jscomp$0,e$jscomp$2)}catch(n){O("RemoteStore",
"Failed to remove targets %s: %s ",e$jscomp$2.targetIds.join(","),n),yield _u(t$jscomp$0,n)}else if(e$jscomp$2 instanceof ss?t$jscomp$0.mu.ut(e$jscomp$2):e$jscomp$2 instanceof is?t$jscomp$0.mu._t(e$jscomp$2):t$jscomp$0.mu.ht(e$jscomp$2),!n$jscomp$1.isEqual(ct.min()))try{const e$jscomp$1=yield oo(t$jscomp$0.localStore);0<=n$jscomp$1.compareTo(e$jscomp$1)&&(yield function(t,e$jscomp$0){const n$jscomp$0=t.mu.yt(e$jscomp$0);return n$jscomp$0.targetChanges.forEach((n,s)=>{if(0<n.resumeToken.approximateByteSize()){const i=
t.lu.get(s);i&&t.lu.set(s,i.withResumeToken(n.resumeToken,e$jscomp$0))}}),n$jscomp$0.targetMismatches.forEach(e=>{const n=t.lu.get(e);n&&(t.lu.set(e,n.withResumeToken(pt.EMPTY_BYTE_STRING,n.snapshotVersion)),t.mu.Z(e),Vu(t).Wo(e),e=new ki(n.target,e,1,n.sequenceNumber),ru(t,e))}),t.remoteSyncer.applyRemoteEvent(n$jscomp$0)}(t$jscomp$0,n$jscomp$1))}catch(e){O("RemoteStore","Failed to raise snapshot:",e),yield _u(t$jscomp$0,e)}})}function _u(t,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(!Ri(e))throw e;
t.fu.add(1);yield nu(t);t.wu.set("Offline");n||(n=()=>oo(t.localStore));t.asyncQueue.enqueueRetryable(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){O("RemoteStore","Retrying IndexedDB access");yield n();t.fu.delete(1);yield eu(t)}))})}function wu(t,e){return e().catch(n=>_u(t,n,e))}function mu(t$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const n$jscomp$0=vu(t$jscomp$1);let s=0<t$jscomp$1.hu.length?t$jscomp$1.hu[t$jscomp$1.hu.length-1].batchId:-1;for(;gu(t$jscomp$1);)try{const t=
yield co(t$jscomp$1.localStore,s);if(null===t){0===t$jscomp$1.hu.length&&n$jscomp$0.Mo();break}s=t.batchId;var t$jscomp$0=t$jscomp$1,e=t;t$jscomp$0.hu.push(e);const n=vu(t$jscomp$0);n.xo()&&n.Ho&&n.Jo(e.mutations)}catch(t){yield _u(t$jscomp$1,t)}pu(t$jscomp$1)&&vu(t$jscomp$1).start()})}function gu(t){return cu(t)&&10>t.hu.length}function pu(t){return cu(t)&&!vu(t).Co()&&0<t.hu.length}function Tu(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){vu(t).Zo()})}function Eu(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=
vu(t);for(const n of t.hu)e.Jo(n.mutations)})}function Au(t,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=t.hu.shift(),i=xi.from(s,e,n);yield wu(t,()=>t.remoteSyncer.applySuccessfulWrite(i));yield mu(t)})}function Ru(t$jscomp$0,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){e$jscomp$0&&vu(t$jscomp$0).Ho&&(yield function(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(n$jscomp$0=e.code,On(n$jscomp$0)&&n$jscomp$0!==
G.ABORTED){const n=t.hu.shift();vu(t).ko();yield wu(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e));yield mu(t)}var n$jscomp$0})}(t$jscomp$0,e$jscomp$0));pu(t$jscomp$0)&&vu(t$jscomp$0).start()})}function Pu(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.asyncQueue.verifyOperationInProgress();O("RemoteStore","RemoteStore received new credentials");const s=cu(t);t.fu.add(3);yield nu(t);s&&t.wu.set("Unknown");yield t.remoteSyncer.handleCredentialChange(e);t.fu.delete(3);
yield eu(t)})}function bu(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?(t.fu.delete(2),yield eu(t)):e||(t.fu.add(2),yield nu(t),t.wu.set("Unknown"))})}function Vu(t$jscomp$0){return t$jscomp$0.gu||(t$jscomp$0.gu=function(t,e,n){return t.eu(),new Jo(e,t.bo,t.authCredentials,t.appCheckCredentials,t.M,n)}(t$jscomp$0.datastore,t$jscomp$0.asyncQueue,{Hr:lu.bind(null,t$jscomp$0),Yr:fu.bind(null,t$jscomp$0),Qo:du.bind(null,t$jscomp$0)}),t$jscomp$0.du.push(e=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?
(t$jscomp$0.gu.ko(),au(t$jscomp$0)?uu(t$jscomp$0):t$jscomp$0.wu.set("Unknown")):(yield t$jscomp$0.gu.stop(),t$jscomp$0.mu=void 0)}))),t$jscomp$0.gu}function vu(t$jscomp$0){return t$jscomp$0.yu||(t$jscomp$0.yu=function(t,e,n){return t.eu(),new Yo(e,t.bo,t.authCredentials,t.appCheckCredentials,t.M,n)}(t$jscomp$0.datastore,t$jscomp$0.asyncQueue,{Hr:Tu.bind(null,t$jscomp$0),Yr:Ru.bind(null,t$jscomp$0),Xo:Eu.bind(null,t$jscomp$0),Yo:Au.bind(null,t$jscomp$0)}),t$jscomp$0.du.push(e=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?
(t$jscomp$0.yu.ko(),yield mu(t$jscomp$0)):(yield t$jscomp$0.yu.stop(),0<t$jscomp$0.hu.length&&(O("RemoteStore",`Stopping write stream with ${t$jscomp$0.hu.length} pending writes`),t$jscomp$0.hu=[]))}))),t$jscomp$0.yu}function Du(t,e){if(F("AsyncQueue",`${e}: ${t}`),Ri(t))return new Q(G.UNAVAILABLE,`${e}: ${t}`);throw t;}function Ou(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s=e.query;let i=!1,r=t$jscomp$0.queries.get(s);if(r||(i=!0,r=new ku),i)try{r.Tu=yield t$jscomp$0.onListen(s)}catch(t){return s=
Du(t,`Initialization of query '${ze(e.query)}' failed`),void e.onError(s)}(t$jscomp$0.queries.set(s,r),r.listeners.push(e),e.Au(t$jscomp$0.onlineState),r.Tu)&&e.Ru(r.Tu)&&Lu(t$jscomp$0)})}function Fu(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=e.query;let i=!1;const r=t$jscomp$0.queries.get(s);if(r){const t=r.listeners.indexOf(e);0<=t&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return t$jscomp$0.queries.delete(s),t$jscomp$0.onUnlisten(s)})}function $u(t$jscomp$0,
e$jscomp$0){let s=!1;for(const t of e$jscomp$0)if(e$jscomp$0=t$jscomp$0.queries.get(t.query)){for(const e of e$jscomp$0.listeners)e.Ru(t)&&(s=!0);e$jscomp$0.Tu=t}s&&Lu(t$jscomp$0)}function Bu(t$jscomp$0,e,n){const i=t$jscomp$0.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);t$jscomp$0.queries.delete(e)}function Lu(t$jscomp$0){t$jscomp$0.Eu.forEach(t=>{t.next()})}function Qu(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}
function Xu(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var n=Va(t),r=n.ea.get(e);if(r){var s=r.targetId;n.sharedClientState.addLocalQueryTarget(s);n=r.view.Xu()}else s=yield ho(n.localStore,Ge(e)),n.isPrimaryClient&&su(n.remoteStore,s),r=n.sharedClientState.addLocalQueryTarget(s.targetId),s=s.targetId,n=yield Zu(n,e,s,"current"===r);return n})}function Zu(t$jscomp$1,e$jscomp$1,n$jscomp$1,s$jscomp$1){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$1.la=
(e$jscomp$0,n$jscomp$0,s$jscomp$0)=>function(t$jscomp$0,e,n,s){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let i=e.view.Gu(n);i.ni&&(i=yield fo(t$jscomp$0.localStore,e.query,!1).then(({documents:t})=>e.view.Gu(t,i)));var r=s&&s.targetChanges.get(e.targetId);r=e.view.applyChanges(i,t$jscomp$0.isPrimaryClient,r);return fa(t$jscomp$0,e.targetId,r.Hu),r.snapshot})}(t$jscomp$1,e$jscomp$0,n$jscomp$0,s$jscomp$0);var i$jscomp$0=yield fo(t$jscomp$1.localStore,e$jscomp$1,!0),r$jscomp$0=
new zu(e$jscomp$1,i$jscomp$0.li);i$jscomp$0=r$jscomp$0.Gu(i$jscomp$0.documents);const u=ns.createSynthesizedTargetChangeForCurrentChange(n$jscomp$1,s$jscomp$1&&"Offline"!==t$jscomp$1.onlineState);i$jscomp$0=r$jscomp$0.applyChanges(i$jscomp$0,t$jscomp$1.isPrimaryClient,u);fa(t$jscomp$1,n$jscomp$1,i$jscomp$0.Hu);r$jscomp$0=new Hu(e$jscomp$1,n$jscomp$1,r$jscomp$0);return t$jscomp$1.ea.set(e$jscomp$1,r$jscomp$0),t$jscomp$1.na.has(n$jscomp$1)?t$jscomp$1.na.get(n$jscomp$1).push(e$jscomp$1):t$jscomp$1.na.set(n$jscomp$1,
[e$jscomp$1]),i$jscomp$0.snapshot})}function ta(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=t$jscomp$0.ea.get(e),i=t$jscomp$0.na.get(s.targetId);if(1<i.length)return t$jscomp$0.na.set(s.targetId,i.filter(t=>!je(t,e))),void t$jscomp$0.ea.delete(e);t$jscomp$0.isPrimaryClient?(t$jscomp$0.sharedClientState.removeLocalQueryTarget(s.targetId),t$jscomp$0.sharedClientState.isActiveQueryTarget(s.targetId)||(yield lo(t$jscomp$0.localStore,s.targetId,!1).then(()=>{t$jscomp$0.sharedClientState.clearQueryState(s.targetId);
iu(t$jscomp$0.remoteStore,s.targetId);ha(t$jscomp$0,s.targetId)}).catch(Cr))):(ha(t$jscomp$0,s.targetId),yield lo(t$jscomp$0.localStore,s.targetId,!0))})}function ea(t$jscomp$4,e$jscomp$1,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s$jscomp$1=va(t$jscomp$4);try{const t$jscomp$3=yield function(t$jscomp$2,e$jscomp$0){const s$jscomp$0=at.now(),i$jscomp$0=e$jscomp$0.reduce((t,e)=>t.add(e.key),Xn());let r;return t$jscomp$2.persistence.runTransaction("Locally write mutations",
"readwrite",t$jscomp$1=>t$jscomp$2.ci.Ks(t$jscomp$1,i$jscomp$0).next(i=>{r=i;i=[];for(const t of e$jscomp$0){var t$jscomp$0=t,e=r.get(t.key);let n=null;for(const s of t$jscomp$0.fieldTransforms)t$jscomp$0=e.data.field(s.field),t$jscomp$0=on(s.transform,t$jscomp$0||null),null!=t$jscomp$0&&(null==n&&(n=te.empty()),n.set(s.field,t$jscomp$0));e=n||null;null!=e&&i.push(new Vn(t.key,e,ee(e.value.mapValue),yn.exists(!0)))}return t$jscomp$2.Bs.addMutationBatch(t$jscomp$1,s$jscomp$0,i,e$jscomp$0)})).then(t=>
(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r}))}(s$jscomp$1.localStore,e$jscomp$1);s$jscomp$1.sharedClientState.addPendingMutation(t$jscomp$3.batchId);(function(t,e,n){let s=t.ua[t.currentUser.toKey()];s||(s=new Bn(rt));s=s.insert(e,n);t.ua[t.currentUser.toKey()]=s})(s$jscomp$1,t$jscomp$3.batchId,n$jscomp$0);yield wa(s$jscomp$1,t$jscomp$3.changes);yield mu(s$jscomp$1.remoteStore)}catch(t){s$jscomp$1=Du(t,"Failed to persist write"),n$jscomp$0.reject(s$jscomp$1)}})}function na(t$jscomp$1,
e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{const t$jscomp$0=yield uo(t$jscomp$1.localStore,e$jscomp$0);e$jscomp$0.targetChanges.forEach((t,e)=>{if(e=t$jscomp$1.ra.get(e))1>=t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size||L(),0<t.addedDocuments.size?e.Zu=!0:0<t.modifiedDocuments.size?e.Zu||L():0<t.removedDocuments.size&&(e.Zu||L(),e.Zu=!1)});yield wa(t$jscomp$1,t$jscomp$0,e$jscomp$0)}catch(t){yield Cr(t)}})}function sa(t$jscomp$3,e$jscomp$0,
n$jscomp$0){if(t$jscomp$3.isPrimaryClient&&0===n$jscomp$0||!t$jscomp$3.isPrimaryClient&&1===n$jscomp$0){const t$jscomp$2=[];t$jscomp$3.ea.forEach((n,s)=>{n=s.view.Au(e$jscomp$0);n.snapshot&&t$jscomp$2.push(n.snapshot)});(function(t$jscomp$1,e){t$jscomp$1.onlineState=e;let s=!1;t$jscomp$1.queries.forEach((t$jscomp$0,n)=>{for(const t of n.listeners)t.Au(e)&&(s=!0)});s&&Lu(t$jscomp$1)})(t$jscomp$3.eventManager,e$jscomp$0);t$jscomp$2.length&&t$jscomp$3.ta.Qo(t$jscomp$2);t$jscomp$3.onlineState=e$jscomp$0;
t$jscomp$3.isPrimaryClient&&t$jscomp$3.sharedClientState.setOnlineState(e$jscomp$0)}}function ia(t$jscomp$0,e,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$0.sharedClientState.updateQueryState(e,"rejected",n$jscomp$0);var i=t$jscomp$0.ra.get(e);if(i=i&&i.key){var t=new Bn(xt.comparator);t=t.insert(i,ne.newNoDocument(i,ct.min()));const n=Xn().add(i);t=new es(ct.min(),new Map,new qn(rt),t,n);yield na(t$jscomp$0,t);t$jscomp$0.ia=t$jscomp$0.ia.remove(i);t$jscomp$0.ra.delete(e);
_a(t$jscomp$0)}else yield lo(t$jscomp$0.localStore,e,!1).then(()=>ha(t$jscomp$0,e,n$jscomp$0)).catch(Cr)})}function ra(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=e.batch.batchId;try{const t=yield ro(t$jscomp$0.localStore,e);ca(t$jscomp$0,s,null);aa(t$jscomp$0,s);t$jscomp$0.sharedClientState.updateMutationState(s,"acknowledged");yield wa(t$jscomp$0,t)}catch(t){yield Cr(t)}})}function oa(t$jscomp$2,e$jscomp$1,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{const t$jscomp$1=
yield function(t$jscomp$0,e$jscomp$0){return t$jscomp$0.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return t$jscomp$0.Bs.lookupMutationBatch(t,e$jscomp$0).next(e=>{null!==e||L();return s=e.keys(),t$jscomp$0.Bs.removeMutationBatch(t,e)}).next(()=>t$jscomp$0.Bs.performConsistencyCheck(t)).next(()=>t$jscomp$0.ci.Ks(t,s))})}(t$jscomp$2.localStore,e$jscomp$1);ca(t$jscomp$2,e$jscomp$1,n$jscomp$0);aa(t$jscomp$2,e$jscomp$1);t$jscomp$2.sharedClientState.updateMutationState(e$jscomp$1,
"rejected",n$jscomp$0);yield wa(t$jscomp$2,t$jscomp$1)}catch(n){yield Cr(n)}})}function ua(t$jscomp$2,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){cu(t$jscomp$2.remoteStore)||O("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{var t$jscomp$1=yield function(t$jscomp$0){return t$jscomp$0.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>t$jscomp$0.Bs.getHighestUnacknowledgedBatchId(t))}(t$jscomp$2.localStore);
if(-1===t$jscomp$1)return void e.resolve();const s=t$jscomp$2.aa.get(t$jscomp$1)||[];s.push(e);t$jscomp$2.aa.set(t$jscomp$1,s)}catch(t){t$jscomp$1=Du(t,"Initialization of waitForPendingWrites() operation failed"),e.reject(t$jscomp$1)}})}function aa(t$jscomp$0,e){(t$jscomp$0.aa.get(e)||[]).forEach(t=>{t.resolve()});t$jscomp$0.aa.delete(e)}function ca(t$jscomp$0,e,n){let i=t$jscomp$0.ua[t$jscomp$0.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e));t$jscomp$0.ua[t$jscomp$0.currentUser.toKey()]=
i}}function ha(t,e$jscomp$0,n=null){t.sharedClientState.removeLocalQueryTarget(e$jscomp$0);for(const s of t.na.get(e$jscomp$0))t.ea.delete(s),n&&t.ta.fa(s,n);(t.na.delete(e$jscomp$0),t.isPrimaryClient)&&t.oa.Pi(e$jscomp$0).forEach(e=>{t.oa.containsKey(e)||la(t,e)})}function la(t,e){t.sa.delete(e.path.canonicalString());const n=t.ia.get(e);null!==n&&(iu(t.remoteStore,n),t.ia=t.ia.remove(e),t.ra.delete(n),_a(t))}function fa(t,e,n$jscomp$0){for(const s$jscomp$0 of n$jscomp$0)if(s$jscomp$0 instanceof
ju){t.oa.addReference(s$jscomp$0.key,e);n$jscomp$0=t;const n=s$jscomp$0.key,s=n.path.canonicalString();n$jscomp$0.ia.get(n)||n$jscomp$0.sa.has(s)||(O("SyncEngine","New document in limbo: "+n),n$jscomp$0.sa.add(s),_a(n$jscomp$0))}else s$jscomp$0 instanceof Wu?(O("SyncEngine","Document no longer in limbo: "+s$jscomp$0.key),t.oa.removeReference(s$jscomp$0.key,e),t.oa.containsKey(s$jscomp$0.key)||la(t,s$jscomp$0.key)):L()}function _a(t){for(;0<t.sa.size&&t.ia.size<t.maxConcurrentLimboResolutions;){var e=
t.sa.values().next().value;t.sa.delete(e);e=new xt(_t.fromString(e));const s=t.ca.next();t.ra.set(s,new Ju(e));t.ia=t.ia.insert(e,s);su(t.remoteStore,new ki(Ge(new Me(e.path)),s,2,nt.A))}}function wa(t$jscomp$2,e$jscomp$1,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i=[],r=[],o=[];t$jscomp$2.ea.isEmpty()||(t$jscomp$2.ea.forEach((t$jscomp$0,u)=>{o.push(t$jscomp$2.la(u,e$jscomp$1,n).then(t=>{t&&(t$jscomp$2.isPrimaryClient&&t$jscomp$2.sharedClientState.updateQueryState(u.targetId,
t.fromCache?"not-current":"current"),i.push(t),t=to.Ys(u.targetId,t),r.push(t))}))}),yield Promise.all(o),t$jscomp$2.ta.Qo(i),yield function(t$jscomp$1,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{yield t$jscomp$1.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>pi.forEach(e$jscomp$0,e=>pi.forEach(e.Hs,s=>t$jscomp$1.persistence.referenceDelegate.addReference(t,e.targetId,s)).next(()=>pi.forEach(e.Js,s=>t$jscomp$1.persistence.referenceDelegate.removeReference(t,
e.targetId,s)))))}catch(t){if(!Ri(t))throw t;O("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e$jscomp$0){const e=t.targetId;if(!t.fromCache){var t$jscomp$0=t$jscomp$1.ii.get(e);t$jscomp$0=t$jscomp$0.withLastLimboFreeSnapshotVersion(t$jscomp$0.snapshotVersion);t$jscomp$1.ii=t$jscomp$1.ii.insert(e,t$jscomp$0)}}})}(t$jscomp$2.localStore,r))})}function ma(t$jscomp$3,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(!t$jscomp$3.currentUser.isEqual(e$jscomp$0)){O("SyncEngine",
"User change. New user:",e$jscomp$0.toKey());const t$jscomp$2=yield io(t$jscomp$3.localStore,e$jscomp$0);t$jscomp$3.currentUser=e$jscomp$0;(function(t$jscomp$1,e){t$jscomp$1.aa.forEach(t$jscomp$0=>{t$jscomp$0.forEach(t=>{t.reject(new Q(G.CANCELLED,e))})});t$jscomp$1.aa.clear()})(t$jscomp$3,"'waitForPendingWrites' promise is rejected due to a user change.");t$jscomp$3.sharedClientState.handleUserChange(e$jscomp$0,t$jscomp$2.removedBatchIds,t$jscomp$2.addedBatchIds);yield wa(t$jscomp$3,t$jscomp$2.hi)}})}
function ga(t,e$jscomp$0){var s=t.ra.get(e$jscomp$0);if(s&&s.Zu)return Xn().add(s.key);s=Xn();e$jscomp$0=t.na.get(e$jscomp$0);if(!e$jscomp$0)return s;for(const e of e$jscomp$0)e$jscomp$0=t.ea.get(e),s=s.unionWith(e$jscomp$0.view.Ku);return s}function ya(t,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s=yield fo(t.localStore,e.query,!0);s=e.view.Yu(s);return t.isPrimaryClient&&fa(t,e.targetId,s.Hu),s})}function pa(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return wo(t$jscomp$0.localStore,
e).then(t=>wa(t$jscomp$0,t))})}function Ia(t$jscomp$1,e$jscomp$1,n,s$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const r=yield function(t$jscomp$0,e$jscomp$0){const s=t$jscomp$0.Bs;return t$jscomp$0.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.fn(t,e$jscomp$0).next(e=>e?t$jscomp$0.ci.Ks(t,e):pi.resolve(null)))}(t$jscomp$1.localStore,e$jscomp$1);null!==r?("pending"===n?yield mu(t$jscomp$1.remoteStore):"acknowledged"===n||"rejected"===n?(ca(t$jscomp$1,
e$jscomp$1,s$jscomp$0||null),aa(t$jscomp$1,e$jscomp$1),t$jscomp$1.localStore.Bs._n(e$jscomp$1)):L(),yield wa(t$jscomp$1,r)):O("SyncEngine","Cannot apply mutation batch with id: "+e$jscomp$1)})}function Ta(t$jscomp$3,e$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(Va(t$jscomp$3),va(t$jscomp$3),!0===e$jscomp$0&&!0!==t$jscomp$3.ha){var t$jscomp$2=t$jscomp$3.sharedClientState.getAllActiveQueryTargets();t$jscomp$2=yield Ea(t$jscomp$3,t$jscomp$2.toArray());t$jscomp$3.ha=!0;
yield bu(t$jscomp$3.remoteStore,!0);for(const t of t$jscomp$2)su(t$jscomp$3.remoteStore,t)}else if(!1===e$jscomp$0&&!1!==t$jscomp$3.ha){const t$jscomp$1=[];let e=Promise.resolve();t$jscomp$3.na.forEach((s,i)=>{t$jscomp$3.sharedClientState.isLocalQueryTarget(i)?t$jscomp$1.push(i):e=e.then(()=>(ha(t$jscomp$3,i),lo(t$jscomp$3.localStore,i,!0)));iu(t$jscomp$3.remoteStore,i)});yield e;yield Ea(t$jscomp$3,t$jscomp$1);(function(t$jscomp$0){t$jscomp$0.ra.forEach((t,n)=>{iu(t$jscomp$0.remoteStore,n)});t$jscomp$0.oa.bi();
t$jscomp$0.ra=new Map;t$jscomp$0.ia=new Bn(xt.comparator)})(t$jscomp$3);t$jscomp$3.ha=!1;yield bu(t$jscomp$3.remoteStore,!1)}})}function Ea(t$jscomp$1,e$jscomp$0,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i=[],r=[];for(const t$jscomp$0 of e$jscomp$0){let e;var n=t$jscomp$1.na.get(t$jscomp$0);if(n&&0!==n.length){e=yield ho(t$jscomp$1.localStore,Ge(n[0]));for(const t of n)n=t$jscomp$1.ea.get(t),n=yield ya(t$jscomp$1,n),n.snapshot&&r.push(n.snapshot)}else n=yield _o(t$jscomp$1.localStore,
t$jscomp$0),e=yield ho(t$jscomp$1.localStore,n),yield Zu(t$jscomp$1,Aa(n),t$jscomp$0,!1);i.push(e)}return t$jscomp$1.ta.Qo(r),i})}function Aa(t){return new Me(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ra(t){return t.localStore.persistence.Fs()}function Pa(t,e,n,s$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t.ha)return void O("SyncEngine","Ignoring unexpected query state notification.");var r=t.na.get(e);if(r&&0<r.length)switch(n){case "current":case "not-current":r=
yield wo(t.localStore,Je(r[0]));const s=es.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);yield wa(t,r,s);break;case "rejected":yield lo(t.localStore,e,!0);ha(t,e,s$jscomp$0);break;default:L()}})}function ba(t$jscomp$0,e$jscomp$0,n$jscomp$0){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=Va(t$jscomp$0);if(s.ha){for(const t of e$jscomp$0){if(s.na.has(t)){O("SyncEngine","Adding an already active target "+t);continue}const e=yield _o(s.localStore,t),n=yield ho(s.localStore,
e);yield Zu(s,Aa(e),n.targetId,!1);su(s.remoteStore,n)}for(const t of n$jscomp$0)s.na.has(t)&&(yield lo(s.localStore,t,!1).then(()=>{iu(s.remoteStore,t);ha(s,t)}).catch(Cr))}})}function Va(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=na.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ga.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=ia.bind(null,t),t.ta.Qo=$u.bind(null,t.eventManager),t.ta.fa=Bu.bind(null,t.eventManager),t}function va(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=
ra.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=oa.bind(null,t),t}function Sa(t$jscomp$2,e$jscomp$1,n$jscomp$0){(function(t$jscomp$1,e$jscomp$0,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{const s$jscomp$0=yield e$jscomp$0.getMetadata();if(yield function(t$jscomp$0,e){const s=ms(e.createTime);return t$jscomp$0.persistence.runTransaction("hasNewerBundle","readonly",t=>t$jscomp$0._s.getBundleMetadata(t,e.id)).then(t=>!!t&&0<=t.createTime.compareTo(s))}(t$jscomp$1.localStore,
s$jscomp$0))return yield e$jscomp$0.close(),n._completeWith({taskState:"Success",documentsLoaded:s$jscomp$0.totalDocuments,bytesLoaded:s$jscomp$0.totalBytes,totalDocuments:s$jscomp$0.totalDocuments,totalBytes:s$jscomp$0.totalBytes}),Promise.resolve(new Set);n._updateProgress(Qu(s$jscomp$0));const i=new Gu(s$jscomp$0,t$jscomp$1.localStore,e$jscomp$0.M);let r=yield e$jscomp$0.da();for(;r;){const t=yield i.ku(r);t&&n._updateProgress(t);r=yield e$jscomp$0.da()}const o=yield i.complete();return yield wa(t$jscomp$1,
o.Fu,void 0),yield function(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Save bundle","readwrite",t=>t$jscomp$0._s.saveBundleMetadata(t,e))}(t$jscomp$1.localStore,s$jscomp$0),n._completeWith(o.progress),Promise.resolve(o.Ou)}catch(t){return $("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})})(t$jscomp$2,e$jscomp$1,n$jscomp$0).then(t=>{t$jscomp$2.sharedClientState.notifyBundleLoaded(t)})}function ka(t,e=10240){let n=0;return{read(){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(n<
t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}})},cancel(){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){})},releaseLock(){},closed:Promise.reject("unimplemented")}}function La(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$0.asyncQueue.verifyOperationInProgress();O("FirestoreClient","Initializing OfflineComponentProvider");const n=yield t$jscomp$0.getConfiguration();yield e.initialize(n);let s=n.initialUser;
t$jscomp$0.setCredentialChangeListener(t=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){s.isEqual(t)||(yield io(e.localStore,t),s=t)}));e.persistence.setDatabaseDeletedListener(()=>t$jscomp$0.terminate());t$jscomp$0.offlineComponents=e})}function Ua(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t$jscomp$0.asyncQueue.verifyOperationInProgress();const n$jscomp$0=yield qa(t$jscomp$0);O("FirestoreClient","Initializing OnlineComponentProvider");const s=yield t$jscomp$0.getConfiguration();
yield e.initialize(n$jscomp$0,s);t$jscomp$0.setCredentialChangeListener(t=>Pu(e.remoteStore,t));t$jscomp$0.setAppCheckTokenChangeListener((t,n)=>Pu(e.remoteStore,n));t$jscomp$0.onlineComponents=e})}function qa(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return t.offlineComponents||(O("FirestoreClient","Using default OfflineComponentProvider"),yield La(t,new Da)),t.offlineComponents})}function Ka(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return t.onlineComponents||
(O("FirestoreClient","Using default OnlineComponentProvider"),yield Ua(t,new Na)),t.onlineComponents})}function Ga(t$jscomp$0){return qa(t$jscomp$0).then(t=>t.persistence)}function Qa(t$jscomp$0){return qa(t$jscomp$0).then(t=>t.localStore)}function ja(t$jscomp$0){return Ka(t$jscomp$0).then(t=>t.remoteStore)}function Wa(t$jscomp$0){return Ka(t$jscomp$0).then(t=>t.syncEngine)}function za(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=yield Ka(t),n=e.eventManager;return n.onListen=
Xu.bind(null,e.syncEngine),n.onUnlisten=ta.bind(null,e.syncEngine),n})}function Ha(t){return t.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=yield Ga(t),n=yield ja(t);e.setNetworkEnabled(!0);return n.fu.delete(0),eu(n)}))}function Ja(t$jscomp$0){return t$jscomp$0.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const e=yield Ga(t$jscomp$0),n=yield ja(t$jscomp$0);return e.setNetworkEnabled(!1),function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.fu.add(0);
yield nu(t);t.wu.set("Offline")})}(n)}))}function Ya(t$jscomp$2,e$jscomp$1){const n$jscomp$0=new j;return t$jscomp$2.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$1,e$jscomp$0,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{var s=yield function(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("read document","readonly",t=>t$jscomp$0.ci.Ls(t,e))}(t$jscomp$1,e$jscomp$0);s.isFoundDocument()?n.resolve(s):
s.isNoDocument()?n.resolve(null):n.reject(new Q(G.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){s=Du(t,`Failed to get document '${e$jscomp$0} from cache`),n.reject(s)}})}(yield Qa(t$jscomp$2),e$jscomp$1,n$jscomp$0)})),n$jscomp$0.promise}function Xa(t$jscomp$1,e$jscomp$0,n$jscomp$0={}){const s$jscomp$0=new j;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e,n,s,i){const r$jscomp$0=new Ma({next:r=>{e.enqueueAndForget(()=>Fu(t$jscomp$0,o));const u=r.docs.has(n);!u&&r.fromCache?i.reject(new Q(G.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&r.fromCache&&s&&"server"===s.source?i.reject(new Q(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):
i.resolve(r)},error:t=>i.reject(t)}),o=new Uu(new Me(n.path),r$jscomp$0,{includeMetadataChanges:!0,Cu:!0});return Ou(t$jscomp$0,o)}(yield za(t$jscomp$1),t$jscomp$1.asyncQueue,e$jscomp$0,n$jscomp$0,s$jscomp$0)})),s$jscomp$0.promise}function Za(t$jscomp$1,e$jscomp$0){const n$jscomp$0=new j;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e,n){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{var s=
yield fo(t$jscomp$0,e,!0);const i=new zu(e,s.li),r=i.Gu(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){s=Du(t,`Failed to execute query '${e} against cache`),n.reject(s)}})}(yield Qa(t$jscomp$1),e$jscomp$0,n$jscomp$0)})),n$jscomp$0.promise}function tc(t$jscomp$1,e$jscomp$0,n$jscomp$1={}){const s$jscomp$0=new j;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e,n$jscomp$0,s,i){const r=new Ma({next:n=>
{e.enqueueAndForget(()=>Fu(t$jscomp$0,o));n.fromCache&&"server"===s.source?i.reject(new Q(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Uu(n$jscomp$0,r,{includeMetadataChanges:!0,Cu:!0});return Ou(t$jscomp$0,o)}(yield za(t$jscomp$1),t$jscomp$1.asyncQueue,e$jscomp$0,n$jscomp$1,s$jscomp$0)})),s$jscomp$0.promise}function ec(t,
e){const n=new Ma(e);return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){(yield za(t)).Eu.add(n);n.next()})),()=>{n.Ia();t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){(yield za(t)).Eu.delete(n)}))}}function nc(t$jscomp$1,e){const n=new j;return t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=yield function(t$jscomp$0){return Ka(t$jscomp$0).then(t=>
t.datastore)}(t$jscomp$1);(new $a(t$jscomp$1.asyncQueue,s,e,n)).run()})),n.promise}function sc(t$jscomp$1,e$jscomp$1,n,s){const i=function(t$jscomp$0,e$jscomp$0){return function(t,e){return new Oa(t,e)}(function(t,e){if(t instanceof Uint8Array)return ka(t,e);if(t instanceof ArrayBuffer)return ka(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream");}("string"==typeof t$jscomp$0?(new TextEncoder).encode(t$jscomp$0):
t$jscomp$0),e$jscomp$0)}(n,new fs(e$jscomp$1,!0));t$jscomp$1.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){Sa(yield Wa(t$jscomp$1),i,s)}))}function ic(t$jscomp$1,e$jscomp$0){return t$jscomp$1.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return function(t$jscomp$0,e){return t$jscomp$0.persistence.runTransaction("Get named query","readonly",t=>t$jscomp$0._s.getNamedQuery(t,e))}(yield Qa(t$jscomp$1),e$jscomp$0)}))}function oc(t,
e,n){if(!n)throw new Q(G.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`);}function uc(t,e,n,s){if(!0===e&&!0===s)throw new Q(G.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`);}function ac(t){if(!xt.isDocumentKey(t))throw new Q(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`);}function cc(t){if(xt.isDocumentKey(t))throw new Q(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`);
}function hc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";t=t.constructor?t.constructor.name:null;return t?`a custom ${t} object`:"an object"}return"function"==typeof t?"a function":L()}function lc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Q(G.INVALID_ARGUMENT,
"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=hc(t);throw new Q(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`);}return t}function fc(t,e){if(0>=e)throw new Q(G.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`);}function Tc(t,e,...n){if(t=(0,_util.getModularInstance)(t),1===arguments.length&&(e=it.R()),oc("doc","path",e),t instanceof _c)return n=_t.fromString(e,...n),ac(n),new mc(t,null,new xt(n));
if(!(t instanceof mc||t instanceof yc))throw new Q(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=t._path.child(_t.fromString(e,...n));return ac(n),new mc(t.firestore,t instanceof yc?t.converter:null,new xt(n))}function Ac(t,e){return t=(0,_util.getModularInstance)(t),e=(0,_util.getModularInstance)(e),t instanceof gc&&e instanceof gc&&t.firestore===e.firestore&&je(t._query,e._query)&&t.converter===e.converter}function Pc(t$jscomp$0){a:{var e=
["next","error","complete"];if("object"==typeof t$jscomp$0&&null!==t$jscomp$0)for(const t of e)if(t in t$jscomp$0&&"function"==typeof t$jscomp$0[t]){t$jscomp$0=!0;break a}t$jscomp$0=!1}return t$jscomp$0}function Cc(t){return t._firestoreClient||xc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function xc(t){var e;const n=t._freezeSettings();var e$jscomp$0=(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"";e=new Vt(t._databaseId,e$jscomp$0,t._persistenceKey,n.host,n.ssl,n.experimentalForceLongPolling,
n.experimentalAutoDetectLongPolling,n.useFetchStreams);t._firestoreClient=new Ba(t._authCredentials,t._appCheckCredentials,t._queue,e)}function Mc(t$jscomp$0,e,n){const s=new j;return t$jscomp$0.asyncQueue.enqueue(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{yield La(t$jscomp$0,n),yield Ua(t$jscomp$0,e),s.resolve()}catch(t){var JSCompiler_inline_result="FirebaseError"===t.name?t.code===G.FAILED_PRECONDITION||t.code===G.UNIMPLEMENTED:"undefined"!=typeof DOMException&&t instanceof
DOMException?22===t.code||20===t.code||11===t.code:!0;if(!JSCompiler_inline_result)throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t);s.reject(t)}})).then(()=>s.promise)}function Kc(t){if(t._initialized||t._terminated)throw new Q(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");}function Xc(t){switch(t){case 0:case 2:case 1:return!0;
case 3:case 4:return!1;default:throw L();}}function eh(t){const e=t._freezeSettings(),n=new fs(t._databaseId,!0);return new th(t._databaseId,!!e.ignoreUndefinedProperties,n)}function nh(t$jscomp$0,e,n,s$jscomp$0,i,r={}){t$jscomp$0=t$jscomp$0.ac(r.merge||r.mergeFields?2:0,e,n,i);wh("Data must be an object, but it was:",t$jscomp$0,s$jscomp$0);s$jscomp$0=dh(s$jscomp$0,t$jscomp$0);let a;if(r.merge)a=new gt(t$jscomp$0.fieldMask),e=t$jscomp$0.fieldTransforms;else if(r.mergeFields){i=[];for(const s of r.mergeFields){r=
mh(e,s,n);if(!t$jscomp$0.contains(r))throw new Q(G.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Ih(i,r)||i.push(r)}a=new gt(i);e=t$jscomp$0.fieldTransforms.filter(t=>a.covers(t.field))}else a=null,e=t$jscomp$0.fieldTransforms;return new Jc(new te(s$jscomp$0),a,e)}function ih(t,e,n){return new Zc({Xa:3,uc:e.settings.uc,methodName:t._methodName,ec:n},e.databaseId,e.M,e.ignoreUndefinedProperties)}function ch(t$jscomp$0,e,n,s$jscomp$0){const i=t$jscomp$0.ac(1,
e,n);wh("Data must be an object, but it was:",i,s$jscomp$0);const r=[],o=te.empty();lt(s$jscomp$0,(t,s)=>{t=yh(e,t,n);s=(0,_util.getModularInstance)(s);const a=i.sc(t);s instanceof sh?r.push(t):(s=fh(s,a),null!=s&&(r.push(t),o.set(t,s)))});t$jscomp$0=new gt(r);return new Yc(o,t$jscomp$0,i.fieldTransforms)}function hh(t,e$jscomp$0,n$jscomp$0,s$jscomp$0,i,r){t=t.ac(1,e$jscomp$0,n$jscomp$0);n$jscomp$0=[mh(e$jscomp$0,s$jscomp$0,n$jscomp$0)];i=[i];if(0!=r.length%2)throw new Q(G.INVALID_ARGUMENT,`Function ${e$jscomp$0}() needs to be called with an even number of arguments that alternate between field names and values.`);
for(s$jscomp$0=0;s$jscomp$0<r.length;s$jscomp$0+=2)n$jscomp$0.push(mh(e$jscomp$0,r[s$jscomp$0])),i.push(r[s$jscomp$0+1]);r=[];e$jscomp$0=te.empty();for(s$jscomp$0=n$jscomp$0.length-1;0<=s$jscomp$0;--s$jscomp$0)if(!Ih(r,n$jscomp$0[s$jscomp$0])){const e=n$jscomp$0[s$jscomp$0];var n=i[s$jscomp$0];n=(0,_util.getModularInstance)(n);const s=t.sc(e);n instanceof sh?r.push(e):(n=fh(n,s),null!=n&&(r.push(e),e$jscomp$0.set(e,n)))}n$jscomp$0=new gt(r);return new Yc(e$jscomp$0,n$jscomp$0,t.fieldTransforms)}function lh(t,
e,n,s=!1){return fh(n,t.ac(s?4:3,e))}function fh(t$jscomp$0,e$jscomp$0){if(_h(t$jscomp$0=(0,_util.getModularInstance)(t$jscomp$0)))return wh("Unsupported field value:",e$jscomp$0,t$jscomp$0),dh(t$jscomp$0,e$jscomp$0);if(t$jscomp$0 instanceof Wc)return function(t,e){if(!Xc(e.Xa))throw e.rc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.rc(`${t._methodName}() is not currently supported inside arrays`);(t=t._toFieldTransform(e))&&e.fieldTransforms.push(t)}(t$jscomp$0,
e$jscomp$0),null;if(void 0===t$jscomp$0&&e$jscomp$0.ignoreUndefinedProperties)return null;if(e$jscomp$0.path&&e$jscomp$0.fieldMask.push(e$jscomp$0.path),t$jscomp$0 instanceof Array){if(e$jscomp$0.settings.ec&&4!==e$jscomp$0.Xa)throw e$jscomp$0.rc("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t)t=fh(i,e.ic(s)),null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++;return{arrayValue:{values:n}}}(t$jscomp$0,e$jscomp$0)}return function(t,e){if(null===(t=(0,_util.getModularInstance)(t)))return{nullValue:"NULL_VALUE"};
if("number"==typeof t)return en(e.M,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date)return t=at.fromDate(t),{timestampValue:ds(e.M,t)};if(t instanceof at)return t=new at(t.seconds,1E3*Math.floor(t.nanoseconds/1E3)),{timestampValue:ds(e.M,t)};if(t instanceof zc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof jc)return{bytesValue:_s(e.M,t._byteString)};if(t instanceof mc){const n=e.databaseId,s=t.firestore._databaseId;
if(!s.isEqual(n))throw e.rc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:gs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.rc(`Unsupported field value: ${hc(t)}`);}(t$jscomp$0,e$jscomp$0)}function dh(t$jscomp$0,e){const n={};return ft(t$jscomp$0)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):lt(t$jscomp$0,(t,s)=>{s=fh(s,e.tc(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function _h(t){return!("object"!=
typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof at||t instanceof zc||t instanceof jc||t instanceof mc||t instanceof Wc)}function wh(t,e,n){var JSCompiler_temp;(JSCompiler_temp=!_h(n))||(JSCompiler_temp=!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n))));if(JSCompiler_temp)throw n=hc(n),"an object"===n?e.rc(t+" a custom object"):e.rc(t+" "+n);}function mh(t,e,n){if((e=(0,_util.getModularInstance)(e))instanceof Gc)return e._internalPath;
if("string"==typeof e)return yh(t,e);throw ph("Field path arguments must be of type string or ",t,!1,void 0,n);}function yh(t,e,n){if(0<=e.search(gh))throw ph(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return(new Gc(...e.split(".")))._internalPath}catch(s){throw ph(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n);}}function ph(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;e=`Function ${e}() called with invalid data`;
n&&(e+=" (via `toFirestore()`)");n="";return(r||o)&&(n+=" (found",r&&(n+=` in field ${s}`),o&&(n+=` in document ${i}`),n+=")"),new Q(G.INVALID_ARGUMENT,e+". "+t+n)}function Ih(t$jscomp$0,e){return t$jscomp$0.some(t=>t.isEqual(e))}function Ah(t,e){return"string"==typeof e?yh(t,e):e instanceof Gc?e._internalPath:e._delegate._internalPath}function vh(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function Dh(t){if(Be(t)&&0===t.explicitOrderBy.length)throw new Q(G.UNIMPLEMENTED,
"limitToLast() queries require specifying at least one orderBy() clause");}function jh(t$jscomp$0,e$jscomp$0,n$jscomp$1,s$jscomp$0){if(n$jscomp$1[0]=(0,_util.getModularInstance)(n$jscomp$1[0]),n$jscomp$1[0]instanceof Th)return function(t,e,n$jscomp$0,s,i){if(!s)throw new Q(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n$jscomp$0}().`);n$jscomp$0=[];for(const n of Ke(t))if(n.field.isKeyField())n$jscomp$0.push(qt(e,s.key));else{t=s.data.field(n.field);if(Rt(t))throw new Q(G.INVALID_ARGUMENT,
'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t)throw e=n.field.canonicalString(),new Q(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`);n$jscomp$0.push(t)}return new De(n$jscomp$0,i)}(t$jscomp$0._query,
t$jscomp$0.firestore._databaseId,e$jscomp$0,n$jscomp$1[0]._document,s$jscomp$0);const i$jscomp$0=eh(t$jscomp$0.firestore);return function(t,e,n,s,i,r$jscomp$0){const o=t.explicitOrderBy;if(i.length>o.length)throw new Q(G.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const u=[];for(let r=0;r<i.length;r++){var a=i[r];if(o[r].field.isKeyField()){if("string"!=typeof a)throw new Q(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof a}`);
if(null===t.collectionGroup&&-1!==a.indexOf("/"))throw new Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${a}' contains a slash.`);a=t.path.child(_t.fromString(a));if(!xt.isDocumentKey(a))throw new Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${a}' is not because it contains an odd number of segments.`);
a=new xt(a);u.push(qt(e,a))}else a=lh(n,s,a),u.push(a)}return new De(u,r$jscomp$0)}(t$jscomp$0._query,t$jscomp$0.firestore._databaseId,i$jscomp$0,e$jscomp$0,n$jscomp$1,s$jscomp$0)}function Wh(t,e,n){if("string"==typeof(n=(0,_util.getModularInstance)(n))){if(""===n)throw new Q(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(null===e.collectionGroup&&-1!==n.indexOf("/"))throw new Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);
e=e.path.child(_t.fromString(n));if(!xt.isDocumentKey(e))throw new Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${e}' is not because it has an odd number of segments (${e.length}).`);return qt(t,new xt(e))}if(n instanceof mc)return qt(t,n._key);throw new Q(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hc(n)}.`);
}function zh(t,e){if(!Array.isArray(t)||0===t.length)throw new Q(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(10<t.length)throw new Q(G.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);}function Hh(t,e,n){if(!n.isEqual(e))throw new Q(G.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`);
}function Yh(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}function tl(t,e){if((t=(0,_util.getModularInstance)(t)).firestore!==e)throw new Q(G.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function _l(t$jscomp$0,e$jscomp$0){return function(t,e){const n=new j;return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return ea(yield Wa(t),e,n)})),n.promise}(Cc(t$jscomp$0),
e$jscomp$0)}function wl(t,e,n){const s=n.docs.get(e._key),i=new nl(t);return new Ph(t,i,e._key,s,new Rh(n.hasPendingWrites,n.fromCache),e.converter)}function Pl(t,e){if("string"!=typeof t[e])throw new Q(G.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}var process=require("module$node_modules$process$browser");"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports._cast=lc;exports._debugAssert=function(t,e){t||L()};exports._isBase64Available=function(){return"undefined"!=
typeof atob};exports._logWarn=$;exports._setIndexConfiguration=function(t$jscomp$1,e$jscomp$0){Cc(lc(t$jscomp$1,vc));if("string"==typeof e$jscomp$0)try{var JSCompiler_temp=JSON.parse(e$jscomp$0)}catch(t){throw new Q(G.INVALID_ARGUMENT,"Failed to parse JSON:"+t.message);}else JSCompiler_temp=e$jscomp$0;e$jscomp$0=JSCompiler_temp;t$jscomp$1=[];if(Array.isArray(e$jscomp$0.indexes))for(const t$jscomp$0 of e$jscomp$0.indexes){e$jscomp$0=Pl(t$jscomp$0,"collectionGroup");JSCompiler_temp=[];if(Array.isArray(t$jscomp$0.fields))for(const e of t$jscomp$0.fields){const t=
yh("setIndexConfiguration",Pl(e,"fieldPath"));"CONTAINS"===e.arrayConfig?JSCompiler_temp.push(new oe(t,2)):"ASCENDING"===e.order?JSCompiler_temp.push(new oe(t,0)):"DESCENDING"===e.order&&JSCompiler_temp.push(new oe(t,1))}t$jscomp$1.push(new se(se.UNKNOWN_ID,e$jscomp$0,JSCompiler_temp,ue.empty()))}return Promise.resolve()};exports._validateIsNotUsedTogether=uc;exports.addDoc=function(t,e){const n=lc(t.firestore,vc),s=Tc(t);e=Yh(t.converter,e);return _l(n,[nh(eh(t.firestore),"addDoc",s._key,e,null!==
t.converter,{}).toMutation(s._key,yn.exists(!1))]).then(()=>s)};exports.arrayRemove=function(...t){return new uh("arrayRemove",t)};exports.arrayUnion=function(...t){return new oh("arrayUnion",t)};exports.clearIndexedDbPersistence=function(t$jscomp$0){if(t$jscomp$0._initialized&&!t$jscomp$0._terminated)throw new Q(G.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new j;return t$jscomp$0._queue.enqueueAndForgetEvenWhileRestricted(()=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{yield function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(!Ti.vt())return Promise.resolve();yield Ti.delete(t+"main")})}(Xr(t$jscomp$0._databaseId,t$jscomp$0._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise};exports.collection=function(t,e,...n){if(t=(0,_util.getModularInstance)(t),oc("collection","path",e),t instanceof _c)return e=_t.fromString(e,...n),cc(e),new yc(t,null,e);if(!(t instanceof mc||
t instanceof yc))throw new Q(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");e=t._path.child(_t.fromString(e,...n));return cc(e),new yc(t.firestore,null,e)};exports.collectionGroup=function(t,e){if(t=lc(t,_c),oc("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Q(G.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);e=new Me(_t.emptyPath(),
e);return new gc(t,null,e)};exports.connectFirestoreEmulator=function(t,e,n,s={}){var i;const r=(t=lc(t,_c))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&$("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){if("string"==typeof s.mockUserToken)e=s.mockUserToken,s=C.MOCK_USER;else{e=(0,_util.createMockUserToken)(s.mockUserToken,null===(i=t._app)||void 0===
i?void 0:i.options.projectId);s=s.mockUserToken.sub||s.mockUserToken.user_id;if(!s)throw new Q(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new C(s)}t._authCredentials=new H(new W(e,s))}};exports.deleteDoc=function(t){return _l(lc(t.firestore,vc),[new Cn(t._key,yn.none())])};exports.deleteField=function(){return new sh("deleteField")};exports.disableNetwork=function(t){return Ja(Cc(lc(t,vc)))};exports.doc=Tc;exports.documentId=function(){return new Gc("__name__")};
exports.enableIndexedDbPersistence=function(t,e){Kc(t=lc(t,vc));const n=Cc(t);t=t._freezeSettings();const i=new Na;return Mc(n,i,new Ca(i,t.cacheSizeBytes,null==e?void 0:e.forceOwnership))};exports.enableMultiTabIndexedDbPersistence=function(t){Kc(t=lc(t,vc));const e=Cc(t);t=t._freezeSettings();const s=new Na;return Mc(e,s,new xa(s,t.cacheSizeBytes))};exports.enableNetwork=function(t){return Ha(Cc(lc(t,vc)))};exports.endAt=function(...t){return new Kh("endAt",t,!0)};exports.endBefore=function(...t){return new Kh("endBefore",
t,!1)};exports.ensureFirestoreConfigured=Cc;exports.executeWrite=_l;exports.getDoc=function(t){t=lc(t,mc);const e=lc(t.firestore,vc);return Xa(Cc(e),t._key).then(n=>wl(e,t,n))};exports.getDocFromCache=function(t){t=lc(t,mc);const e=lc(t.firestore,vc),n$jscomp$0=Cc(e),s=new nl(e);return Ya(n$jscomp$0,t._key).then(n=>new Ph(e,s,t._key,n,new Rh(null!==n&&n.hasLocalMutations,!0),t.converter))};exports.getDocFromServer=function(t){t=lc(t,mc);const e=lc(t.firestore,vc);return Xa(Cc(e),t._key,{source:"server"}).then(n=>
wl(e,t,n))};exports.getDocs=function(t){t=lc(t,gc);const e=lc(t.firestore,vc),n$jscomp$0=Cc(e),s=new nl(e);return Dh(t._query),tc(n$jscomp$0,t._query).then(n=>new Vh(e,s,t,n))};exports.getDocsFromCache=function(t){t=lc(t,gc);const e=lc(t.firestore,vc),n$jscomp$0=Cc(e),s=new nl(e);return Za(n$jscomp$0,t._query).then(n=>new Vh(e,s,t,n))};exports.getDocsFromServer=function(t){t=lc(t,gc);const e=lc(t.firestore,vc),n$jscomp$0=Cc(e),s=new nl(e);return tc(n$jscomp$0,t._query,{source:"server"}).then(n=>new Vh(e,
s,t,n))};exports.getFirestore=function(e=(0,_app.getApp)()){return(0,_app._getProvider)(e,"firestore").getImmediate()};exports.increment=function(t){return new ah("increment",t)};exports.initializeFirestore=function(t,e){var n=(0,_app._getProvider)(t,"firestore");if(n.isInitialized()){t=n.getImmediate();n=n.getOptions();if((0,_util.deepEqual)(n,e))return t;throw new Q(G.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.");
}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&1048576>e.cacheSizeBytes)throw new Q(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e})};exports.limit=function(t){return fc("limit",t),new Fh("limit",t,"F")};exports.limitToLast=function(t){return fc("limitToLast",t),new Fh("limitToLast",t,"L")};exports.loadBundle=function(t,e){const n=Cc(t=lc(t,vc)),s=new bc;return sc(n,t._databaseId,e,s),s};exports.namedQuery=function(t,e$jscomp$0){return ic(Cc(t=
lc(t,vc)),e$jscomp$0).then(e=>e?new gc(t,null,e.query):null)};exports.onSnapshot=function(t$jscomp$0,...e$jscomp$0){var n$jscomp$0,s$jscomp$0,i$jscomp$0;t$jscomp$0=(0,_util.getModularInstance)(t$jscomp$0);var r$jscomp$0={includeMetadataChanges:!1};let o=0;"object"!=typeof e$jscomp$0[o]||Pc(e$jscomp$0[o])||(r$jscomp$0=e$jscomp$0[o],o++);r$jscomp$0={includeMetadataChanges:r$jscomp$0.includeMetadataChanges};if(Pc(e$jscomp$0[o])){const t=e$jscomp$0[o];e$jscomp$0[o]=null===(n$jscomp$0=t.next)||void 0===
n$jscomp$0?void 0:n$jscomp$0.bind(t);e$jscomp$0[o+1]=null===(s$jscomp$0=t.error)||void 0===s$jscomp$0?void 0:s$jscomp$0.bind(t);e$jscomp$0[o+2]=null===(i$jscomp$0=t.complete)||void 0===i$jscomp$0?void 0:i$jscomp$0.bind(t)}let c;if(t$jscomp$0 instanceof mc)c=lc(t$jscomp$0.firestore,vc),s$jscomp$0=new Me(t$jscomp$0._key.path),n$jscomp$0={next:n=>{e$jscomp$0[o]&&e$jscomp$0[o](wl(c,t$jscomp$0,n))},error:e$jscomp$0[o+1],complete:e$jscomp$0[o+2]};else{const n=lc(t$jscomp$0,gc);c=lc(n.firestore,vc);s$jscomp$0=
n._query;const s=new nl(c);n$jscomp$0={next:t=>{e$jscomp$0[o]&&e$jscomp$0[o](new Vh(c,s,n,t))},error:e$jscomp$0[o+1],complete:e$jscomp$0[o+2]};Dh(t$jscomp$0._query)}return function(t,e,n,s){const i=new Ma(s),r=new Uu(e,i,n);return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return Ou(yield za(t),r)})),()=>{i.Ia();t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return Fu(yield za(t),r)}))}}(Cc(c),s$jscomp$0,r$jscomp$0,
n$jscomp$0)};exports.onSnapshotsInSync=function(t,e){return ec(Cc(lc(t,vc)),Pc(e)?e:{next:e})};exports.orderBy=function(t,e="asc"){t=Ah("orderBy",t);return new Mh(t,e)};exports.query=function(t,...e){for(const n of e)t=n._apply(t);return t};exports.queryEqual=Ac;exports.refEqual=function(t,e){return t=(0,_util.getModularInstance)(t),e=(0,_util.getModularInstance)(e),(t instanceof mc||t instanceof yc)&&(e instanceof mc||e instanceof yc)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter};
exports.runTransaction=function(t,e){return nc(Cc(t=lc(t,vc)),n=>e(new ml(t,n)))};exports.serverTimestamp=function(){return new rh("serverTimestamp")};exports.setDoc=function(t,e,n){t=lc(t,mc);const s=lc(t.firestore,vc);e=Yh(t.converter,e,n);return _l(s,[nh(eh(s),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,yn.none())])};exports.setLogLevel=function(t){N.setLogLevel(t)};exports.snapshotEqual=function(t,e){return t instanceof Ph&&e instanceof Ph?t._firestore===e._firestore&&t._key.isEqual(e._key)&&
(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Vh&&e instanceof Vh&&t._firestore===e._firestore&&Ac(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)};exports.startAfter=function(...t){return new Lh("startAfter",t,!1)};exports.startAt=function(...t){return new Lh("startAt",t,!0)};exports.terminate=function(t){return(0,_app._removeServiceInstance)(t.app,"firestore"),t._delete()};exports.updateDoc=function(t,
e,n,...s){t=lc(t,mc);const i=lc(t.firestore,vc),r=eh(i);let o;o="string"==typeof(e=(0,_util.getModularInstance)(e))||e instanceof Gc?hh(r,"updateDoc",t._key,e,n,s):ch(r,"updateDoc",t._key,e);return _l(i,[o.toMutation(t._key,yn.exists(!0))])};exports.waitForPendingWrites=function(t$jscomp$0){return function(t){const e=new j;return t.asyncQueue.enqueueAndForget(()=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return ua(yield Wa(t),e)})),e.promise}(Cc(t$jscomp$0=lc(t$jscomp$0,vc)))};exports.where=
function(t,e,n){t=Ah("where",t);return new Nh(t,e,n)};exports.writeBatch=function(t){return Cc(t=lc(t,vc)),new Zh(t,e=>_l(t,e))};exports._FieldPath=exports._EmptyAuthCredentialsProvider=exports._EmptyAppCheckTokenProvider=exports._DocumentKey=exports._DatabaseId=exports.WriteBatch=exports.Transaction=exports.Timestamp=exports.SnapshotMetadata=exports.QuerySnapshot=exports.QueryDocumentSnapshot=exports.QueryConstraint=exports.Query=exports.LoadBundleTask=exports.GeoPoint=exports.FirestoreError=exports.Firestore=
exports.FieldValue=exports.FieldPath=exports.DocumentSnapshot=exports.DocumentReference=exports.CollectionReference=exports.CACHE_SIZE_UNLIMITED=exports.Bytes=exports.AbstractUserDataWriter=void 0;var _app=require("module$node_modules$$firebase$app$dist$esm$index_esm2017"),_component=require("module$node_modules$$firebase$component$dist$esm$index_esm2017"),_logger=require("module$node_modules$$firebase$logger$dist$index_cjs"),_util=require("module$node_modules$$firebase$util$dist$index_esm2017"),
_webchannelWrapper=require("module$node_modules$$firebase$webchannel_wrapper$dist$index");class C{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}C.UNAUTHENTICATED=new C(null);C.GOOGLE_CREDENTIALS=new C("google-credentials-uid");C.FIRST_PARTY=new C("first-party-uid");C.MOCK_USER=new C("mock-user");let x="9.6.11";const N=new _logger.Logger("@firebase/firestore"),G={OK:"ok",CANCELLED:"cancelled",
UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Q extends _util.FirebaseError{constructor(t,e){super(t,
e);this.code=t;this.message=e;this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}exports.FirestoreError=Q;class j{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t;this.reject=e})}}class W{constructor(t,e){this.user=e;this.type="OAuth";this.headers=new Map;this.headers.set("Authorization",`Bearer ${t}`)}}class z{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(C.UNAUTHENTICATED))}shutdown(){}}exports._EmptyAuthCredentialsProvider=
z;class H{constructor(t){this.token=t;this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e;t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class J{constructor(t){this.t=t;this.currentUser=C.UNAUTHENTICATED;this.i=0;this.forceRefresh=!1;this.auth=null}start(t$jscomp$0,e$jscomp$0){let n=this.i;const s=t=>this.i!==n?(n=this.i,e$jscomp$0(t)):Promise.resolve();let i=new j;this.o=()=>{this.i++;this.currentUser=
this.u();i.resolve();i=new j;t$jscomp$0.enqueueRetryable(()=>s(this.currentUser))};const r=()=>{const e=i;t$jscomp$0.enqueueRetryable(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield e.promise;yield s($jscomp$async$this.currentUser)})})},o=t=>{O("FirebaseAuthCredentialsProvider","Auth detected");this.auth=t;this.auth.addAuthTokenListener(this.o);r()};this.t.onInit(t=>o(t));setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});
t?o(t):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new j)}},0);r()}getToken(){const t=this.i,e$jscomp$0=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e$jscomp$0).then(e=>{this.i!==t?e=(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?("string"==typeof e.accessToken||L(),e=new W(e.accessToken,this.currentUser)):e=null;return e}):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&
this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();null===t||"string"==typeof t||L();return new C(t)}}class Y{constructor(t,e,n){this.type="FirstParty";this.user=C.FIRST_PARTY;this.headers=new Map;this.headers.set("X-Goog-AuthUser",e);(t=t.auth.getAuthHeaderValueForFirstParty([]))&&this.headers.set("Authorization",t);n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class X{constructor(t,e,n){this.h=t;this.l=e;this.m=n}getToken(){return Promise.resolve(new Y(this.h,
this.l,this.m))}start(t,e){t.enqueueRetryable(()=>e(C.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Z{constructor(t){this.value=t;this.type="AppCheck";this.headers=new Map;t&&0<t.length&&this.headers.set("x-firebase-appcheck",this.value)}}class tt{constructor(t){this.g=t;this.forceRefresh=!1;this.p=this.appCheck=null}start(t$jscomp$0,e$jscomp$0){const n$jscomp$0=t=>{null!=t.error&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);
const n=t.token!==this.p;return this.p=t.token,O("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e$jscomp$0(t.token):Promise.resolve()};this.o=e=>{t$jscomp$0.enqueueRetryable(()=>n$jscomp$0(e))};const s=t=>{O("FirebaseAppCheckTokenProvider","AppCheck detected");this.appCheck=t;this.appCheck.addTokenListener(this.o)};this.g.onInit(t=>s(t));setTimeout(()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?s(t):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},
0)}getToken(){const t$jscomp$0=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t$jscomp$0).then(t=>{t?("string"==typeof t.token||L(),t=(this.p=t.token,new Z(t.token))):t=null;return t}):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class et{getToken(){return Promise.resolve(new Z(""))}invalidateToken(){}start(t,e){}shutdown(){}}exports._EmptyAppCheckTokenProvider=et;class nt{constructor(t$jscomp$0,
e){this.previousValue=t$jscomp$0;e&&(e.sequenceNumberHandler=t=>this.I(t),this.T=t=>e.writeSequenceNumber(t))}I(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}nt.A=-1;class it{static R(){const e=62*Math.floor(256/62);let n="";for(;20>n.length;){var e$jscomp$0="undefined"!=typeof self&&(self.crypto||self.msCrypto),n$jscomp$0=new Uint8Array(40);if(e$jscomp$0&&"function"==typeof e$jscomp$0.getRandomValues)e$jscomp$0.getRandomValues(n$jscomp$0);
else for(e$jscomp$0=0;40>e$jscomp$0;e$jscomp$0++)n$jscomp$0[e$jscomp$0]=Math.floor(256*Math.random());for(e$jscomp$0=0;e$jscomp$0<n$jscomp$0.length;++e$jscomp$0)20>n.length&&n$jscomp$0[e$jscomp$0]<e&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n$jscomp$0[e$jscomp$0]%62))}return n}}class at{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,0>e)throw new Q(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1E9<=e)throw new Q(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+
e);if(-62135596800>t)throw new Q(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Q(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);}static now(){return at.fromMillis(Date.now())}static fromDate(t){return at.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1E3);return new at(e,Math.floor(1E6*(t-1E3*e)))}toDate(){return new Date(this.toMillis())}toMillis(){return 1E3*this.seconds+this.nanoseconds/1E6}_compareTo(t){return this.seconds===
t.seconds?rt(this.nanoseconds,t.nanoseconds):rt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds\x3d"+this.seconds+", nanoseconds\x3d"+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}exports.Timestamp=at;class ct{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ct(t)}static min(){return new ct(new at(0,
0))}static max(){return new ct(new at(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1E6*this.timestamp.seconds+this.timestamp.nanoseconds/1E3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class dt{constructor(t,e,n){void 0===e?e=0:e>t.length&&L();void 0===n?n=t.length-e:n>t.length-e&&L();this.segments=t;this.offset=e;this.len=
n}get length(){return this.len}isEqual(t){return 0===dt.comparator(this,t)}child(t$jscomp$0){const e=this.segments.slice(this.offset,this.limit());return t$jscomp$0 instanceof dt?t$jscomp$0.forEach(t=>{e.push(t)}):e.push(t$jscomp$0),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-
1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n$jscomp$0=
Math.min(t.length,e.length);for(let s=0;s<n$jscomp$0;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class _t extends dt{construct(t,e,n){return new _t(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t$jscomp$0){const e=[];for(const n of t$jscomp$0){if(0<=n.indexOf("//"))throw new Q(G.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);
e.push(...n.split("/").filter(t=>0<t.length))}return new _t(e)}static emptyPath(){return new _t([])}}const wt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mt extends dt{construct(t,e,n){return new mt(t,e,n)}static isValidIdentifier(t){return wt.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mt.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new mt(["__name__"])}static fromServerFormat(t){const e=
[];let n="",s=0;const i=()=>{if(0===n.length)throw new Q(G.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n);n=""};let r=!1;for(;s<t.length;){var e$jscomp$0=t[s];if("\\"===e$jscomp$0){if(s+1===t.length)throw new Q(G.INVALID_ARGUMENT,"Path has trailing escape character: "+t);e$jscomp$0=t[s+1];if("\\"!==e$jscomp$0&&"."!==e$jscomp$0&&"`"!==e$jscomp$0)throw new Q(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=
e$jscomp$0;s+=2}else"`"===e$jscomp$0?(r=!r,s++):"."!==e$jscomp$0||r?(n+=e$jscomp$0,s++):(i(),s++)}if(i(),r)throw new Q(G.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new mt(e)}static emptyPath(){return new mt([])}}exports._FieldPath=mt;class gt{constructor(t){this.fields=t;t.sort(mt.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t$jscomp$0){return ot(this.fields,t$jscomp$0.fields,(t,e)=>t.isEqual(e))}}class pt{constructor(t){this.binaryString=
t}static fromBase64String(t){t=atob(t);return new pt(t)}static fromUint8Array(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return new pt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){var t=this.binaryString;const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}approximateByteSize(){return 2*
this.binaryString.length}compareTo(t){return rt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const It=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);class Vt{constructor(t,e,n,s,i,r,o,u){this.databaseId=t;this.appId=e;this.persistenceKey=n;this.host=s;this.ssl=i;this.forceLongPolling=r;this.autoDetectLongPolling=o;this.useFetchStreams=u}}class vt{constructor(t,e){this.projectId=t;this.database=e||"(default)"}static empty(){return new vt("",
"")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof vt&&t.projectId===this.projectId&&t.database===this.database}}exports._DatabaseId=vt;class xt{constructor(t){this.path=t}static fromPath(t){return new xt(_t.fromString(t))}static fromName(t){return new xt(_t.fromString(t).popFirst(5))}static empty(){return new xt(_t.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return 2<=this.path.length&&this.path.get(this.path.length-
2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===_t.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return _t.comparator(t.path,e.path)}static isDocumentKey(t){return 0==t.length%2}static fromSegments(t){return new xt(new _t(t.slice()))}}exports._DocumentKey=xt;const Nt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},kt={nullValue:"NULL_VALUE"};class te{constructor(t){this.value=
t}static empty(){return new te({mapValue:{}})}field(t){if(t.isEmpty())return this.value;let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Wt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=zt(e)}setAll(t$jscomp$1){let e=mt.emptyPath(),n={},s=[];t$jscomp$1.forEach((t$jscomp$0,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s);n={};s=[];e=i.popLast()}t$jscomp$0?
n[i.lastSegment()]=zt(t$jscomp$0):s.push(i.lastSegment())});t$jscomp$1=this.getFieldsMap(e);this.applyChanges(t$jscomp$1,n,s)}delete(t){const e=this.field(t.popLast());Wt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ot(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Wt(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s);e=
s}return e.mapValue.fields}applyChanges(t,e$jscomp$0,n$jscomp$0){lt(e$jscomp$0,(e,n)=>t[e]=n);for(const e of n$jscomp$0)delete t[e]}clone(){return new te(zt(this.value))}}class ne{constructor(t,e,n,s,i,r){this.key=t;this.documentType=e;this.version=n;this.readTime=s;this.data=i;this.documentState=r}static newInvalidDocument(t){return new ne(t,0,ct.min(),ct.min(),te.empty(),0)}static newFoundDocument(t,e,n){return new ne(t,1,e,ct.min(),n,0)}static newNoDocument(t,e){return new ne(t,2,e,ct.min(),te.empty(),
0)}static newUnknownDocument(t,e){return new ne(t,3,e,ct.min(),te.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=te.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=te.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=
1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ne&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&
this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ne(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class se{constructor(t,e,n,s){this.indexId=t;this.collectionGroup=e;this.fields=n;this.indexState=s}}se.UNKNOWN_ID=
-1;class oe{constructor(t,e){this.fieldPath=t;this.kind=e}}class ue{constructor(t,e){this.sequenceNumber=t;this.offset=e}static empty(){return new ue(0,he.min())}}class he{constructor(t,e,n){this.readTime=t;this.documentKey=e;this.largestBatchId=n}static min(){return new he(ct.min(),xt.empty(),-1)}static max(){return new he(ct.max(),xt.empty(),-1)}}class fe{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t;this.collectionGroup=e;this.orderBy=n;this.filters=s;this.limit=i;this.startAt=
r;this.endAt=o;this.P=null}}class Te extends class{}{constructor(t,e,n){super();this.field=t;this.op=e;this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.V(t,e,n):new Ee(t,e,n):"array-contains"===e?new be(t,n):"in"===e?new Ve(t,n):"not-in"===e?new ve(t,n):"array-contains-any"===e?new Se(t,n):new Te(t,e,n)}static V(t,e,n){return"in"===e?new Ae(t,n):new Re(t,n)}matches(t){t=t.data.field(this.field);return"!\x3d"===this.op?null!==t&&this.v($t(t,this.value)):null!==t&&
Mt(this.value)===Mt(t)&&this.v($t(t,this.value))}v(t){switch(this.op){case "\x3c":return 0>t;case "\x3c\x3d":return 0>=t;case "\x3d\x3d":return 0===t;case "!\x3d":return 0!==t;case "\x3e":return 0<t;case "\x3e\x3d":return 0<=t;default:return L()}}S(){return 0<="\x3c \x3c\x3d \x3e \x3e\x3d !\x3d not-in".split(" ").indexOf(this.op)}}class Ee extends Te{constructor(t,e,n){super(t,e,n);this.key=xt.fromName(n.referenceValue)}matches(t){t=xt.comparator(t.key,this.key);return this.v(t)}}class Ae extends Te{constructor(t,
e){super(t,"in",e);this.keys=Pe("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Re extends Te{constructor(t,e){super(t,"not-in",e);this.keys=Pe("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}class be extends Te{constructor(t,e){super(t,"array-contains",e)}matches(t){t=t.data.field(this.field);return Gt(t)&&Ft(t.arrayValue,this.value)}}class Ve extends Te{constructor(t,e){super(t,"in",e)}matches(t){t=t.data.field(this.field);return null!==t&&Ft(this.value.arrayValue,
t)}}class ve extends Te{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ft(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!Ft(this.value.arrayValue,t)}}class Se extends Te{constructor(t,e){super(t,"array-contains-any",e)}matches(t$jscomp$0){t$jscomp$0=t$jscomp$0.data.field(this.field);return!(!Gt(t$jscomp$0)||!t$jscomp$0.arrayValue.values)&&t$jscomp$0.arrayValue.values.some(t=>Ft(this.value.arrayValue,t))}}class De{constructor(t,e){this.position=
t;this.inclusive=e}}class Ce{constructor(t,e="asc"){this.field=t;this.dir=e}}class Me{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,u=null){this.path=t;this.collectionGroup=e;this.explicitOrderBy=n;this.filters=s;this.limit=i;this.limitType=r;this.startAt=o;this.endAt=u;this.C=this.D=null;this.startAt;this.endAt}}class nn{constructor(){this._=void 0}}class un extends nn{}class an extends nn{constructor(t){super();this.elements=t}}class hn extends nn{constructor(t){super();this.elements=t}}class fn extends nn{constructor(t,
e){super();this.M=t;this.k=e}}class wn{constructor(t,e){this.field=t;this.transform=e}}class gn{constructor(t,e){this.version=t;this.transformResults=e}}class yn{constructor(t,e){this.updateTime=t;this.exists=e}static none(){return new yn}static exists(t){return new yn(void 0,t)}static updateTime(t){return new yn(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}
class In{}class bn extends In{constructor(t,e,n,s=[]){super();this.key=t;this.value=e;this.precondition=n;this.fieldTransforms=s;this.type=0}}class Vn extends In{constructor(t,e,n,s,i=[]){super();this.key=t;this.data=e;this.fieldMask=n;this.precondition=s;this.fieldTransforms=i;this.type=1}}class Cn extends In{constructor(t,e){super();this.key=t;this.precondition=e;this.type=2;this.fieldTransforms=[]}}class xn extends In{constructor(t,e){super();this.key=t;this.precondition=e;this.type=3;this.fieldTransforms=
[]}}class Nn{constructor(t){this.count=t}}var kn,Mn;(Mn=kn||(kn={}))[Mn.OK=0]="OK";Mn[Mn.CANCELLED=1]="CANCELLED";Mn[Mn.UNKNOWN=2]="UNKNOWN";Mn[Mn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT";Mn[Mn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED";Mn[Mn.NOT_FOUND=5]="NOT_FOUND";Mn[Mn.ALREADY_EXISTS=6]="ALREADY_EXISTS";Mn[Mn.PERMISSION_DENIED=7]="PERMISSION_DENIED";Mn[Mn.UNAUTHENTICATED=16]="UNAUTHENTICATED";Mn[Mn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED";Mn[Mn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION";Mn[Mn.ABORTED=
10]="ABORTED";Mn[Mn.OUT_OF_RANGE=11]="OUT_OF_RANGE";Mn[Mn.UNIMPLEMENTED=12]="UNIMPLEMENTED";Mn[Mn.INTERNAL=13]="INTERNAL";Mn[Mn.UNAVAILABLE=14]="UNAVAILABLE";Mn[Mn.DATA_LOSS=15]="DATA_LOSS";class $n{constructor(t,e){this.mapKeyFn=t;this.equalsFn=e;this.inner={};this.innerSize=0}get(t){var e$jscomp$0=this.mapKeyFn(t);e$jscomp$0=this.inner[e$jscomp$0];if(void 0!==e$jscomp$0)for(const [e,s]of e$jscomp$0)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){var n=this.mapKeyFn(t);
const s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]);this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){lt(this.inner,(e$jscomp$0,n)=>{for(const [e,s]of n)t(e,s)})}isEmpty(){return ft(this.inner)}size(){return this.innerSize}}
class Bn{constructor(t,e){this.comparator=t;this.root=e||Un.EMPTY}insert(t,e){return new Bn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(t){return new Bn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Un.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;0>n?e=e.left:0<n&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,
n.key);if(0===s)return e+n.left.size;0>s?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ln(this.root,
null,this.comparator,!1)}getIteratorFrom(t){return new Ln(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ln(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ln(this.root,t,this.comparator,!0)}}class Ln{constructor(t,e,n,s){this.isReverse=s;this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),0>i)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t);t=this.isReverse?t.right:t.left}}getNext(){let t=
this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Un{constructor(t,e,n,s,i){this.key=t;this.value=e;this.color=null!=n?n:Un.RED;this.left=null!=s?s:Un.EMPTY;this.right=
null!=i?i:Un.EMPTY;this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Un(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?
this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=0>i?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(0>e(t,s.key))s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||
(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Un.EMPTY;n=s.right.min();s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&
t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,
null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L();if(this.right.isRed())throw L();const t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:
1)}}Un.EMPTY=null;Un.RED=!0;Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw L();}get value(){throw L();}get color(){throw L();}get left(){throw L();}get right(){throw L();}copy(t,e,n,s,i){return this}insert(t,e,n){return new Un(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class qn{constructor(t){this.comparator=
t;this.data=new Bn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(0<=this.comparator(s.key,t[1]))break;e(s.key)}}forEachWhile(t,e){for(e=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();e.hasNext()&&
t(e.getNext().key););}firstAfterOrEqual(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null}getIterator(){return new Kn(this.data.getIterator())}getIteratorFrom(t){return new Kn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t$jscomp$0){let e=this;return e.size<t$jscomp$0.size&&(e=t$jscomp$0,t$jscomp$0=this),t$jscomp$0.forEach(t=>
{e=e.add(t)}),e}isEqual(t$jscomp$0){if(!(t$jscomp$0 instanceof qn)||this.size!==t$jscomp$0.size)return!1;const e=this.data.getIterator();for(t$jscomp$0=t$jscomp$0.data.getIterator();e.hasNext();){const t=e.getNext().key,s=t$jscomp$0.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new qn(this.comparator);return e.data=t,e}}class Kn{constructor(t){this.iter=
t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const Qn=new Bn(xt.comparator),Wn=new Bn(xt.comparator),Jn=new Bn(xt.comparator),Yn=new qn(xt.comparator),Zn=new qn(rt);class es{constructor(t,e,n,s,i){this.snapshotVersion=t;this.targetChanges=e;this.targetMismatches=n;this.documentUpdates=s;this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,ns.createSynthesizedTargetChangeForCurrentChange(t,e)),new es(ct.min(),
n,Zn,Qn,Xn())}}class ns{constructor(t,e,n,s,i){this.resumeToken=t;this.current=e;this.addedDocuments=n;this.modifiedDocuments=s;this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new ns(pt.EMPTY_BYTE_STRING,e,Xn(),Xn(),Xn())}}class ss{constructor(t,e,n,s){this.O=t;this.removedTargetIds=e;this.key=n;this.F=s}}class is{constructor(t,e){this.targetId=t;this.$=e}}class rs{constructor(t,e,n=pt.EMPTY_BYTE_STRING,s=null){this.state=t;this.targetIds=e;this.resumeToken=
n;this.cause=s}}class os{constructor(){this.B=0;this.L=new Bn(xt.comparator);this.U=pt.EMPTY_BYTE_STRING;this.q=!1;this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(t){0<t.approximateByteSize()&&(this.K=!0,this.U=t)}H(){let t=Xn(),e=Xn(),n=Xn();return this.L.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:L()}}),new ns(this.U,this.q,t,e,n)}J(){this.K=!1;this.L=new Bn(xt.comparator)}Y(t,
e){this.K=!0;this.L=this.L.insert(t,e)}X(t){this.K=!0;this.L=this.L.remove(t)}Z(){this.B+=1}tt(){--this.B}et(){this.q=this.K=!0}}class us{constructor(t){this.nt=t;this.st=new Map;this.it=Qn;this.rt=new Bn(xt.comparator);this.ot=new qn(rt)}ut(t){for(const e of t.O)t.F&&t.F.isFoundDocument()?this.at(e,t.F):this.ct(e,t.key,t.F);for(const e of t.removedTargetIds)this.ct(e,t.key,t.F)}ht(t){this.forEachTarget(t,e=>{const n=this.lt(e);switch(t.state){case 0:this.ft(e)&&n.W(t.resumeToken);break;case 1:n.tt();
n.G||n.J();n.W(t.resumeToken);break;case 2:n.tt();n.G||this.removeTarget(e);break;case 3:this.ft(e)&&(n.et(),n.W(t.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),n.W(t.resumeToken));break;default:L()}})}forEachTarget(t$jscomp$0,e){0<t$jscomp$0.targetIds.length?t$jscomp$0.targetIds.forEach(e):this.st.forEach((t,n)=>{this.ft(n)&&e(n)})}_t(t){const e=t.targetId;t=t.$.count;var s=this.wt(e);s&&(s=s.target,ge(s)?0===t?(t=new xt(s.path),this.ct(e,t,ne.newNoDocument(t,ct.min()))):1===t||L():this.gt(e)!==
t&&(this.dt(e),this.ot=this.ot.add(e)))}yt(t$jscomp$1){const e$jscomp$0=new Map;this.st.forEach((n,s)=>{var i=this.wt(s);i&&(n.current&&ge(i.target)&&(i=new xt(i.target.path),null!==this.it.get(i)||this.It(s,i)||this.ct(s,i,ne.newNoDocument(i,t$jscomp$1))),n.j&&(e$jscomp$0.set(s,n.H()),n.J()))});let n$jscomp$0=Xn();this.rt.forEach((t$jscomp$0,e)=>{let s=!0;e.forEachWhile(t=>{t=this.wt(t);return!t||2===t.purpose||(s=!1,!1)});s&&(n$jscomp$0=n$jscomp$0.add(t$jscomp$0))});this.it.forEach((e,n)=>n.setReadTime(t$jscomp$1));
const s$jscomp$0=new es(t$jscomp$1,e$jscomp$0,this.ot,this.it,n$jscomp$0);return this.it=Qn,this.rt=new Bn(xt.comparator),this.ot=new qn(rt),s$jscomp$0}at(t,e){if(this.ft(t)){var n=this.It(t,e.key)?2:0;this.lt(t).Y(e.key,n);this.it=this.it.insert(e.key,e);this.rt=this.rt.insert(e.key,this.Tt(e.key).add(t))}}ct(t,e,n){if(this.ft(t)){var s=this.lt(t);this.It(t,e)?s.Y(e,1):s.X(e);this.rt=this.rt.insert(e,this.Tt(e).delete(t));n&&(this.it=this.it.insert(e,n))}}removeTarget(t){this.st.delete(t)}gt(t){const e=
this.lt(t).H();return this.nt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Z(t){this.lt(t).Z()}lt(t){let e=this.st.get(t);return e||(e=new os,this.st.set(t,e)),e}Tt(t){let e=this.rt.get(t);return e||(e=new qn(rt),this.rt=this.rt.insert(t,e)),e}ft(t){const e=null!==this.wt(t);return e||O("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.st.get(t);return e&&e.G?null:this.nt.Et(t)}dt(t){this.st.set(t,new os);this.nt.getRemoteKeysForTarget(t).forEach(e=>
{this.ct(t,e,null)})}It(t,e){return this.nt.getRemoteKeysForTarget(t).has(e)}}const hs={asc:"ASCENDING",desc:"DESCENDING"},ls={"\x3c":"LESS_THAN","\x3c\x3d":"LESS_THAN_OR_EQUAL","\x3e":"GREATER_THAN","\x3e\x3d":"GREATER_THAN_OR_EQUAL","\x3d\x3d":"EQUAL","!\x3d":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class fs{constructor(t,e){this.databaseId=t;this.N=e}}const Hs=["userId","batchId"],Xs={},Zs=["prefixPath","collectionGroup",
"readTime","documentId"],ti=["prefixPath","collectionGroup","documentId"],ei=["collectionGroup","readTime","prefixPath","documentId"],ni=["canonicalId","targetId"],si=["targetId","path"],ii=["path","targetId"],ri=["collectionId","parent"],oi=["indexId","uid"],ui=["uid","sequenceNumber"],ai="indexId uid arrayValue directionalValue orderedDocumentKey documentKey".split(" "),ci=["indexId","uid","orderedDocumentKey"],hi=["userId","collectionPath","documentId"],li=["userId","collectionPath","largestBatchId"],
fi=["userId","collectionGroup","largestBatchId"],di="mutationQueues mutations documentMutations remoteDocuments targets owner targetGlobal targetDocuments clientMetadata remoteDocumentGlobal collectionParents bundles namedQueries".split(" "),_i=[...di,"documentOverlays"],wi="mutationQueues mutations documentMutations remoteDocumentsV14 targets owner targetGlobal targetDocuments clientMetadata remoteDocumentGlobal collectionParents bundles namedQueries documentOverlays".split(" "),mi=[...wi,"indexConfiguration",
"indexState","indexEntries"];class yi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}class pi{constructor(t$jscomp$0){this.catchCallback=this.nextCallback=null;this.error=this.result=void 0;this.callbackAttached=this.isDone=!1;t$jscomp$0(t=>{this.isDone=!0;this.result=t;this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0;this.error=t;this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,
t)}next(t$jscomp$0,e$jscomp$0){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e$jscomp$0,this.error):this.wrapSuccess(t$jscomp$0,this.result):new pi((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t$jscomp$0,e).next(n,s)};this.catchCallback=t=>{this.wrapFailure(e$jscomp$0,t).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t$jscomp$0){try{const e=t$jscomp$0();return e instanceof pi?e:pi.resolve(e)}catch(t){return pi.reject(t)}}wrapSuccess(t,
e){return t?this.wrapUserFunction(()=>t(e)):pi.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):pi.reject(e)}static resolve(t){return new pi((e,n)=>{e(t)})}static reject(t){return new pi((e,n)=>{n(t)})}static waitFor(t$jscomp$1){return new pi((e,n)=>{let s=0,i=0,r=!1;t$jscomp$1.forEach(t$jscomp$0=>{++s;t$jscomp$0.next(()=>{++i;r&&i===s&&e()},t=>n(t))});r=!0;i===s&&e()})}static or(t$jscomp$0){let e=pi.resolve(!1);for(const n of t$jscomp$0)e=e.next(t=>t?pi.resolve(t):n());return e}static forEach(t$jscomp$0,
e){const n=[];return t$jscomp$0.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.waitFor(n)}}class Ii{constructor(t,e$jscomp$0){this.action=t;this.transaction=e$jscomp$0;this.aborted=!1;this.At=new j;this.transaction.oncomplete=()=>{this.At.resolve()};this.transaction.onabort=()=>{e$jscomp$0.error?this.At.reject(new Ai(t,e$jscomp$0.error)):this.At.resolve()};this.transaction.onerror=e=>{e=vi(e.target.error);this.At.reject(new Ai(t,e))}}static open(t$jscomp$0,e,n,s){try{return new Ii(e,t$jscomp$0.transaction(s,
n))}catch(t){throw new Ai(e,t);}}get Rt(){return this.At.promise}abort(t){t&&this.At.reject(t);this.aborted||(O("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){t=this.transaction.objectStore(t);return new Pi(t)}}class Ti{constructor(t,e,n){this.name=t;this.version=e;this.bt=n;12.2===Ti.Vt((0,_util.getUA)())&&F("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return O("SimpleDb",
"Removing database:",t),bi(window.indexedDB.deleteDatabase(t)).toPromise()}static vt(){if(!(0,_util.isIndexedDBAvailable)())return!1;if(Ti.St())return!0;const t=(0,_util.getUA)();var e=Ti.Vt(t);e=0<e&&10>e;var s=Ti.Dt(t);s=0<s&&4.5>s;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||s)}static St(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Ct)}static xt(t,e){return t.store(e)}static Vt(t){t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?
t[1].split("_").slice(0,2).join("."):"-1";return Number(t)}static Dt(t){t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)}Nt(t$jscomp$0){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return $jscomp$async$this.db||(O("SimpleDb","Opening database:",$jscomp$async$this.name),$jscomp$async$this.db=yield new Promise((e$jscomp$0,n)=>{const s=indexedDB.open($jscomp$async$this.name,$jscomp$async$this.version);s.onsuccess=
t=>{e$jscomp$0(t.target.result)};s.onblocked=()=>{n(new Ai(t$jscomp$0,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))};s.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new Q(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):
"InvalidStateError"===e.name?n(new Q(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new Ai(t$jscomp$0,e))};s.onupgradeneeded=t=>{O("SimpleDb",'Database "'+$jscomp$async$this.name+'" requires upgrade from version:',t.oldVersion);$jscomp$async$this.bt.kt(t.target.result,s.transaction,t.oldVersion,$jscomp$async$this.version).next(()=>{O("SimpleDb",
"Database upgrade to version "+$jscomp$async$this.version+" complete")})}})),$jscomp$async$this.Mt&&($jscomp$async$this.db.onversionchange=t=>$jscomp$async$this.Mt(t)),$jscomp$async$this.db})}Ot(t){this.Mt=t;this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t$jscomp$0,e$jscomp$0,n,s){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const i="readonly"===e$jscomp$0;let r$jscomp$0=0;for(;;){++r$jscomp$0;try{$jscomp$async$this.db=yield $jscomp$async$this.Nt(t$jscomp$0);
const e=Ii.open($jscomp$async$this.db,t$jscomp$0,i?"readonly":"readwrite",n),r=s(e).next(t=>(e.Pt(),t)).catch(t=>(e.abort(t),pi.reject(t))).toPromise();return r.catch(()=>{}),yield e.Rt,r}catch(t){const e="FirebaseError"!==t.name&&3>r$jscomp$0;if(O("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),$jscomp$async$this.close(),!e)return Promise.reject(t)}}})}close(){this.db&&this.db.close();this.db=void 0}}class Ei{constructor(t){this.Ft=t;this.$t=!1;this.Bt=null}get isDone(){return this.$t}get Lt(){return this.Bt}set cursor(t){this.Ft=
t}done(){this.$t=!0}Ut(t){this.Bt=t}delete(){return bi(this.Ft.delete())}}class Ai extends Q{constructor(t,e){super(G.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`);this.name="IndexedDbTransactionError"}}class Pi{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(O("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(O("SimpleDb","PUT",this.store.name,"\x3cauto-key\x3e",t),n=this.store.put(t)),bi(n)}add(t){O("SimpleDb","ADD",this.store.name,t,t);return bi(this.store.add(t))}get(t){return bi(this.store.get(t)).next(e=>
(void 0===e&&(e=null),O("SimpleDb","GET",this.store.name,t,e),e))}delete(t){O("SimpleDb","DELETE",this.store.name,t);return bi(this.store.delete(t))}count(){O("SimpleDb","COUNT",this.store.name);return bi(this.store.count())}qt(t$jscomp$1,e$jscomp$0){t$jscomp$1=this.options(t$jscomp$1,e$jscomp$0);if(t$jscomp$1.index||"function"!=typeof this.store.getAll){t$jscomp$1=this.cursor(t$jscomp$1);const e=[];return this.Kt(t$jscomp$1,(t,n)=>{e.push(n)}).next(()=>e)}const t$jscomp$0=this.store.getAll(t$jscomp$1.range);
return new pi((e,n)=>{t$jscomp$0.onerror=t=>{n(t.target.error)};t$jscomp$0.onsuccess=t=>{e(t.target.result)}})}Gt(t$jscomp$1,e$jscomp$1){const n=this.store.getAll(t$jscomp$1,null===e$jscomp$1?void 0:e$jscomp$1);return new pi((t$jscomp$0,e$jscomp$0)=>{n.onerror=t=>{e$jscomp$0(t.target.error)};n.onsuccess=e=>{t$jscomp$0(e.target.result)}})}Qt(t$jscomp$0,e$jscomp$0){O("SimpleDb","DELETE ALL",this.store.name);t$jscomp$0=this.options(t$jscomp$0,e$jscomp$0);t$jscomp$0.jt=!1;t$jscomp$0=this.cursor(t$jscomp$0);
return this.Kt(t$jscomp$0,(t,e,n)=>n.delete())}Wt(t,e){let n;e?n=t:(n={},e=t);t=this.cursor(n);return this.Kt(t,e)}zt(t$jscomp$0){const e$jscomp$0=this.cursor({});return new pi((n,s$jscomp$0)=>{e$jscomp$0.onerror=t=>{t=vi(t.target.error);s$jscomp$0(t)};e$jscomp$0.onsuccess=e=>{const s=e.target.result;s?t$jscomp$0(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()}})}Kt(t$jscomp$1,e){const n=[];return(new pi((s,i)=>{t$jscomp$1.onerror=t=>{i(t.target.error)};t$jscomp$1.onsuccess=t$jscomp$0=>{t$jscomp$0=
t$jscomp$0.target.result;if(!t$jscomp$0)return void s();const r=new Ei(t$jscomp$0);var o=e(t$jscomp$0.primaryKey,t$jscomp$0.value,r);o instanceof pi&&(o=o.catch(t=>(r.done(),pi.reject(t))),n.push(o));r.isDone?s():null===r.Lt?t$jscomp$0.continue():t$jscomp$0.continue(r.Lt)}})).next(()=>pi.waitFor(n))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.jt?n.openKeyCursor(t.range,
e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}let Vi=!1;class Si extends yi{constructor(t,e){super();this.Ht=t;this.currentSequenceNumber=e}}class Ci{constructor(t,e,n,s){this.batchId=t;this.localWriteTime=e;this.baseMutations=n;this.mutations=s}applyToRemoteDocument(t,e$jscomp$0){e$jscomp$0=e$jscomp$0.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Tn(s,t,e$jscomp$0[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&
En(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&En(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach(e=>{e=t.get(e.key);this.applyToLocalView(e);e.isValidDocument()||e.convertToNoDocument(ct.min())})}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),Xn())}isEqual(t$jscomp$0){return this.batchId===t$jscomp$0.batchId&&ot(this.mutations,t$jscomp$0.mutations,(t,e)=>Rn(t,e))&&ot(this.baseMutations,t$jscomp$0.baseMutations,(t,e)=>Rn(t,e))}}
class xi{constructor(t,e,n,s){this.batch=t;this.commitVersion=e;this.mutationResults=n;this.docVersions=s}static from(t$jscomp$0,e,n){t$jscomp$0.mutations.length===n.length||L();let s=Jn;const i=t$jscomp$0.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new xi(t$jscomp$0,e,n,s)}}class Ni{constructor(t,e){this.largestBatchId=t;this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
class ki{constructor(t,e,n,s,i=ct.min(),r=ct.min(),o=pt.EMPTY_BYTE_STRING){this.target=t;this.targetId=e;this.purpose=n;this.sequenceNumber=s;this.snapshotVersion=i;this.lastLimboFreeSnapshotVersion=r;this.resumeToken=o}withSequenceNumber(t){return new ki(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new ki(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new ki(this.target,
this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Mi{constructor(t){this.Jt=t}}class Wi{getBundleMetadata(t$jscomp$0,e$jscomp$0){return Di(t$jscomp$0,"bundles").get(e$jscomp$0).next(t=>{if(t)return{id:(e=t).bundleId,createTime:Li(e.createTime),version:e.version};var e})}saveBundleMetadata(t,e){return Di(t,"bundles").put({bundleId:(n=e).id,createTime:Bi(ms(n.createTime)),version:n.version});var n}getNamedQuery(t$jscomp$0,e$jscomp$0){return Di(t$jscomp$0,
"namedQueries").get(e$jscomp$0).next(t=>{if(t)return{name:(e=t).name,query:Gi(e.bundledQuery),readTime:Li(e.readTime)};var e})}saveNamedQuery(t,e){t=Di(t,"namedQueries");var JSCompiler_temp_const=t.put;e={name:e.name,readTime:Bi(ms(e.readTime)),bundledQuery:e.bundledQuery};return JSCompiler_temp_const.call(t,e)}}class Ji{constructor(t,e){this.M=t;this.userId=e}static Yt(t,e){return new Ji(t,e.uid||"")}getOverlay(t$jscomp$0,e){return Yi(t$jscomp$0).get(ji(this.userId,e)).next(t=>t?Qi(this.M,t):null)}saveOverlays(t,
e,n$jscomp$0){const s=[];return n$jscomp$0.forEach((n,i)=>{n=new Ni(e,i);s.push(this.Xt(t,n))}),pi.waitFor(s)}removeOverlaysForBatchId(t$jscomp$0,e$jscomp$0,n){const s=new Set;e$jscomp$0.forEach(t=>s.add(Qs(t.getCollectionPath())));const i=[];return s.forEach(e=>{e=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(Yi(t$jscomp$0).Qt("collectionPathOverlayIndex",e))}),pi.waitFor(i)}getOverlaysForCollection(t$jscomp$0,e$jscomp$0,n){const s=Hn();e$jscomp$0=Qs(e$jscomp$0);n=IDBKeyRange.bound([this.userId,
e$jscomp$0,n],[this.userId,e$jscomp$0,Number.POSITIVE_INFINITY],!0);return Yi(t$jscomp$0).qt("collectionPathOverlayIndex",n).next(t=>{for(const e of t)t=Qi(this.M,e),s.set(t.getKey(),t);return s})}getOverlaysForCollectionGroup(t$jscomp$0,e$jscomp$0,n$jscomp$0,s){const i=Hn();let r;e$jscomp$0=IDBKeyRange.bound([this.userId,e$jscomp$0,n$jscomp$0],[this.userId,e$jscomp$0,Number.POSITIVE_INFINITY],!0);return Yi(t$jscomp$0).Wt({index:"collectionGroupOverlayIndex",range:e$jscomp$0},(t,e,n)=>{t=Qi(this.M,
e);i.size()<s||t.largestBatchId===r?(i.set(t.getKey(),t),r=t.largestBatchId):n.done()}).next(()=>i)}Xt(t$jscomp$0,e$jscomp$0){t$jscomp$0=Yi(t$jscomp$0);var JSCompiler_temp_const=t$jscomp$0.put,t=this.M,e=this.userId;const [,i,r]=ji(e,e$jscomp$0.mutation.key);e$jscomp$0={userId:e,collectionPath:i,documentId:r,collectionGroup:e$jscomp$0.mutation.key.getCollectionGroup(),largestBatchId:e$jscomp$0.largestBatchId,overlayMutation:Ss(t.Jt,e$jscomp$0.mutation)};return JSCompiler_temp_const.call(t$jscomp$0,
e$jscomp$0)}}class Xi{constructor(){}Zt(t,e){this.te(t,e);e.ee()}te(t,e){"nullValue"in t?this.ne(e,5):"booleanValue"in t?(this.ne(e,10),e.se(t.booleanValue?1:0)):"integerValue"in t?(this.ne(e,15),e.se(Et(t.integerValue))):"doubleValue"in t?(t=Et(t.doubleValue),isNaN(t)?this.ne(e,13):(this.ne(e,15),Dt(t)?e.se(0):e.se(t))):"timestampValue"in t?(t=t.timestampValue,this.ne(e,20),"string"==typeof t?e.ie(t):(e.ie(`${t.seconds||""}`),e.se(t.nanos||0))):"stringValue"in t?(this.re(t.stringValue,e),this.oe(e)):
"bytesValue"in t?(this.ne(e,30),e.ue(At(t.bytesValue)),this.oe(e)):"referenceValue"in t?this.ae(t.referenceValue,e):"geoPointValue"in t?(t=t.geoPointValue,this.ne(e,45),e.se(t.latitude||0),e.se(t.longitude||0)):"mapValue"in t?Ht(t)?this.ne(e,Number.MAX_SAFE_INTEGER):(this.ce(t.mapValue,e),this.oe(e)):"arrayValue"in t?(this.he(t.arrayValue,e),this.oe(e)):L()}re(t,e){this.ne(e,25);this.le(t,e)}le(t,e){e.ie(t)}ce(t$jscomp$0,e){t$jscomp$0=t$jscomp$0.fields||{};this.ne(e,55);for(const t of Object.keys(t$jscomp$0))this.re(t,
e),this.te(t$jscomp$0[t],e)}he(t$jscomp$0,e){t$jscomp$0=t$jscomp$0.values||[];this.ne(e,50);for(const t of t$jscomp$0)this.te(t,e)}ae(t$jscomp$0,e){this.ne(e,37);xt.fromName(t$jscomp$0).path.forEach(t=>{this.ne(e,60);this.le(t,e)})}ne(t,e){t.se(e)}oe(t){t.se(2)}}Xi.fe=new Xi;class er{constructor(){this.buffer=new Uint8Array(1024);this.position=0}de(t){t=t[Symbol.iterator]();let n=t.next();for(;!n.done;)this._e(n.value),n=t.next();this.we()}me(t){t=t[Symbol.iterator]();let n=t.next();for(;!n.done;)this.ge(n.value),
n=t.next();this.ye()}pe(t){for(const e of t)t=e.charCodeAt(0),128>t?this._e(t):2048>t?(this._e(960|t>>>6),this._e(128|63&t)):"\ud800">e||"\udbff"<e?(this._e(480|t>>>12),this._e(128|63&t>>>6),this._e(128|63&t)):(t=e.codePointAt(0),this._e(240|t>>>18),this._e(128|63&t>>>12),this._e(128|63&t>>>6),this._e(128|63&t));this.we()}Ie(t){for(const e of t)t=e.charCodeAt(0),128>t?this.ge(t):2048>t?(this.ge(960|t>>>6),this.ge(128|63&t)):"\ud800">e||"\udbff"<e?(this.ge(480|t>>>12),this.ge(128|63&t>>>6),this.ge(128|
63&t)):(t=e.codePointAt(0),this.ge(240|t>>>18),this.ge(128|63&t>>>12),this.ge(128|63&t>>>6),this.ge(128|63&t));this.ye()}Te(t){t=this.Ee(t);var n=tr(t);this.Ae(1+n);this.buffer[this.position++]=255&n;for(n=t.length-n;n<t.length;++n)this.buffer[this.position++]=255&t[n]}Re(t){t=this.Ee(t);var n=tr(t);this.Ae(1+n);this.buffer[this.position++]=~(255&n);for(n=t.length-n;n<t.length;++n)this.buffer[this.position++]=~(255&t[n])}Pe(){this.be(255);this.be(255)}Ve(){this.ve(255);this.ve(255)}reset(){this.position=
0}seed(t){this.Ae(t.length);this.buffer.set(t,this.position);this.position+=t.length}Se(){return this.buffer.slice(0,this.position)}Ee(t$jscomp$0){var e=new DataView(new ArrayBuffer(8));t$jscomp$0=(e.setFloat64(0,t$jscomp$0,!1),new Uint8Array(e.buffer));e=0!=(128&t$jscomp$0[0]);t$jscomp$0[0]^=e?255:128;for(let t=1;t<t$jscomp$0.length;++t)t$jscomp$0[t]^=e?255:0;return t$jscomp$0}_e(t){t&=255;0===t?(this.be(0),this.be(255)):255===t?(this.be(255),this.be(0)):this.be(t)}ge(t){const e=255&t;0===e?(this.ve(0),
this.ve(255)):255===e?(this.ve(255),this.ve(0)):this.ve(t)}we(){this.be(0);this.be(1)}ye(){this.ve(0);this.ve(1)}be(t){this.Ae(1);this.buffer[this.position++]=t}ve(t){this.Ae(1);this.buffer[this.position++]=~t}Ae(t){t+=this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);t=new Uint8Array(n);t.set(this.buffer);this.buffer=t}}}class nr{constructor(t){this.De=t}ue(t){this.De.de(t)}ie(t){this.De.pe(t)}se(t){this.De.Te(t)}ee(){this.De.Pe()}}class sr{constructor(t){this.De=t}ue(t){this.De.me(t)}ie(t){this.De.Ie(t)}se(t){this.De.Re(t)}ee(){this.De.Ve()}}
class ir{constructor(){this.De=new er;this.Ce=new nr(this.De);this.xe=new sr(this.De)}seed(t){this.De.seed(t)}Ne(t){return 0===t?this.Ce:this.xe}Se(){return this.De.Se()}reset(){this.De.reset()}}class rr{constructor(t,e,n,s){this.indexId=t;this.documentKey=e;this.arrayValue=n;this.directionalValue=s}ke(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-
1],new rr(this.indexId,this.documentKey,this.arrayValue,n)}}class ar{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();this.Me=t.orderBy;this.Oe=[];for(const e of t.filters)t=e,t.S()?this.Fe=t:this.Oe.push(t)}$e(t$jscomp$0){var e=ie(t$jscomp$0);if(void 0!==e&&!this.Be(e))return!1;t$jscomp$0=re(t$jscomp$0);let i=e=0;for(;e<t$jscomp$0.length&&this.Be(t$jscomp$0[e]);++e);if(e===t$jscomp$0.length)return!0;if(void 0!==this.Fe){var t=t$jscomp$0[e];if(!this.Le(this.Fe,
t)||!this.Ue(this.Me[i++],t))return!1;++e}for(;e<t$jscomp$0.length;++e)if(t=t$jscomp$0[e],i>=this.Me.length||!this.Ue(this.Me[i++],t))return!1;return!0}Be(t){for(const e of this.Oe)if(this.Le(e,t))return!0;return!1}Le(t,e){return void 0!==t&&t.field.isEqual(e.fieldPath)?2===e.kind===("array-contains"===t.op||"array-contains-any"===t.op):!1}Ue(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}class cr{constructor(){this.qe=new hr}addToCollectionParentIndex(t,
e){return this.qe.add(e),pi.resolve()}getCollectionParents(t,e){return pi.resolve(this.qe.getEntries(e))}addFieldIndex(t,e){return pi.resolve()}deleteFieldIndex(t,e){return pi.resolve()}getDocumentsMatchingTarget(t,e){return pi.resolve(null)}getFieldIndex(t,e){return pi.resolve(null)}getFieldIndexes(t,e){return pi.resolve([])}getNextCollectionGroupToUpdate(t){return pi.resolve(null)}updateCollectionGroup(t,e,n){return pi.resolve()}updateIndexEntries(t,e){return pi.resolve()}}class hr{constructor(){this.index=
{}}add(t){const e=t.lastSegment();t=t.popLast();const s=this.index[e]||new qn(_t.comparator),i=!s.has(t);return this.index[e]=s.add(t),i}has(t){var e=t.lastSegment();t=t.popLast();return(e=this.index[e])&&e.has(t)}getEntries(t){return(this.index[t]||new qn(_t.comparator)).toArray()}}const lr=new Uint8Array(0);class fr{constructor(t$jscomp$0,e$jscomp$0){this.user=t$jscomp$0;this.databaseId=e$jscomp$0;this.Ke=new hr;this.Ge=new $n(t=>_e(t),(t,e)=>me(t,e));this.uid=t$jscomp$0.uid||""}addToCollectionParentIndex(t,
e){if(!this.Ke.has(e)){var n=e.lastSegment();const s=e.popLast();t.addOnCommittedListener(()=>{this.Ke.add(e)});n={collectionId:n,parent:Qs(s)};return Di(t,"collectionParents").put(n)}return pi.resolve()}getCollectionParents(t$jscomp$0,e){const n=[],s$jscomp$0=IDBKeyRange.bound([e,""],[e+"\x00",""],!1,!0);return Di(t$jscomp$0,"collectionParents").qt(s$jscomp$0).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(zs(s.parent))}return n})}addFieldIndex(t$jscomp$1,e){t$jscomp$1=wr(t$jscomp$1);
e=function(t$jscomp$0){return{indexId:t$jscomp$0.indexId,collectionGroup:t$jscomp$0.collectionGroup,fields:t$jscomp$0.fields.map(t=>[t.fieldPath.canonicalString(),t.kind])}}(e);return delete e.indexId,t$jscomp$1.add(e).next()}deleteFieldIndex(t,e){const n=wr(t),s=mr(t),i=_r(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}getDocumentsMatchingTarget(t$jscomp$1,e$jscomp$1){const n$jscomp$0=
_r(t$jscomp$1);let s$jscomp$1=!0;const i$jscomp$1=new Map;return pi.forEach(this.Qe(e$jscomp$1),e=>this.getFieldIndex(t$jscomp$1,e).next(t=>{s$jscomp$1&&(s$jscomp$1=!!t);i$jscomp$1.set(e,t)})).next(()=>{if(s$jscomp$1){let t$jscomp$0=Xn();const s$jscomp$0=[];return pi.forEach(i$jscomp$1,(i$jscomp$0,r)=>{O("IndexedDbIndexManager",`Using index ${`id=${i$jscomp$0.indexId}|cg=${i$jscomp$0.collectionGroup}|f=${i$jscomp$0.fields.map(t=>`${t.fieldPath}:${t.kind}`).join(",")}`} to execute ${_e(e$jscomp$1)}`);
const u=function(t,e$jscomp$0){e$jscomp$0=ie(e$jscomp$0);if(void 0===e$jscomp$0)return null;for(const e of ye(t,e$jscomp$0.fieldPath))switch(e.op){case "array-contains-any":return e.value.arrayValue.values||[];case "array-contains":return[e.value]}return null}(r,i$jscomp$0),a=function(t,e$jscomp$0){const n=new Map;for(const s of re(e$jscomp$0))for(const e of ye(t,s.fieldPath))switch(e.op){case "\x3d\x3d":case "in":n.set(s.fieldPath.canonicalString(),e.value);break;case "not-in":case "!\x3d":return n.set(s.fieldPath.canonicalString(),
e.value),Array.from(n.values())}return null}(r,i$jscomp$0),c=function(t,e){const n=[];let s=!0;for(const i of re(e)){e=0===i.kind?pe(t,i.fieldPath,t.startAt):Ie(t,i.fieldPath,t.startAt);if(!e.value)return null;n.push(e.value);s&&(s=e.inclusive)}return new De(n,s)}(r,i$jscomp$0),h=function(t,e){const n=[];let s=!0;for(const i of re(e)){e=0===i.kind?Ie(t,i.fieldPath,t.endAt):pe(t,i.fieldPath,t.endAt);if(!e.value)return null;n.push(e.value);s&&(s=e.inclusive)}return new De(n,s)}(r,i$jscomp$0),l=this.je(i$jscomp$0,
r,c),f=this.je(i$jscomp$0,r,h);r=this.We(i$jscomp$0,r,a);i$jscomp$0=this.ze(i$jscomp$0.indexId,u,l,!!c&&c.inclusive,f,!!h&&h.inclusive,r);return pi.forEach(i$jscomp$0,i=>n$jscomp$0.Gt(i,e$jscomp$1.limit).next(e$jscomp$0=>{e$jscomp$0.forEach(e=>{e=xt.fromSegments(e.documentKey);t$jscomp$0.has(e)||(t$jscomp$0=t$jscomp$0.add(e),s$jscomp$0.push(e))})}))}).next(()=>s$jscomp$0)}return pi.resolve(null)})}Qe(t){let e=this.Ge.get(t);return e||(e=[t],this.Ge.set(t,e),e)}ze(t,e$jscomp$0,n,s,i,r,o){const u$jscomp$0=
(null!=e$jscomp$0?e$jscomp$0.length:1)*Math.max(null!=n?n.length:1,null!=i?i.length:1),a=u$jscomp$0/(null!=e$jscomp$0?e$jscomp$0.length:1),c=[];for(let h=0;h<u$jscomp$0;++h){const u=e$jscomp$0?this.He(e$jscomp$0[h/a]):lr,l=n?this.Je(t,u,n[h%a],s):this.Ye(t),f=i?this.Xe(t,u,i[h%a],r):this.Ye(t+1);c.push(...this.createRange(l,f,o.map(e=>this.Je(t,u,e,!0))))}return c}Je(t,e,n,s){t=new rr(t,xt.empty(),e,n);return s?t:t.ke()}Xe(t,e,n,s){t=new rr(t,xt.empty(),e,n);return s?t.ke():t}Ye(t){return new rr(t,
xt.empty(),lr,lr)}getFieldIndex(t$jscomp$1,e$jscomp$0){const n=new ar(e$jscomp$0);e$jscomp$0=null!=e$jscomp$0.collectionGroup?e$jscomp$0.collectionGroup:e$jscomp$0.path.lastSegment();return this.getFieldIndexes(t$jscomp$1,e$jscomp$0).next(t$jscomp$0=>{t$jscomp$0=t$jscomp$0.filter(t=>n.$e(t));return t$jscomp$0.sort((t,e)=>e.fields.length-t.fields.length),0<t$jscomp$0.length?t$jscomp$0[0]:null})}Ze(t,e){const n=new ir;for(const s of re(t)){t=e.data.field(s.fieldPath);if(null==t)return null;const i=
n.Ne(s.kind);Xi.fe.Zt(t,i)}return n.Se()}He(t){const e=new ir;return Xi.fe.Zt(t,e.Ne(0)),e.Se()}tn(t,e){const n=new ir;var JSCompiler_temp_const=Xi.fe,JSCompiler_temp_const$jscomp$0=JSCompiler_temp_const.Zt;e=qt(this.databaseId,e);var JSCompiler_temp_const$jscomp$1=n.Ne;t=re(t);return JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,e,JSCompiler_temp_const$jscomp$1.call(n,0===t.length?0:t[t.length-1].kind)),n.Se()}We(t,e$jscomp$0,n$jscomp$0){if(null===n$jscomp$0)return[];let s=[];s.push(new ir);
let i=0;for(const r of re(t)){t=n$jscomp$0[i++];for(const n of s)if(this.en(e$jscomp$0,r.fieldPath)&&Gt(t))s=this.nn(s,r,t);else{const e=n.Ne(r.kind);Xi.fe.Zt(t,e)}}return this.sn(s)}je(t,e,n){return null==n?null:this.We(t,e,n.position)}sn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Se();return e}nn(t$jscomp$0,e,n$jscomp$0){t$jscomp$0=[...t$jscomp$0];const i=[];for(const t of n$jscomp$0.arrayValue.values||[])for(const n of t$jscomp$0)n$jscomp$0=new ir,n$jscomp$0.seed(n.Se()),Xi.fe.Zt(t,n$jscomp$0.Ne(e.kind)),
i.push(n$jscomp$0);return i}en(t$jscomp$0,e){return!!t$jscomp$0.filters.find(t=>t instanceof Te&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op))}getFieldIndexes(t$jscomp$3,e$jscomp$2){const n$jscomp$0=wr(t$jscomp$3),s$jscomp$0=mr(t$jscomp$3);return(e$jscomp$2?n$jscomp$0.qt("collectionGroupIndex",IDBKeyRange.bound(e$jscomp$2,e$jscomp$2)):n$jscomp$0.qt()).next(t$jscomp$2=>{const e$jscomp$1=[];return pi.forEach(t$jscomp$2,t$jscomp$1=>s$jscomp$0.get([t$jscomp$1.indexId,this.uid]).next(n=>{e$jscomp$1.push(function(t$jscomp$0,
e$jscomp$0){e$jscomp$0=e$jscomp$0?new ue(e$jscomp$0.sequenceNumber,new he(Li(e$jscomp$0.readTime),new xt(zs(e$jscomp$0.documentKey)),e$jscomp$0.largestBatchId)):ue.empty();const s=t$jscomp$0.fields.map(([t,e])=>new oe(mt.fromServerFormat(t),e));return new se(t$jscomp$0.indexId,t$jscomp$0.collectionGroup,s,e$jscomp$0)}(t$jscomp$1,n))})).next(()=>e$jscomp$1)})}getNextCollectionGroupToUpdate(t$jscomp$1){return this.getFieldIndexes(t$jscomp$1).next(t$jscomp$0=>0===t$jscomp$0.length?null:(t$jscomp$0.sort((t,
e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:rt(t.collectionGroup,e.collectionGroup)}),t$jscomp$0[0].collectionGroup))}updateCollectionGroup(t$jscomp$0,e$jscomp$1,n){const s=wr(t$jscomp$0),i=mr(t$jscomp$0);return this.rn(t$jscomp$0).next(t=>s.qt("collectionGroupIndex",IDBKeyRange.bound(e$jscomp$1,e$jscomp$1)).next(e$jscomp$0=>pi.forEach(e$jscomp$0,e=>{var JSCompiler_temp_const=i.put;e={indexId:e.indexId,uid:this.user.uid||"",sequenceNumber:t,readTime:Bi(n.readTime),
documentKey:Qs(n.documentKey.path),largestBatchId:n.largestBatchId};return JSCompiler_temp_const.call(i,e)})))}updateIndexEntries(t,e$jscomp$1){const n$jscomp$0=new Map;return pi.forEach(e$jscomp$1,(e$jscomp$0,s)=>{const i$jscomp$1=n$jscomp$0.get(e$jscomp$0.collectionGroup);return(i$jscomp$1?pi.resolve(i$jscomp$1):this.getFieldIndexes(t,e$jscomp$0.collectionGroup)).next(i$jscomp$0=>(n$jscomp$0.set(e$jscomp$0.collectionGroup,i$jscomp$0),pi.forEach(i$jscomp$0,n=>this.on(t,e$jscomp$0,n).next(e=>{const i=
this.un(s,n);return e.isEqual(i)?pi.resolve():this.an(t,s,n,e,i)}))))})}cn(t,e,n,s){return _r(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.tn(n,e.key),documentKey:e.key.path.toArray()})}hn(t,e,n,s){return _r(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.tn(n,e.key),e.key.path.toArray()])}on(t$jscomp$0,e,n){t$jscomp$0=_r(t$jscomp$0);let i=new qn(or);return t$jscomp$0.Wt({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,
this.uid,this.tn(n,e)])},(t,s)=>{i=i.add(new rr(n.indexId,e,s.arrayValue,s.directionalValue))}).next(()=>i)}un(t,e){let n=new qn(or);const s=this.Ze(e,t);if(null==s)return n;var i$jscomp$0=ie(e);if(null!=i$jscomp$0){if(i$jscomp$0=t.data.field(i$jscomp$0.fieldPath),Gt(i$jscomp$0))for(const i of i$jscomp$0.arrayValue.values||[])n=n.add(new rr(e.indexId,t.key,this.He(i),s))}else n=n.add(new rr(e.indexId,t.key,lr,s));return n}an(t$jscomp$1,e$jscomp$1,n$jscomp$0,s$jscomp$1,i$jscomp$0){O("IndexedDbIndexManager",
"Updating index entries for document '%s'",e$jscomp$1.key);const r=[];return function(t$jscomp$0,e$jscomp$0,n,s$jscomp$0,i){t$jscomp$0=t$jscomp$0.getIterator();e$jscomp$0=e$jscomp$0.getIterator();let u=Gn(t$jscomp$0),a=Gn(e$jscomp$0);for(;u||a;){let t=!1,e=!1;if(u&&a){const s=n(u,a);0>s?e=!0:0<s&&(t=!0)}else null!=u?e=!0:t=!0;t?(s$jscomp$0(a),a=Gn(e$jscomp$0)):e?(i(u),u=Gn(t$jscomp$0)):(u=Gn(t$jscomp$0),a=Gn(e$jscomp$0))}}(s$jscomp$1,i$jscomp$0,or,s=>{r.push(this.cn(t$jscomp$1,e$jscomp$1,n$jscomp$0,
s))},s=>{r.push(this.hn(t$jscomp$1,e$jscomp$1,n$jscomp$0,s))}),pi.waitFor(r)}rn(t$jscomp$0){let e=1;return mr(t$jscomp$0).Wt({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(t,n,s)=>{s.done();e=n.sequenceNumber+1}).next(()=>e)}createRange(t$jscomp$0,e$jscomp$0,n$jscomp$0){n$jscomp$0=n$jscomp$0.sort((t,e)=>or(t,e)).filter((t,e,n)=>!e||0!==or(t,n[e-1]));const s=[];s.push(t$jscomp$0);for(const i of n$jscomp$0){n$jscomp$0=or(i,t$jscomp$0);const r=
or(i,e$jscomp$0);if(0===n$jscomp$0)s[0]=t$jscomp$0.ke();else if(0<n$jscomp$0&&0>r)s.push(i),s.push(i.ke());else if(0<r)break}s.push(e$jscomp$0);t$jscomp$0=[];for(e$jscomp$0=0;e$jscomp$0<s.length;e$jscomp$0+=2)t$jscomp$0.push(IDBKeyRange.bound([s[e$jscomp$0].indexId,this.uid,s[e$jscomp$0].arrayValue,s[e$jscomp$0].directionalValue,lr,[]],[s[e$jscomp$0+1].indexId,this.uid,s[e$jscomp$0+1].arrayValue,s[e$jscomp$0+1].directionalValue,lr,[]]));return t$jscomp$0}}const gr={didRun:!1,sequenceNumbersCollected:0,
targetsRemoved:0,documentsRemoved:0};class yr{constructor(t,e,n){this.cacheSizeCollectionThreshold=t;this.percentileToCollect=e;this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new yr(t,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}yr.DEFAULT_COLLECTION_PERCENTILE=10;yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1E3;yr.DEFAULT=new yr(41943040,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);yr.DISABLED=new yr(-1,0,0);class Tr{constructor(t,
e,n,s){this.userId=t;this.M=e;this.indexManager=n;this.referenceDelegate=s;this.ln={}}static Yt(t,e,n,s){""!==t.uid||L();t=t.isAuthenticated()?t.uid:"";return new Tr(t,e,n,s)}checkEmpty(t$jscomp$0){let e=!0;const n$jscomp$0=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ar(t$jscomp$0).Wt({index:"userMutationsIndex",range:n$jscomp$0},(t,n,s)=>{e=!1;s.done()}).next(()=>e)}addMutationBatch(t$jscomp$0,e$jscomp$1,n$jscomp$0,s$jscomp$0){const i$jscomp$0=
Rr(t$jscomp$0),r=Ar(t$jscomp$0);return r.add({}).next(o=>{"number"==typeof o||L();const u=new Ci(o,e$jscomp$1,n$jscomp$0,s$jscomp$0),a=function(t,e$jscomp$0,n){const s=n.baseMutations.map(e=>Ss(t.Jt,e)),i=n.mutations.map(e=>Ss(t.Jt,e));return{userId:e$jscomp$0,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:s,mutations:i}}(this.M,this.userId,u),c=[];let h=new qn((t,e)=>rt(t.canonicalString(),e.canonicalString()));for(const t of s$jscomp$0){const e=Ys(this.userId,t.key.path,
o);h=h.add(t.key.path.popLast());c.push(r.put(a));c.push(i$jscomp$0.put(e,Xs))}return h.forEach(e=>{c.push(this.indexManager.addToCollectionParentIndex(t$jscomp$0,e))}),t$jscomp$0.addOnCommittedListener(()=>{this.ln[o]=u.keys()}),pi.waitFor(c).next(()=>u)})}lookupMutationBatch(t$jscomp$0,e){return Ar(t$jscomp$0).get(e).next(t=>{t?(t.userId===this.userId||L(),t=Ui(this.M,t)):t=null;return t})}fn(t$jscomp$0,e){return this.ln[e]?pi.resolve(this.ln[e]):this.lookupMutationBatch(t$jscomp$0,e).next(t=>t?
(t=t.keys(),this.ln[e]=t,t):null)}getNextMutationBatchAfterBatchId(t$jscomp$0,e$jscomp$0){const n=e$jscomp$0+1;e$jscomp$0=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ar(t$jscomp$0).Wt({index:"userMutationsIndex",range:e$jscomp$0},(t,e,s)=>{e.userId===this.userId&&(e.batchId>=n||L(),i=Ui(this.M,e));s.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t$jscomp$0){const e$jscomp$0=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ar(t$jscomp$0).Wt({index:"userMutationsIndex",
range:e$jscomp$0,reverse:!0},(t,e,s)=>{n=e.batchId;s.done()}).next(()=>n)}getAllMutationBatches(t$jscomp$1){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ar(t$jscomp$1).qt("userMutationsIndex",e).next(t$jscomp$0=>t$jscomp$0.map(t=>Ui(this.M,t)))}getAllMutationBatchesAffectingDocumentKey(t$jscomp$0,e){var n$jscomp$0=[this.userId,Qs(e.path)];n$jscomp$0=IDBKeyRange.lowerBound(n$jscomp$0);const i=[];return Rr(t$jscomp$0).Wt({range:n$jscomp$0},(n,s,r)=>{const [o,
u,a]=n;n=zs(u);if(o===this.userId&&e.path.isEqual(n))return Ar(t$jscomp$0).get(a).next(t=>{if(!t)throw L();t.userId===this.userId||L();i.push(Ui(this.M,t))});r.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t$jscomp$0,e$jscomp$0){let n=new qn(rt);const s$jscomp$0=[];return e$jscomp$0.forEach(e=>{var i$jscomp$0=[this.userId,Qs(e.path)];i$jscomp$0=IDBKeyRange.lowerBound(i$jscomp$0);i$jscomp$0=Rr(t$jscomp$0).Wt({range:i$jscomp$0},(t,s,i)=>{const [r,o,u]=t;t=zs(o);r===this.userId&&e.path.isEqual(t)?
n=n.add(u):i.done()});s$jscomp$0.push(i$jscomp$0)}),pi.waitFor(s$jscomp$0).next(()=>this.dn(t$jscomp$0,n))}getAllMutationBatchesAffectingQuery(t$jscomp$0,e$jscomp$0){const n=e$jscomp$0.path,s=n.length+1;e$jscomp$0=[this.userId,Qs(n)];e$jscomp$0=IDBKeyRange.lowerBound(e$jscomp$0);let o=new qn(rt);return Rr(t$jscomp$0).Wt({range:e$jscomp$0},(t,e,i)=>{const [r,u,a]=t;t=zs(u);r===this.userId&&n.isPrefixOf(t)?t.length===s&&(o=o.add(a)):i.done()}).next(()=>this.dn(t$jscomp$0,o))}dn(t$jscomp$0,e$jscomp$0){const n=
[],s=[];return e$jscomp$0.forEach(e=>{s.push(Ar(t$jscomp$0).get(e).next(t=>{if(null===t)throw L();t.userId===this.userId||L();n.push(Ui(this.M,t))}))}),pi.waitFor(s).next(()=>n)}removeMutationBatch(t,e$jscomp$0){return pr(t.Ht,this.userId,e$jscomp$0).next(n=>(t.addOnCommittedListener(()=>{this._n(e$jscomp$0.batchId)}),pi.forEach(n,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}_n(t){delete this.ln[t]}performConsistencyCheck(t$jscomp$0){return this.checkEmpty(t$jscomp$0).next(e$jscomp$0=>
{if(!e$jscomp$0)return pi.resolve();e$jscomp$0=IDBKeyRange.lowerBound([this.userId]);const s=[];return Rr(t$jscomp$0).Wt({range:e$jscomp$0},(t,e,n)=>{t[0]===this.userId?(t=zs(t[1]),s.push(t)):n.done()}).next(()=>{0===s.length||L()})})}containsKey(t,e){return Er(t,this.userId,e)}wn(t$jscomp$0){return Di(t$jscomp$0,"mutationQueues").get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}class br{constructor(t){this.mn=t}next(){return this.mn+=2,this.mn}static gn(){return new br(0)}static yn(){return new br(-1)}}
class Vr{constructor(t,e){this.referenceDelegate=t;this.M=e}allocateTargetId(t){return this.pn(t).next(e=>{const n=new br(e.highestTargetId);return e.highestTargetId=n.next(),this.In(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t$jscomp$0){return this.pn(t$jscomp$0).next(t=>ct.fromTimestamp(new at(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t$jscomp$0){return this.pn(t$jscomp$0).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(t,
e,n){return this.pn(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.In(t,s)))}addTargetData(t,e){return this.Tn(t,e).next(()=>this.pn(t).next(n=>(n.targetCount+=1,this.En(e,n),this.In(t,n))))}updateTargetData(t,e){return this.Tn(t,e)}removeTargetData(t,e$jscomp$0){return this.removeMatchingKeysForTargetId(t,e$jscomp$0.targetId).next(()=>vr(t).delete(e$jscomp$0.targetId)).next(()=>this.pn(t)).next(e=>
{0<e.targetCount||L();return--e.targetCount,this.In(t,e)})}removeTargets(t,e,n){let s=0;const i=[];return vr(t).Wt((r,o)=>{r=qi(o);r.sequenceNumber<=e&&null===n.get(r.targetId)&&(s++,i.push(this.removeTargetData(t,r)))}).next(()=>pi.waitFor(i)).next(()=>s)}forEachTarget(t$jscomp$0,e){return vr(t$jscomp$0).Wt((t,n)=>{t=qi(n);e(t)})}pn(t$jscomp$0){return Di(t$jscomp$0,"targetGlobal").get("targetGlobalKey").next(t=>{null!==t||L();return t})}In(t,e){return Di(t,"targetGlobal").put("targetGlobalKey",e)}Tn(t,
e){return vr(t).put(Ki(this.M,e))}En(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t$jscomp$0){return this.pn(t$jscomp$0).next(t=>t.targetCount)}getTargetData(t$jscomp$0,e){var n$jscomp$0=_e(e);n$jscomp$0=IDBKeyRange.bound([n$jscomp$0,Number.NEGATIVE_INFINITY],[n$jscomp$0,Number.POSITIVE_INFINITY]);let i=null;return vr(t$jscomp$0).Wt({range:n$jscomp$0,
index:"queryTargetsIndex"},(t,n,s)=>{t=qi(n);me(e,t.target)&&(i=t,s.done())}).next(()=>i)}addMatchingKeys(t,e$jscomp$0,n){const s=[],i=Dr(t);return e$jscomp$0.forEach(e=>{const r=Qs(e.path);s.push(i.put({targetId:n,path:r}));s.push(this.referenceDelegate.addReference(t,n,e))}),pi.waitFor(s)}removeMatchingKeys(t,e$jscomp$0,n){const s=Dr(t);return pi.forEach(e$jscomp$0,e=>{const i=Qs(e.path);return pi.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])})}removeMatchingKeysForTargetId(t,
e){t=Dr(t);e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)}getMatchingKeysForTargetId(t$jscomp$0,e$jscomp$0){e$jscomp$0=IDBKeyRange.bound([e$jscomp$0],[e$jscomp$0+1],!1,!0);t$jscomp$0=Dr(t$jscomp$0);let i=Xn();return t$jscomp$0.Wt({range:e$jscomp$0,jt:!0},(t,e,n)=>{t=zs(t[1]);t=new xt(t);i=i.add(t)}).next(()=>i)}containsKey(t$jscomp$0,e){e=Qs(e.path);e=IDBKeyRange.bound([e],[e+"\x00"],!1,!0);let i=0;return Dr(t$jscomp$0).Wt({index:"documentTargetsIndex",jt:!0,range:e},([t],n,s)=>{0!==t&&(i++,
s.done())}).next(()=>0<i)}Et(t$jscomp$0,e){return vr(t$jscomp$0).get(e).next(t=>t?qi(t):null)}}class Nr{constructor(t){this.An=t;this.buffer=new qn(xr);this.Rn=0}Pn(){return++this.Rn}bn(t$jscomp$0){t$jscomp$0=[t$jscomp$0,this.Pn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(t$jscomp$0);else{const t=this.buffer.last();0>xr(t$jscomp$0,t)&&(this.buffer=this.buffer.delete(t).add(t$jscomp$0))}}get maxValue(){return this.buffer.last()[0]}}class kr{constructor(t,e){this.garbageCollector=t;this.asyncQueue=
e;this.Vn=!1;this.vn=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Sn(t)}stop(){this.vn&&(this.vn.cancel(),this.vn=null)}get started(){return null!==this.vn}Sn(t$jscomp$0){const e=this.Vn?3E5:6E4;O("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`);this.vn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.vn=null;$jscomp$async$this.Vn=
!0;try{yield t$jscomp$0.collectGarbage($jscomp$async$this.garbageCollector)}catch(t){Ri(t)?O("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Cr(t)}yield $jscomp$async$this.Sn(t$jscomp$0)})})}}class Mr{constructor(t,e){this.Dn=t;this.params=e}calculateTargetCount(t$jscomp$0,e){return this.Dn.Cn(t$jscomp$0).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t$jscomp$0,e){if(0===e)return pi.resolve(nt.A);const n=new Nr(e);return this.Dn.forEachTarget(t$jscomp$0,t=>n.bn(t.sequenceNumber)).next(()=>
this.Dn.xn(t$jscomp$0,t=>n.bn(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Dn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Dn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector","Garbage collection skipped; disabled"),pi.resolve(gr)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),
gr):this.Nn(t,e))}getCacheSize(t){return this.Dn.getCacheSize(t)}Nn(t$jscomp$0,e$jscomp$0){let n,s$jscomp$0,i,r,o,a,c;const h=Date.now();return this.calculateTargetCount(t$jscomp$0,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s$jscomp$0=this.params.maximumSequenceNumbersToCollect):s$jscomp$0=e,r=Date.now(),this.nthSequenceNumber(t$jscomp$0,
s$jscomp$0))).next(s=>(n=s,o=Date.now(),this.removeTargets(t$jscomp$0,n,e$jscomp$0))).next(e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t$jscomp$0,n))).next(t=>{(c=Date.now(),N.logLevel<=_logger.LogLevel.DEBUG)&&O("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s$jscomp$0} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-h}ms`);return pi.resolve({didRun:!0,
sequenceNumbersCollected:s$jscomp$0,targetsRemoved:i,documentsRemoved:t})})}}class Or{constructor(t,e){this.db=t;this.garbageCollector=new Mr(this,e)}Cn(t$jscomp$0){const e$jscomp$0=this.kn(t$jscomp$0);return this.db.getTargetCache().getTargetCount(t$jscomp$0).next(t=>e$jscomp$0.next(e=>t+e))}kn(t$jscomp$0){let e=0;return this.xn(t$jscomp$0,t=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}xn(t$jscomp$0,e){return this.Mn(t$jscomp$0,(t,n)=>e(n))}addReference(t,
e,n){return Fr(t,n)}removeReference(t,e,n){return Fr(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Fr(t,e)}On(t$jscomp$1,e$jscomp$0){return function(t$jscomp$0,e){let n=!1;return Di(t$jscomp$0,"mutationQueues").zt(s=>Er(t$jscomp$0,s,e).next(t=>(t&&(n=!0),pi.resolve(!t)))).next(()=>n)}(t$jscomp$1,e$jscomp$0)}removeOrphanedDocuments(t,e$jscomp$0){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Mn(t,
(r,o)=>{o<=e$jscomp$0&&(o=this.On(t,r).next(e=>{if(!e)return i++,n.getEntry(t,r).next(()=>(n.removeEntry(r,ct.min()),Dr(t).delete([0,Qs(r.path)])))}),s.push(o))}).next(()=>pi.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){e=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,e)}updateLimboDocument(t,e){return Fr(t,e)}Mn(t$jscomp$0,e){t$jscomp$0=Dr(t$jscomp$0);let s,i=nt.A;return t$jscomp$0.Wt({index:"documentTargetsIndex"},([t],{path:r,
sequenceNumber:o})=>{0===t?(i!==nt.A&&e(new xt(zs(s)),i),i=o,s=r):i=nt.A}).next(()=>{i!==nt.A&&e(new xt(zs(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}class $r{constructor(){this.changes=new $n(t=>t.toString(),(t,e)=>t.isEqual(e));this.changesApplied=!1}addEntry(t){this.assertNotApplied();this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied();this.changes.set(t,ne.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);
return void 0!==n?pi.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Br{constructor(t){this.M=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return qr(t).put(n)}removeEntry(t,e,n){t=qr(t);var JSCompiler_temp_const=t.delete;e=e.path.toArray();n=[e.slice(0,e.length-2),e[e.length-2],$i(n),e[e.length-1]];return JSCompiler_temp_const.call(t,n)}updateMetadata(t,
e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Fn(t,n)))}getEntry(t$jscomp$0,e){let n=ne.newInvalidDocument(e);return qr(t$jscomp$0).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(Kr(e))},(t,s)=>{n=this.$n(e,s)}).next(()=>n)}Bn(t$jscomp$0,e){let n={size:0,document:ne.newInvalidDocument(e)};return qr(t$jscomp$0).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(Kr(e))},(t,s)=>{n={document:this.$n(e,s),size:Ir(s)}}).next(()=>n)}getEntries(t$jscomp$0,e$jscomp$0){let n=Qn;return this.Ln(t$jscomp$0,
e$jscomp$0,(t,e)=>{e=this.$n(t,e);n=n.insert(t,e)}).next(()=>n)}Un(t$jscomp$0,e$jscomp$0){let n=Qn,s=new Bn(xt.comparator);return this.Ln(t$jscomp$0,e$jscomp$0,(t,e)=>{const i=this.$n(t,e);n=n.insert(t,i);s=s.insert(t,Ir(e))}).next(()=>({documents:n,qn:s}))}Ln(t$jscomp$0,e$jscomp$0,n){if(e$jscomp$0.isEmpty())return pi.resolve();let s$jscomp$0=new qn(Qr);e$jscomp$0.forEach(t=>s$jscomp$0=s$jscomp$0.add(t));e$jscomp$0=IDBKeyRange.bound(Kr(s$jscomp$0.first()),Kr(s$jscomp$0.last()));const r=s$jscomp$0.getIterator();
let o=r.getNext();return qr(t$jscomp$0).Wt({index:"documentKeyIndex",range:e$jscomp$0},(t,e,s)=>{for(t=xt.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);o&&0>Qr(o,t);)n(o,null),o=r.getNext();o&&o.isEqual(t)&&(n(o,e),o=r.hasNext()?r.getNext():null);o?s.Ut(Kr(o)):s.done()}).next(()=>{for(;o;)n(o,null),o=r.hasNext()?r.getNext():null})}getAllFromCollection(t$jscomp$0,e$jscomp$0,n$jscomp$0){n$jscomp$0=[e$jscomp$0.popLast().toArray(),e$jscomp$0.lastSegment(),$i(n$jscomp$0.readTime),n$jscomp$0.documentKey.path.isEmpty()?
"":n$jscomp$0.documentKey.path.lastSegment()];e$jscomp$0=[e$jscomp$0.popLast().toArray(),e$jscomp$0.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qr(t$jscomp$0).qt(IDBKeyRange.bound(n$jscomp$0,e$jscomp$0,!0)).next(t=>{let e=Qn;for(const n of t)t=this.$n(xt.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n),e=e.insert(t.key,t);return e})}getAllFromCollectionGroup(t$jscomp$0,e$jscomp$0,n$jscomp$0,s){let i=Qn;n$jscomp$0=Gr(e$jscomp$0,n$jscomp$0);e$jscomp$0=
Gr(e$jscomp$0,he.max());return qr(t$jscomp$0).Wt({index:"collectionGroupIndex",range:IDBKeyRange.bound(n$jscomp$0,e$jscomp$0,!0)},(t,e,n)=>{t=this.$n(xt.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);i=i.insert(t.key,t);i.size===s&&n.done()}).next(()=>i)}newChangeBuffer(t){return new Lr(this,!!t&&t.trackRemovals)}getSize(t$jscomp$0){return this.getMetadata(t$jscomp$0).next(t=>t.byteSize)}getMetadata(t$jscomp$0){return Di(t$jscomp$0,"remoteDocumentGlobal").get("remoteDocumentGlobalKey").next(t=>
{t||L();return t})}Fn(t,e){return Di(t,"remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)}$n(t$jscomp$0,e){if(e){a:{let n;if(e.document)n=bs(this.M.Jt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){var t=xt.fromSegments(e.noDocument.path),s=Li(e.noDocument.readTime);n=ne.newNoDocument(t,s);e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument){e=L();break a}t=xt.fromSegments(e.unknownDocument.path);s=Li(e.unknownDocument.version);n=ne.newUnknownDocument(t,
s)}e.readTime&&(t=n,s=t.setReadTime,e=e.readTime,e=new at(e[0],e[1]),e=ct.fromTimestamp(e),s.call(t,e));e=n}if(!e.isNoDocument()||!e.version.isEqual(ct.min()))return e}return ne.newInvalidDocument(t$jscomp$0)}}class Lr extends $r{constructor(t$jscomp$0,e$jscomp$0){super();this.Kn=t$jscomp$0;this.trackRemovals=e$jscomp$0;this.Gn=new $n(t=>t.toString(),(t,e)=>t.isEqual(e))}applyChanges(t$jscomp$0){const e$jscomp$0=[];let n$jscomp$0=0,s=new qn((t,e)=>rt(t.canonicalString(),e.canonicalString()));return this.changes.forEach((i,
r)=>{var o=this.Gn.get(i);if(e$jscomp$0.push(this.Kn.removeEntry(t$jscomp$0,i,o.readTime)),r.isValidDocument()){r=Fi(this.Kn.M,r);s=s.add(i.path.popLast());const a=Ir(r);n$jscomp$0+=a-o.size;e$jscomp$0.push(this.Kn.addEntry(t$jscomp$0,i,r))}else if(n$jscomp$0-=o.size,this.trackRemovals)o=Fi(this.Kn.M,r.convertToNoDocument(ct.min())),e$jscomp$0.push(this.Kn.addEntry(t$jscomp$0,i,o))}),s.forEach(n=>{e$jscomp$0.push(this.Kn.indexManager.addToCollectionParentIndex(t$jscomp$0,n))}),e$jscomp$0.push(this.Kn.updateMetadata(t$jscomp$0,
n$jscomp$0)),pi.waitFor(e$jscomp$0)}getFromCache(t$jscomp$0,e){return this.Kn.Bn(t$jscomp$0,e).next(t=>(this.Gn.set(e,{size:t.size,readTime:t.document.readTime}),t.document))}getAllFromCache(t$jscomp$0,e$jscomp$1){return this.Kn.Un(t$jscomp$0,e$jscomp$1).next(({documents:t,qn:e$jscomp$0})=>(e$jscomp$0.forEach((e,n)=>{this.Gn.set(e,{size:n,readTime:t.get(e).readTime})}),t))}}class jr{constructor(t){this.M=t}kt(t$jscomp$1,e$jscomp$0,n$jscomp$0,s$jscomp$0){const i=new Ii("createOrUpgrade",e$jscomp$0);
1>n$jscomp$0&&1<=s$jscomp$0&&(t$jscomp$1.createObjectStore("owner"),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"});t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Hs,{unique:!0});t.createObjectStore("documentMutations")}(t$jscomp$1),Wr(t$jscomp$1),t$jscomp$1.createObjectStore("remoteDocuments"));e$jscomp$0=pi.resolve();return 3>n$jscomp$0&&3<=s$jscomp$0&&(0!==n$jscomp$0&&(!function(t){t.deleteObjectStore("targetDocuments");
t.deleteObjectStore("targets");t.deleteObjectStore("targetGlobal")}(t$jscomp$1),Wr(t$jscomp$1)),e$jscomp$0=e$jscomp$0.next(()=>{const e=i.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ct.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)})),4>n$jscomp$0&&4<=s$jscomp$0&&(0!==n$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>function(t$jscomp$0,e){return e.store("mutations").qt().next(n=>{t$jscomp$0.deleteObjectStore("mutations");t$jscomp$0.createObjectStore("mutations",
{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Hs,{unique:!0});const s=e.store("mutations");n=n.map(t=>s.put(t));return pi.waitFor(n)})}(t$jscomp$1,i))),e$jscomp$0=e$jscomp$0.next(()=>{t$jscomp$1.createObjectStore("clientMetadata",{keyPath:"clientId"});!0})),5>n$jscomp$0&&5<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>this.Qn(i))),6>n$jscomp$0&&6<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>{t$jscomp$1.createObjectStore("remoteDocumentGlobal");return this.jn(i)})),7>n$jscomp$0&&
7<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>this.Wn(i))),8>n$jscomp$0&&8<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>this.zn(t$jscomp$1,i))),9>n$jscomp$0&&9<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>{t$jscomp$1.objectStoreNames.contains("remoteDocumentChanges")&&t$jscomp$1.deleteObjectStore("remoteDocumentChanges");!0})),10>n$jscomp$0&&10<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>this.Hn(i))),11>n$jscomp$0&&11<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>{t$jscomp$1.createObjectStore("bundles",
{keyPath:"bundleId"});!0;t$jscomp$1.createObjectStore("namedQueries",{keyPath:"name"})})),12>n$jscomp$0&&12<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>{const e=t$jscomp$1.createObjectStore("documentOverlays",{keyPath:hi});e.createIndex("collectionPathOverlayIndex",li,{unique:!1});e.createIndex("collectionGroupOverlayIndex",fi,{unique:!1});!0})),13>n$jscomp$0&&13<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>{const e=t$jscomp$1.createObjectStore("remoteDocumentsV14",{keyPath:Zs});e.createIndex("documentKeyIndex",
ti);e.createIndex("collectionGroupIndex",ei)}).next(()=>this.Jn(t$jscomp$1,i)).next(()=>t$jscomp$1.deleteObjectStore("remoteDocuments"))),14>n$jscomp$0&&14<=s$jscomp$0&&(e$jscomp$0=e$jscomp$0.next(()=>{t$jscomp$1.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1});t$jscomp$1.createObjectStore("indexState",{keyPath:oi}).createIndex("sequenceNumberIndex",ui,{unique:!1});t$jscomp$1.createObjectStore("indexEntries",
{keyPath:ai}).createIndex("documentKeyIndex",ci,{unique:!1});!0})),e$jscomp$0}jn(t$jscomp$0){let e=0;return t$jscomp$0.store("remoteDocuments").Wt((t,n)=>{e+=Ir(n)}).next(()=>{const n={byteSize:e};return t$jscomp$0.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Qn(t){const e$jscomp$1=t.store("mutationQueues"),n$jscomp$1=t.store("mutations");return e$jscomp$1.qt().next(e$jscomp$0=>pi.forEach(e$jscomp$0,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);
return n$jscomp$1.qt("userMutationsIndex",s).next(n$jscomp$0=>pi.forEach(n$jscomp$0,n=>{n.userId===e.userId||L();n=Ui(this.M,n);return pr(t,e.userId,n).next(()=>{})}))}))}Wn(t$jscomp$0){const e=t$jscomp$0.store("targetDocuments"),n$jscomp$1=t$jscomp$0.store("remoteDocuments");return t$jscomp$0.store("targetGlobal").get("targetGlobalKey").next(t=>{const s=[];return n$jscomp$1.Wt((n$jscomp$0,i)=>{const r=new _t(n$jscomp$0);n$jscomp$0=[0,Qs(r)];s.push(e.get(n$jscomp$0).next(n=>n?pi.resolve():e.put({targetId:0,
path:Qs(r),sequenceNumber:t.highestListenSequenceNumber})))}).next(()=>pi.waitFor(s))})}zn(t$jscomp$0,e$jscomp$0){t$jscomp$0.createObjectStore("collectionParents",{keyPath:ri});const n=e$jscomp$0.store("collectionParents"),s$jscomp$0=new hr,i=t=>{if(s$jscomp$0.add(t)){const e=t.lastSegment();t=t.popLast();return n.put({collectionId:e,parent:Qs(t)})}};return e$jscomp$0.store("remoteDocuments").Wt({jt:!0},(t,e)=>{t=new _t(t);return i(t.popLast())}).next(()=>e$jscomp$0.store("documentMutations").Wt({jt:!0},
([,e],s)=>{e=zs(e);return i(e.popLast())}))}Hn(t$jscomp$0){const e=t$jscomp$0.store("targets");return e.Wt((t,n)=>{t=qi(n);t=Ki(this.M,t);return e.put(t)})}Jn(t$jscomp$0,e){const s=[];return e.store("remoteDocuments").Wt((t,n)=>{t=e.store("remoteDocumentsV14");const r=(o=n,o.document?new xt(_t.fromString(o.document.name).popFirst(5)):o.noDocument?xt.fromSegments(o.noDocument.path):o.unknownDocument?xt.fromSegments(o.unknownDocument.path):L()).path.toArray();var o;n={prefixPath:r.slice(0,r.length-
2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};s.push(t.put(n))}).next(()=>pi.waitFor(s))}}class Hr{constructor(t$jscomp$0,e,n,s,i,r,o,u,a,c,h=13){if(this.allowTabSynchronization=t$jscomp$0,this.persistenceKey=e,this.clientId=n,this.Yn=i,this.window=r,this.document=o,this.Xn=a,this.Zn=c,this.ts=h,this.es=null,this.ns=!1,this.isPrimary=
!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=t=>Promise.resolve(),!Hr.vt())throw new Q(G.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Or(this,s);this.hs=e+"main";this.M=new Mi(u);this.ls=new Ti(this.hs,this.ts,new jr(this.M));this.fs=new Vr(this.referenceDelegate,this.M);this.ds=new Br(this.M);
this._s=new Wi;this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,!1===c&&F("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gs().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Q(G.FAILED_PRECONDITION,"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.");
return this.ys(),this.ps(),this.Is(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.fs.getHighestSequenceNumber(t))}).then(t=>{this.es=new nt(t,this.Xn)}).then(()=>{this.ns=!0}).catch(t=>(this.ls&&this.ls.close(),Promise.reject(t)))}Ts(t){return this.cs=e=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.started)return t(e)})},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ls.Ot(e=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){null===
e.newVersion&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Yn.enqueueAndForget(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.started&&(yield $jscomp$async$this.gs())})}))}gs(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t$jscomp$0=>Yr(t$jscomp$0).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>
{if(this.isPrimary)return this.Es(t$jscomp$0).next(t=>{t||(this.isPrimary=!1,this.Yn.enqueueRetryable(()=>this.cs(!1)))})}).next(()=>this.As(t$jscomp$0)).next(e=>this.isPrimary&&!e?this.Rs(t$jscomp$0).next(()=>!1):!!e&&this.Ps(t$jscomp$0).next(()=>!0))).catch(t=>{if(Ri(t))return O("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return O("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>
{this.isPrimary!==t&&this.Yn.enqueueRetryable(()=>this.cs(t));this.isPrimary=t})}Es(t$jscomp$0){return Jr(t$jscomp$0).get("owner").next(t=>pi.resolve(this.bs(t)))}Vs(t){return Yr(t).delete(this.clientId)}vs(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.isPrimary&&!$jscomp$async$this.Ss($jscomp$async$this.us,18E5)){$jscomp$async$this.us=Date.now();const t$jscomp$2=yield $jscomp$async$this.runTransaction("maybeGarbageCollectMultiClientState",
"readwrite-primary",t$jscomp$1=>{const e=Di(t$jscomp$1,"clientMetadata");return e.qt().next(t$jscomp$0=>{const n=$jscomp$async$this.Ds(t$jscomp$0,18E5),s=t$jscomp$0.filter(t=>-1===n.indexOf(t));return pi.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if($jscomp$async$this.ws)for(const e of t$jscomp$2)$jscomp$async$this.ws.removeItem($jscomp$async$this.Cs(e.clientId))}})}Is(){this.os=this.Yn.enqueueAfterDelay("client_metadata_refresh",4E3,()=>this.gs().then(()=>this.vs()).then(()=>
this.Is()))}bs(t){return!!t&&t.ownerId===this.clientId}As(t$jscomp$1){return this.Zn?pi.resolve(!0):Jr(t$jscomp$1).get("owner").next(e=>{if(null!==e&&this.Ss(e.leaseTimestampMs,5E3)&&!this.xs(e.ownerId)){if(this.bs(e)&&this.networkEnabled)return!0;if(!this.bs(e)){if(!e.allowTabSynchronization)throw new Q(G.FAILED_PRECONDITION,"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.");
return!1}}return!(!this.networkEnabled||!this.inForeground)||Yr(t$jscomp$1).qt().next(t$jscomp$0=>void 0===this.Ds(t$jscomp$0,5E3).find(t=>{if(this.clientId!==t.clientId){const n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(!this.networkEnabled&&t.networkEnabled||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&O("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.ns=
!1;$jscomp$async$this.Ns();$jscomp$async$this.os&&($jscomp$async$this.os.cancel(),$jscomp$async$this.os=null);$jscomp$async$this.ks();$jscomp$async$this.Ms();yield $jscomp$async$this.ls.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const e=new Si(t,nt.A);return $jscomp$async$this.Rs(e).next(()=>$jscomp$async$this.Vs(e))});$jscomp$async$this.ls.close();$jscomp$async$this.Os()})}Ds(t$jscomp$0,e){return t$jscomp$0.filter(t=>this.Ss(t.updateTimeMs,e)&&!this.xs(t.clientId))}Fs(){return this.runTransaction("getActiveClients",
"readonly",t$jscomp$1=>Yr(t$jscomp$1).qt().next(t$jscomp$0=>this.Ds(t$jscomp$0,18E5).map(t=>t.clientId)))}get started(){return this.ns}getMutationQueue(t,e){return Tr.Yt(t,this.M,e,this.referenceDelegate)}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getIndexManager(t){return new fr(t,this.M.Jt.databaseId)}getDocumentOverlayCache(t){return Ji.Yt(this.M,t)}getBundleCache(){return this._s}runTransaction(t$jscomp$0,e$jscomp$0,n){O("IndexedDbPersistence","Starting transaction:",
t$jscomp$0);const s$jscomp$0="readonly"===e$jscomp$0?"readonly":"readwrite",i=14===(r=this.ts)?mi:13===r?wi:12===r?_i:11===r?di:void L();var r;let o;return this.ls.runTransaction(t$jscomp$0,s$jscomp$0,i,s=>(o=new Si(s,this.es?this.es.next():nt.A),"readwrite-primary"===e$jscomp$0?this.Es(o).next(t=>!!t||this.As(o)).next(e=>{if(!e)throw F(`Failed to obtain primary lease for action '${t$jscomp$0}'.`),this.isPrimary=!1,this.Yn.enqueueRetryable(()=>this.cs(!1)),new Q(G.FAILED_PRECONDITION,"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.");
return n(o)}).next(t=>this.Ps(o).next(()=>t)):this.$s(o).next(()=>n(o)))).then(t=>(o.raiseOnCommittedEvent(),t))}$s(t$jscomp$0){return Jr(t$jscomp$0).get("owner").next(t=>{if(!(null===t||!this.Ss(t.leaseTimestampMs,5E3)||this.xs(t.ownerId)||this.bs(t)||this.Zn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Q(G.FAILED_PRECONDITION,"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.");
})}Ps(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Jr(t).put("owner",e)}static vt(){return Ti.vt()}Rs(t$jscomp$0){const e=Jr(t$jscomp$0);return e.get("owner").next(t=>this.bs(t)?(O("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):pi.resolve())}Ss(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(F(`Detected an update time that is in the future: ${t} > ${n}`),!1))}ys(){null!==this.document&&"function"==
typeof this.document.addEventListener&&(this.rs=()=>{this.Yn.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.gs()))},this.document.addEventListener("visibilitychange",this.rs),this.inForeground="visible"===this.document.visibilityState)}ks(){this.rs&&(this.document.removeEventListener("visibilitychange",this.rs),this.rs=null)}ps(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ss=()=>{this.Ns();(0,_util.isSafari)()&&
navigator.appVersion.match(/Version\/1[45]/)&&this.Yn.enterRestrictedMode(!0);this.Yn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ss))}Ms(){this.ss&&(this.window.removeEventListener("pagehide",this.ss),this.ss=null)}xs(t$jscomp$0){var e;try{const n=null!==(null===(e=this.ws)||void 0===e?void 0:e.getItem(this.Cs(t$jscomp$0)));return O("IndexedDbPersistence",`Client '${t$jscomp$0}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return F("IndexedDbPersistence",
"Failed to get zombied client id.",t),!1}}Ns(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(t){F("Failed to set zombie client id.",t)}}Os(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(t){}}Cs(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}class Zr{constructor(t,e,n){this.ds=t;this.Bs=e;this.indexManager=n}Ls(t,e){return this.Bs.getAllMutationBatchesAffectingDocumentKey(t,e).next(n=>this.Us(t,e,n))}Us(t$jscomp$0,e$jscomp$0,n){return this.ds.getEntry(t$jscomp$0,
e$jscomp$0).next(t=>{for(const e of n)e.applyToLocalView(t);return t})}qs(t$jscomp$1,e){t$jscomp$1.forEach((t$jscomp$0,n)=>{for(const t of e)t.applyToLocalView(n)})}Ks(t,e$jscomp$0){return this.ds.getEntries(t,e$jscomp$0).next(e=>this.Gs(t,e).next(()=>e))}Gs(t$jscomp$0,e){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(t$jscomp$0,e).next(t=>this.qs(e,t))}Qs(t,e,n){return xt.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length?this.js(t,e.path):null!==e.collectionGroup?this.Ws(t,
e,n):this.zs(t,e,n)}js(t$jscomp$0,e$jscomp$0){return this.Ls(t$jscomp$0,new xt(e$jscomp$0)).next(t=>{let e=Wn;return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}Ws(t$jscomp$1,e$jscomp$0,n){const s=e$jscomp$0.collectionGroup;let i=Wn;return this.indexManager.getCollectionParents(t$jscomp$1,s).next(r$jscomp$0=>pi.forEach(r$jscomp$0,r=>{r=function(t,e){return new Me(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e$jscomp$0,r.child(s));return this.zs(t$jscomp$1,
r,n).next(t$jscomp$0=>{t$jscomp$0.forEach((t,e)=>{i=i.insert(t,e)})})}).next(()=>i))}zs(t$jscomp$1,e$jscomp$0,n$jscomp$0){let s;return this.ds.getAllFromCollection(t$jscomp$1,e$jscomp$0.path,n$jscomp$0).next(n=>(s=n,this.Bs.getAllMutationBatchesAffectingQuery(t$jscomp$1,e$jscomp$0))).next(t$jscomp$0=>{for(const e of t$jscomp$0)for(const t of e.mutations){t$jscomp$0=t.key;let i=s.get(t$jscomp$0);null==i&&(i=ne.newInvalidDocument(t$jscomp$0),s=s.insert(t$jscomp$0,i));En(t,i,e.localWriteTime);i.isFoundDocument()||
(s=s.remove(t$jscomp$0))}}).next(()=>(s.forEach((t,n)=>{He(e$jscomp$0,n)||(s=s.remove(t))}),s))}}class to{constructor(t,e,n,s){this.targetId=t;this.fromCache=e;this.Hs=n;this.Js=s}static Ys(t$jscomp$0,e){let n=Xn(),s=Xn();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new to(t$jscomp$0,e.fromCache,n,s)}}class eo{Xs(t){this.Zs=t}Qs(t$jscomp$0,e$jscomp$0,n,s){return 0===e$jscomp$0.filters.length&&null===e$jscomp$0.limit&&null==e$jscomp$0.startAt&&
null==e$jscomp$0.endAt&&(0===e$jscomp$0.explicitOrderBy.length||1===e$jscomp$0.explicitOrderBy.length&&e$jscomp$0.explicitOrderBy[0].field.isKeyField())||n.isEqual(ct.min())?this.ti(t$jscomp$0,e$jscomp$0):this.Zs.Ks(t$jscomp$0,s).next(i=>{const r=this.ei(e$jscomp$0,i);return($e(e$jscomp$0)||Be(e$jscomp$0))&&this.ni(e$jscomp$0.limitType,r,s,n)?this.ti(t$jscomp$0,e$jscomp$0):(N.logLevel<=_logger.LogLevel.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ze(e$jscomp$0)),
this.Zs.Qs(t$jscomp$0,e$jscomp$0,ae(n,-1)).next(t=>(r.forEach(e=>{t=t.insert(e.key,e)}),t)))})}ei(t,e$jscomp$0){let n=new qn(Ye(t));return e$jscomp$0.forEach((e,s)=>{He(t,s)&&(n=n.add(s))}),n}ni(t,e,n,s){if(n.size!==e.size)return!0;t="F"===t?e.last():e.first();return!!t&&(t.hasPendingWrites||0<t.version.compareTo(s))}ti(t,e){return N.logLevel<=_logger.LogLevel.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",ze(e)),this.Zs.Qs(t,e,he.min())}}class no{constructor(t$jscomp$0,e,n,
s){this.persistence=t$jscomp$0;this.si=e;this.M=s;this.ii=new Bn(rt);this.ri=new $n(t=>_e(t),me);this.oi=new Map;this.ui=t$jscomp$0.getRemoteDocumentCache();this.fs=t$jscomp$0.getTargetCache();this._s=t$jscomp$0.getBundleCache();this.ai(n)}ai(t){this.indexManager=this.persistence.getIndexManager(t);this.Bs=this.persistence.getMutationQueue(t,this.indexManager);this.ci=new Zr(this.ui,this.Bs,this.indexManager);this.ui.setIndexManager(this.indexManager);this.si.Xs(this.ci)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage",
"readwrite-primary",e=>t.collect(e,this.ii))}}class po{constructor(t){this.M=t;this.wi=new Map;this.mi=new Map}getBundleMetadata(t,e){return pi.resolve(this.wi.get(e))}saveBundleMetadata(t,e){return this.wi.set(e.id,{id:e.id,version:e.version,createTime:ms(e.createTime)}),pi.resolve()}getNamedQuery(t,e){return pi.resolve(this.mi.get(e))}saveNamedQuery(t,e){t=this.mi;var JSCompiler_temp_const=t.set,JSCompiler_temp_const$jscomp$0=e.name;e={name:e.name,query:Gi(e.bundledQuery),readTime:ms(e.readTime)};
return JSCompiler_temp_const.call(t,JSCompiler_temp_const$jscomp$0,e),pi.resolve()}}class Io{constructor(){this.overlays=new Bn(xt.comparator);this.gi=new Map}getOverlay(t,e){return pi.resolve(this.overlays.get(e))}saveOverlays(t,e,n$jscomp$0){return n$jscomp$0.forEach((n,s)=>{this.Xt(t,e,s)}),pi.resolve()}removeOverlaysForBatchId(t$jscomp$0,e,n){t$jscomp$0=this.gi.get(n);return void 0!==t$jscomp$0&&(t$jscomp$0.forEach(t=>this.overlays=this.overlays.remove(t)),this.gi.delete(n)),pi.resolve()}getOverlaysForCollection(t$jscomp$0,
e,n){t$jscomp$0=Hn();const i=e.length+1;var r$jscomp$0=new xt(e.child(""));for(r$jscomp$0=this.overlays.getIteratorFrom(r$jscomp$0);r$jscomp$0.hasNext();){const t=r$jscomp$0.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&t$jscomp$0.set(t.getKey(),t)}return pi.resolve(t$jscomp$0)}getOverlaysForCollectionGroup(t$jscomp$0,e$jscomp$0,n,s){t$jscomp$0=new Bn((t,e)=>t-e);const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===
e$jscomp$0&&t.largestBatchId>n){let e=t$jscomp$0.get(t.largestBatchId);null===e&&(e=Hn(),t$jscomp$0=t$jscomp$0.insert(t.largestBatchId,e));e.set(t.getKey(),t)}}const o=Hn();for(e$jscomp$0=t$jscomp$0.getIterator();e$jscomp$0.hasNext()&&!(e$jscomp$0.getNext().value.forEach((t,e)=>o.set(t,e)),o.size()>=s););return pi.resolve(o)}Xt(t$jscomp$0,e,n){if(null!==n){t$jscomp$0=this.overlays.get(n.key);if(null!==t$jscomp$0){const t=this.gi.get(t$jscomp$0.largestBatchId).delete(n.key);this.gi.set(t$jscomp$0.largestBatchId,
t)}this.overlays=this.overlays.insert(n.key,new Ni(e,n));t$jscomp$0=this.gi.get(e);void 0===t$jscomp$0&&(t$jscomp$0=Xn(),this.gi.set(e,t$jscomp$0));this.gi.set(e,t$jscomp$0.add(n.key))}}}class To{constructor(){this.yi=new qn(Eo.pi);this.Ii=new qn(Eo.Ti)}isEmpty(){return this.yi.isEmpty()}addReference(t,e){t=new Eo(t,e);this.yi=this.yi.add(t);this.Ii=this.Ii.add(t)}Ei(t$jscomp$0,e){t$jscomp$0.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Ai(new Eo(t,e))}Ri(t$jscomp$0,e){t$jscomp$0.forEach(t=>
this.removeReference(t,e))}Pi(t$jscomp$0){const e=new xt(new _t([])),n=new Eo(e,t$jscomp$0);t$jscomp$0=new Eo(e,t$jscomp$0+1);const i=[];return this.Ii.forEachInRange([n,t$jscomp$0],t=>{this.Ai(t);i.push(t.key)}),i}bi(){this.yi.forEach(t=>this.Ai(t))}Ai(t){this.yi=this.yi.delete(t);this.Ii=this.Ii.delete(t)}Vi(t$jscomp$0){const e=new xt(new _t([])),n=new Eo(e,t$jscomp$0);t$jscomp$0=new Eo(e,t$jscomp$0+1);let i=Xn();return this.Ii.forEachInRange([n,t$jscomp$0],t=>{i=i.add(t.key)}),i}containsKey(t){var e=
new Eo(t,0);e=this.yi.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)}}class Eo{constructor(t,e){this.key=t;this.vi=e}static pi(t,e){return xt.comparator(t.key,e.key)||rt(t.vi,e.vi)}static Ti(t,e){return rt(t.vi,e.vi)||xt.comparator(t.key,e.key)}}class Ao{constructor(t,e){this.indexManager=t;this.referenceDelegate=e;this.Bs=[];this.Si=1;this.Di=new qn(Eo.pi)}checkEmpty(t){return pi.resolve(0===this.Bs.length)}addMutationBatch(t,e$jscomp$0,n,s){const i=this.Si;this.Si++;0<this.Bs.length&&this.Bs[this.Bs.length-
1];e$jscomp$0=new Ci(i,e$jscomp$0,n,s);this.Bs.push(e$jscomp$0);for(const e of s)this.Di=this.Di.add(new Eo(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return pi.resolve(e$jscomp$0)}lookupMutationBatch(t,e){return pi.resolve(this.Ci(e))}getNextMutationBatchAfterBatchId(t,e){t=this.xi(e+1);t=0>t?0:t;return pi.resolve(this.Bs.length>t?this.Bs[t]:null)}getHighestUnacknowledgedBatchId(){return pi.resolve(0===this.Bs.length?-1:this.Si-1)}getAllMutationBatches(t){return pi.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(t$jscomp$0,
e){t$jscomp$0=new Eo(e,0);e=new Eo(e,Number.POSITIVE_INFINITY);const i=[];return this.Di.forEachInRange([t$jscomp$0,e],t=>{t=this.Ci(t.vi);i.push(t)}),pi.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t$jscomp$1,e$jscomp$0){let n=new qn(rt);return e$jscomp$0.forEach(t$jscomp$0=>{const e=new Eo(t$jscomp$0,0);t$jscomp$0=new Eo(t$jscomp$0,Number.POSITIVE_INFINITY);this.Di.forEachInRange([e,t$jscomp$0],t=>{n=n.add(t.vi)})}),pi.resolve(this.Ni(n))}getAllMutationBatchesAffectingQuery(t$jscomp$0,
e$jscomp$0){const n=e$jscomp$0.path,s=n.length+1;t$jscomp$0=n;xt.isDocumentKey(t$jscomp$0)||(t$jscomp$0=t$jscomp$0.child(""));t$jscomp$0=new Eo(new xt(t$jscomp$0),0);let o=new qn(rt);return this.Di.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.vi)),!0)},t$jscomp$0),pi.resolve(this.Ni(o))}Ni(t$jscomp$0){const e=[];return t$jscomp$0.forEach(t=>{t=this.Ci(t);null!==t&&e.push(t)}),e}removeMutationBatch(t,e){U(0===this.ki(e.batchId,"removed"));this.Bs.shift();let n=
this.Di;return pi.forEach(e.mutations,s=>{const i=new Eo(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Di=n})}_n(t){}containsKey(t,e){t=new Eo(e,0);t=this.Di.firstAfterOrEqual(t);return pi.resolve(e.isEqual(t&&t.key))}performConsistencyCheck(t){return this.Bs.length,pi.resolve()}ki(t,e){return this.xi(t)}xi(t){return 0===this.Bs.length?0:t-this.Bs[0].batchId}Ci(t){t=this.xi(t);return 0>t||t>=this.Bs.length?null:this.Bs[t]}}class Ro{constructor(t){this.Mi=
t;this.docs=new Bn(xt.comparator);this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key;var s=this.docs.get(n);s=s?s.size:0;const r=this.Mi(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){t=this.docs.get(e);return pi.resolve(t?t.document.mutableCopy():ne.newInvalidDocument(e))}getEntries(t$jscomp$0,
e$jscomp$0){let n=Qn;return e$jscomp$0.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ne.newInvalidDocument(t))}),pi.resolve(n)}getAllFromCollection(t$jscomp$1,e$jscomp$0,n$jscomp$0){t$jscomp$1=Qn;var i$jscomp$0=new xt(e$jscomp$0.child(""));for(i$jscomp$0=this.docs.getIteratorFrom(i$jscomp$0);i$jscomp$0.hasNext();){const {key:t,value:{document:i}}=i$jscomp$0.getNext();if(!e$jscomp$0.isPrefixOf(t.path))break;var JSCompiler_temp;if(!(JSCompiler_temp=t.path.length>e$jscomp$0.length+
1)){var t$jscomp$0=new he(i.readTime,i.key,-1),e=n$jscomp$0;let n=t$jscomp$0.readTime.compareTo(e.readTime);JSCompiler_temp=0>=(0!==n?n:(n=xt.comparator(t$jscomp$0.documentKey,e.documentKey),0!==n?n:rt(t$jscomp$0.largestBatchId,e.largestBatchId)))}JSCompiler_temp||(t$jscomp$1=t$jscomp$1.insert(i.key,i.mutableCopy()))}return pi.resolve(t$jscomp$1)}getAllFromCollectionGroup(t,e,n,s){L()}Oi(t$jscomp$0,e){return pi.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new Po(this)}getSize(t){return pi.resolve(this.size)}}
class Po extends $r{constructor(t){super();this.Kn=t}applyChanges(t){const e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Kn.addEntry(t,s)):this.Kn.removeEntry(n)}),pi.waitFor(e)}getFromCache(t,e){return this.Kn.getEntry(t,e)}getAllFromCache(t,e){return this.Kn.getEntries(t,e)}}class bo{constructor(t$jscomp$0){this.persistence=t$jscomp$0;this.Fi=new $n(t=>_e(t),me);this.lastRemoteSnapshotVersion=ct.min();this.$i=this.highestTargetId=0;this.Bi=new To;this.targetCount=0;this.Li=
br.gn()}forEachTarget(t$jscomp$0,e){return this.Fi.forEach((t,n)=>e(n)),pi.resolve()}getLastRemoteSnapshotVersion(t){return pi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return pi.resolve(this.$i)}allocateTargetId(t){return this.highestTargetId=this.Li.next(),pi.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.$i&&(this.$i=e),pi.resolve()}Tn(t){this.Fi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Li=
new br(e),this.highestTargetId=e);t.sequenceNumber>this.$i&&(this.$i=t.sequenceNumber)}addTargetData(t,e){return this.Tn(e),this.targetCount+=1,pi.resolve()}updateTargetData(t,e){return this.Tn(e),pi.resolve()}removeTargetData(t,e){return this.Fi.delete(e.target),this.Bi.Pi(e.targetId),--this.targetCount,pi.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Fi.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Fi.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),
s++)}),pi.waitFor(i).next(()=>s)}getTargetCount(t){return pi.resolve(this.targetCount)}getTargetData(t,e){t=this.Fi.get(e)||null;return pi.resolve(t)}addMatchingKeys(t,e,n){return this.Bi.Ei(e,n),pi.resolve()}removeMatchingKeys(t,e$jscomp$0,n){this.Bi.Ri(e$jscomp$0,n);const s=this.persistence.referenceDelegate,i=[];return s&&e$jscomp$0.forEach(e=>{i.push(s.markPotentiallyOrphaned(t,e))}),pi.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Bi.Pi(e),pi.resolve()}getMatchingKeysForTargetId(t,
e){t=this.Bi.Vi(e);return pi.resolve(t)}containsKey(t,e){return pi.resolve(this.Bi.containsKey(e))}}class Vo{constructor(t$jscomp$0,e){this.Ui={};this.overlays={};this.es=new nt(0);this.ns=!1;this.ns=!0;this.referenceDelegate=t$jscomp$0(this);this.fs=new bo(this);this.indexManager=new cr;this.ds=new Ro(t=>this.referenceDelegate.qi(t));this.M=new Mi(e);this._s=new po(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=
this.overlays[t.toKey()];return e||(e=new Io,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Ui[t.toKey()];return n||(n=new Ao(e,this.referenceDelegate),this.Ui[t.toKey()]=n),n}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(t$jscomp$0,e,n){O("MemoryPersistence","Starting transaction:",t$jscomp$0);const s=new vo(this.es.next());return this.referenceDelegate.Ki(),n(s).next(t=>this.referenceDelegate.Gi(s).next(()=>
t)).toPromise().then(t=>(s.raiseOnCommittedEvent(),t))}Qi(t,e){return pi.or(Object.values(this.Ui).map(n=>()=>n.containsKey(t,e)))}}class vo extends yi{constructor(t){super();this.currentSequenceNumber=t}}class So{constructor(t){this.persistence=t;this.ji=new To;this.Wi=null}static zi(t){return new So(t)}get Hi(){if(this.Wi)return this.Wi;throw L();}addReference(t,e,n){return this.ji.addReference(n,e),this.Hi.delete(n.toString()),pi.resolve()}removeReference(t,e,n){return this.ji.removeReference(n,
e),this.Hi.add(n.toString()),pi.resolve()}markPotentiallyOrphaned(t,e){return this.Hi.add(e.toString()),pi.resolve()}removeTarget(t$jscomp$1,e){this.ji.Pi(e.targetId).forEach(t=>this.Hi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t$jscomp$1,e.targetId).next(t$jscomp$0=>{t$jscomp$0.forEach(t=>this.Hi.add(t.toString()))}).next(()=>n.removeTargetData(t$jscomp$1,e))}Ki(){this.Wi=new Set}Gi(t$jscomp$0){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();
return pi.forEach(this.Hi,n=>{const s=xt.fromPath(n);return this.Ji(t$jscomp$0,s).next(t=>{t||e.removeEntry(s,ct.min())})}).next(()=>(this.Wi=null,e.apply(t$jscomp$0)))}updateLimboDocument(t$jscomp$0,e){return this.Ji(t$jscomp$0,e).next(t=>{t?this.Hi.delete(e.toString()):this.Hi.add(e.toString())})}qi(t){return 0}Ji(t,e){return pi.or([()=>pi.resolve(this.ji.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Qi(t,e)])}}class No{constructor(t,e,n,s){this.user=
t;this.batchId=e;this.state=n;this.error=s}static Yi(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new Q(s.error.code,s.error.message))),r?new No(t,e,s.state,i):(F("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Xi(){const t={state:this.state,updateTimeMs:Date.now()};
return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ko{constructor(t,e,n){this.targetId=t;this.state=e;this.error=n}static Yi(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new Q(n.error.code,n.error.message))),i?new ko(t,n.state,s):(F("SharedClientState",
`Failed to parse target state for ID '${t}': ${e}`),null)}Xi(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Mo{constructor(t,e){this.clientId=t;this.activeTargetIds=e}static Yi(t$jscomp$0,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=Zn;for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Ct(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?
new Mo(t$jscomp$0,i):(F("SharedClientState",`Failed to parse client data for instance '${t$jscomp$0}': ${e}`),null)}}class Oo{constructor(t,e){this.clientId=t;this.onlineState=e}static Yi(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Oo(e.clientId,e.onlineState):(F("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Fo{constructor(){this.activeTargetIds=Zn}Zi(t){this.activeTargetIds=
this.activeTargetIds.add(t)}tr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Xi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class $o{constructor(t,e,n,s,i){this.window=t;this.Yn=e;this.persistenceKey=n;this.er=s;this.sequenceNumberHandler=this.onlineStateHandler=this.syncEngine=null;this.nr=this.sr.bind(this);this.ir=new Bn(rt);this.started=!1;this.rr=[];t=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$\x26");this.storage=this.window.localStorage;
this.currentUser=i;this.ur=`firestore_clients_${this.persistenceKey}_${this.er}`;this.ar=`firestore_sequence_number_${this.persistenceKey}`;this.ir=this.ir.insert(this.er,new Fo);this.cr=new RegExp(`^firestore_clients_${t}_([^_]*)$`);this.hr=new RegExp(`^firestore_mutations_${t}_(\\d+)(?:_(.*))?$`);this.lr=new RegExp(`^firestore_targets_${t}_(\\d+)$`);this.dr=`firestore_online_state_${this.persistenceKey}`;this._r=`firestore_bundle_loaded_v2_${this.persistenceKey}`;this.window.addEventListener("storage",
this.nr)}static vt(t){return!(!t||!t.localStorage)}start(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var t$jscomp$0=yield $jscomp$async$this.syncEngine.Fs();for(var e of t$jscomp$0)e!==$jscomp$async$this.er&&(t$jscomp$0=$jscomp$async$this.getItem(`firestore_clients_${$jscomp$async$this.persistenceKey}_${e}`))&&(t$jscomp$0=Mo.Yi(e,t$jscomp$0))&&($jscomp$async$this.ir=$jscomp$async$this.ir.insert(t$jscomp$0.clientId,t$jscomp$0));$jscomp$async$this.wr();
(e=$jscomp$async$this.storage.getItem($jscomp$async$this.dr))&&(e=$jscomp$async$this.mr(e))&&$jscomp$async$this.gr(e);for(const t of $jscomp$async$this.rr)$jscomp$async$this.sr(t);$jscomp$async$this.rr=[];$jscomp$async$this.window.addEventListener("pagehide",()=>$jscomp$async$this.shutdown());$jscomp$async$this.started=!0})}writeSequenceNumber(t){this.setItem(this.ar,JSON.stringify(t))}getAllActiveQueryTargets(){return this.yr(this.ir)}isActiveQueryTarget(t){let e=!1;return this.ir.forEach((n,s)=>
{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.pr(t,"pending")}updateMutationState(t,e,n){this.pr(t,e,n);this.Ir(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(xo(this.persistenceKey,t));n&&(n=ko.Yi(t,n))&&(e=n.state)}return this.Tr.Zi(t),this.wr(),e}removeLocalQueryTarget(t){this.Tr.tr(t);this.wr()}isLocalQueryTarget(t){return this.Tr.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(xo(this.persistenceKey,t))}updateQueryState(t,
e,n){this.Er(t,e,n)}handleUserChange(t$jscomp$0,e,n){e.forEach(t=>{this.Ir(t)});this.currentUser=t$jscomp$0;n.forEach(t=>{this.addPendingMutation(t)})}setOnlineState(t){this.Ar(t)}notifyBundleLoaded(t){this.Rr(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.nr),this.removeItem(this.ur),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return O("SharedClientState","READ",t,e),e}setItem(t,e){O("SharedClientState","SET",t,e);this.storage.setItem(t,e)}removeItem(t){O("SharedClientState",
"REMOVE",t);this.storage.removeItem(t)}sr(t$jscomp$2){if(t$jscomp$2.storageArea===this.storage){if(O("SharedClientState","EVENT",t$jscomp$2.key,t$jscomp$2.newValue),t$jscomp$2.key===this.ur)return void F("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Yn.enqueueRetryable(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.started){if(null!==t$jscomp$2.key)if($jscomp$async$this.cr.test(t$jscomp$2.key)){if(null==
t$jscomp$2.newValue){var t$jscomp$1=$jscomp$async$this.Pr(t$jscomp$2.key);return $jscomp$async$this.br(t$jscomp$1,null)}if(t$jscomp$1=$jscomp$async$this.Vr(t$jscomp$2.key,t$jscomp$2.newValue))return $jscomp$async$this.br(t$jscomp$1.clientId,t$jscomp$1)}else if($jscomp$async$this.hr.test(t$jscomp$2.key)){if(null!==t$jscomp$2.newValue&&(t$jscomp$1=$jscomp$async$this.vr(t$jscomp$2.key,t$jscomp$2.newValue)))return $jscomp$async$this.Sr(t$jscomp$1)}else if($jscomp$async$this.lr.test(t$jscomp$2.key)){if(null!==
t$jscomp$2.newValue&&(t$jscomp$1=$jscomp$async$this.Dr(t$jscomp$2.key,t$jscomp$2.newValue)))return $jscomp$async$this.Cr(t$jscomp$1)}else if(t$jscomp$2.key===$jscomp$async$this.dr){if(null!==t$jscomp$2.newValue&&(t$jscomp$1=$jscomp$async$this.mr(t$jscomp$2.newValue)))return $jscomp$async$this.gr(t$jscomp$1)}else t$jscomp$2.key===$jscomp$async$this.ar?(t$jscomp$1=function(t$jscomp$0){let e=nt.A;if(null!=t$jscomp$0)try{const n=JSON.parse(t$jscomp$0);"number"==typeof n||L();e=n}catch(t){F("SharedClientState",
"Failed to read sequence number from WebStorage",t)}return e}(t$jscomp$2.newValue),t$jscomp$1!==nt.A&&$jscomp$async$this.sequenceNumberHandler(t$jscomp$1)):t$jscomp$2.key===$jscomp$async$this._r&&(t$jscomp$1=$jscomp$async$this.Nr(t$jscomp$2.newValue),yield Promise.all(t$jscomp$1.map(t=>$jscomp$async$this.syncEngine.kr(t))))}else $jscomp$async$this.rr.push(t$jscomp$2)})})}}get Tr(){return this.ir.get(this.er)}wr(){this.setItem(this.ur,this.Tr.Xi())}pr(t,e,n){e=new No(this.currentUser,t,e,n);t=Co(this.persistenceKey,
this.currentUser,t);this.setItem(t,e.Xi())}Ir(t){t=Co(this.persistenceKey,this.currentUser,t);this.removeItem(t)}Ar(t){this.storage.setItem(this.dr,JSON.stringify({clientId:this.er,onlineState:t}))}Er(t,e,n){const s=xo(this.persistenceKey,t);t=new ko(t,e,n);this.setItem(s,t.Xi())}Rr(t){t=JSON.stringify(Array.from(t));this.setItem(this._r,t)}Pr(t){return(t=this.cr.exec(t))?t[1]:null}Vr(t,e){t=this.Pr(t);return Mo.Yi(t,e)}vr(t,e){t=this.hr.exec(t);const s=Number(t[1]);return No.Yi(new C(void 0!==t[2]?
t[2]:null),s,e)}Dr(t,e){t=this.lr.exec(t);return ko.Yi(Number(t[1]),e)}mr(t){return Oo.Yi(t)}Nr(t){return JSON.parse(t)}Sr(t){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(t.user.uid===$jscomp$async$this.currentUser.uid)return $jscomp$async$this.syncEngine.Mr(t.batchId,t.state,t.error);O("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Cr(t){return this.syncEngine.Or(t.targetId,t.state,t.error)}br(t$jscomp$0,e){const n=
e?this.ir.insert(t$jscomp$0,e):this.ir.remove(t$jscomp$0),s=this.yr(this.ir),i=this.yr(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.syncEngine.Fr(r,o).then(()=>{this.ir=n})}gr(t){this.ir.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}yr(t$jscomp$0){let e=Zn;return t$jscomp$0.forEach((t,n)=>{e=e.unionWith(n.activeTargetIds)}),e}}class Bo{constructor(){this.$r=new Fo;this.Br={};this.sequenceNumberHandler=this.onlineStateHandler=null}addPendingMutation(t){}updateMutationState(t,
e,n){}addLocalQueryTarget(t){return this.$r.Zi(t),this.Br[t]||"not-current"}updateQueryState(t,e,n){this.Br[t]=e}removeLocalQueryTarget(t){this.$r.tr(t)}isLocalQueryTarget(t){return this.$r.activeTargetIds.has(t)}clearQueryState(t){delete this.Br[t]}getAllActiveQueryTargets(){return this.$r.activeTargetIds}isActiveQueryTarget(t){return this.$r.activeTargetIds.has(t)}start(){return this.$r=new Fo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}
class Lo{Lr(t){}shutdown(){}}class Uo{constructor(){this.Ur=()=>this.qr();this.Kr=()=>this.Gr();this.Qr=[];this.jr()}Lr(t){this.Qr.push(t)}shutdown(){window.removeEventListener("online",this.Ur);window.removeEventListener("offline",this.Kr)}jr(){window.addEventListener("online",this.Ur);window.addEventListener("offline",this.Kr)}qr(){O("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Qr)t(0)}Gr(){O("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");
for(const t of this.Qr)t(1)}static vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const qo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Ko{constructor(t){this.Wr=t.Wr;this.zr=t.zr}Hr(t){this.Jr=t}Yr(t){this.Xr=t}onMessage(t){this.Zr=t}close(){this.zr()}send(t){this.Wr(t)}eo(){this.Jr()}no(t){this.Xr(t)}so(t){this.Zr(t)}}class Go extends class{constructor(t){this.databaseInfo=t;this.databaseId=t.databaseId;this.io=
(t.ssl?"https":"http")+"://"+t.host;this.ro="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}oo(t$jscomp$0,e$jscomp$0,n,s,i){const r=this.uo(t$jscomp$0,e$jscomp$0);O("RestConnection","Sending: ",r,n);e$jscomp$0={};return this.ao(e$jscomp$0,s,i),this.co(t$jscomp$0,r,e$jscomp$0,n).then(t=>(O("RestConnection","Received: ",t),t),e=>{throw $("RestConnection",`${t$jscomp$0} failed with error: `,e,"url: ",r,"request:",n),e;})}ho(t,e,n,s,i){return this.oo(t,e,n,s,
i)}ao(t,e$jscomp$0,n$jscomp$0){t["X-Goog-Api-Client"]="gl-js/ fire/"+x;t["Content-Type"]="text/plain";this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId);e$jscomp$0&&e$jscomp$0.headers.forEach((e,n)=>t[n]=e);n$jscomp$0&&n$jscomp$0.headers.forEach((e,n)=>t[n]=e)}uo(t,e){return`${this.io}/v1/${e}:${qo[t]}`}}{constructor(t){super(t);this.forceLongPolling=t.forceLongPolling;this.autoDetectLongPolling=t.autoDetectLongPolling;this.useFetchStreams=t.useFetchStreams}co(t$jscomp$0,e$jscomp$1,
n$jscomp$0,s){return new Promise((i,r)=>{const o=new _webchannelWrapper.XhrIo;o.listenOnce(_webchannelWrapper.EventType.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case _webchannelWrapper.ErrorCode.NO_ERROR:const e$jscomp$0=o.getResponseJson();O("Connection","XHR received:",JSON.stringify(e$jscomp$0));i(e$jscomp$0);break;case _webchannelWrapper.ErrorCode.TIMEOUT:O("Connection",'RPC "'+t$jscomp$0+'" timed out');r(new Q(G.DEADLINE_EXCEEDED,"Request time out"));break;case _webchannelWrapper.ErrorCode.HTTP_ERROR:const n=
o.getStatus();if(O("Connection",'RPC "'+t$jscomp$0+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=t.status.toLowerCase().replace(/_/g,"-");var JSCompiler_inline_result=0<=Object.values(G).indexOf(e)?e:G.UNKNOWN;r(new Q(JSCompiler_inline_result,t.message))}else r(new Q(G.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Q(G.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{O("Connection",
'RPC "'+t$jscomp$0+'" completed.')}});const u=JSON.stringify(s);o.send(e$jscomp$1,"POST",u,n$jscomp$0,15)})}lo(t$jscomp$2,e$jscomp$0,n$jscomp$1){const s=[this.io,"/","google.firestore.v1.Firestore","/",t$jscomp$2,"/channel"],i=(0,_webchannelWrapper.createWebChannelTransport)();t$jscomp$2=(0,_webchannelWrapper.getStatEventTarget)();const o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},
sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6E5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new _webchannelWrapper.FetchXmlHttpFactory({}));this.ao(o.initMessageHeaders,e$jscomp$0,n$jscomp$1);(0,_util.isMobileCordova)()||(0,_util.isReactNative)()||(0,_util.isElectron)()||(0,_util.isIE)()||(0,_util.isUWP)()||(0,_util.isBrowserExtension)()||(o.httpHeadersOverwriteParam=
"$httpHeaders");e$jscomp$0=s.join("");O("Connection","Creating WebChannel: "+e$jscomp$0,o);const a=i.createWebChannel(e$jscomp$0,o);let c=!1,h=!1;const l=new Ko({Wr:t=>{h?O("Connection","Not sending because WebChannel is closed:",t):(c||(O("Connection","Opening WebChannel transport."),a.open(),c=!0),O("Connection","WebChannel sending:",t),a.send(t))},zr:()=>a.close()});e$jscomp$0=(t$jscomp$1,e,n)=>{t$jscomp$1.listen(e,t$jscomp$0=>{try{n(t$jscomp$0)}catch(t){setTimeout(()=>{throw t;},0)}})};return e$jscomp$0(a,
_webchannelWrapper.WebChannel.EventType.OPEN,()=>{h||O("Connection","WebChannel transport opened.")}),e$jscomp$0(a,_webchannelWrapper.WebChannel.EventType.CLOSE,()=>{h||(h=!0,O("Connection","WebChannel transport closed"),l.no())}),e$jscomp$0(a,_webchannelWrapper.WebChannel.EventType.ERROR,t=>{h||(h=!0,$("Connection","WebChannel transport errored:",t),l.no(new Q(G.UNAVAILABLE,"The operation could not be completed")))}),e$jscomp$0(a,_webchannelWrapper.WebChannel.EventType.MESSAGE,t=>{var e;if(!h){var n$jscomp$0=
t.data[0];n$jscomp$0||L();if(t=n$jscomp$0.error||(null===(e=n$jscomp$0[0])||void 0===e?void 0:e.error)){O("Connection","WebChannel received error:",t);e=t.status;n$jscomp$0=kn[e];n$jscomp$0=void 0!==n$jscomp$0?Fn(n$jscomp$0):void 0;let n=t.message;void 0===n$jscomp$0&&(n$jscomp$0=G.INTERNAL,n="Unknown error status: "+e+" with message "+t.message);h=!0;l.no(new Q(n$jscomp$0,n));a.close()}else O("Connection","WebChannel received:",n$jscomp$0),l.so(n$jscomp$0)}}),e$jscomp$0(t$jscomp$2,_webchannelWrapper.Event.STAT_EVENT,
t=>{t.stat===_webchannelWrapper.Stat.PROXY?O("Connection","Detected buffering proxy"):t.stat===_webchannelWrapper.Stat.NOPROXY&&O("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.eo()},0),l}}class zo{constructor(t,e,n=1E3,s=1.5,i=6E4){this.Yn=t;this.timerId=e;this.fo=n;this._o=s;this.wo=i;this.mo=0;this.yo=null;this.po=Date.now();this.reset()}reset(){this.mo=0}Io(){this.mo=this.wo}To(t){this.cancel();const e=Math.floor(this.mo+this.Eo()),n=Math.max(0,Date.now()-this.po),s=Math.max(0,
e-n);0<s&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.mo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`);this.yo=this.Yn.enqueueAfterDelay(this.timerId,s,()=>(this.po=Date.now(),t()));this.mo*=this._o;this.mo<this.fo&&(this.mo=this.fo);this.mo>this.wo&&(this.mo=this.wo)}Ao(){null!==this.yo&&(this.yo.skipDelay(),this.yo=null)}cancel(){null!==this.yo&&(this.yo.cancel(),this.yo=null)}Eo(){return(Math.random()-.5)*this.mo}}class Ho{constructor(t,e,n,s,i,r,o,u){this.Yn=
t;this.Ro=n;this.Po=s;this.bo=i;this.authCredentialsProvider=r;this.appCheckCredentialsProvider=o;this.listener=u;this.Vo=this.state=0;this.stream=this.So=this.vo=null;this.Do=new zo(t,e)}Co(){return 1===this.state||5===this.state||this.xo()}xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.No()}stop(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.Co()&&(yield $jscomp$async$this.close(0))})}ko(){this.state=
0;this.Do.reset()}Mo(){this.xo()&&null===this.vo&&(this.vo=this.Yn.enqueueAfterDelay(this.Ro,6E4,()=>this.Oo()))}Fo(t){this.$o();this.stream.send(t)}Oo(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.xo())return $jscomp$async$this.close(0)})}$o(){this.vo&&(this.vo.cancel(),this.vo=null)}Bo(){this.So&&(this.So.cancel(),this.So=null)}close(t,e){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.$o();
$jscomp$async$this.Bo();$jscomp$async$this.Do.cancel();$jscomp$async$this.Vo++;4!==t?$jscomp$async$this.Do.reset():e&&e.code===G.RESOURCE_EXHAUSTED?(F(e.toString()),F("Using maximum backoff delay to prevent overloading the backend."),$jscomp$async$this.Do.Io()):e&&e.code===G.UNAUTHENTICATED&&3!==$jscomp$async$this.state&&($jscomp$async$this.authCredentialsProvider.invalidateToken(),$jscomp$async$this.appCheckCredentialsProvider.invalidateToken());null!==$jscomp$async$this.stream&&($jscomp$async$this.Lo(),
$jscomp$async$this.stream.close(),$jscomp$async$this.stream=null);$jscomp$async$this.state=t;yield $jscomp$async$this.listener.Yr(e)})}Lo(){}auth(){this.state=1;const t$jscomp$0=this.Uo(this.Vo),e$jscomp$0=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.Vo===e$jscomp$0&&this.qo(t,n)},e=>{t$jscomp$0(()=>{const t=new Q(G.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ko(t)})})}qo(t$jscomp$0,e){const n=this.Uo(this.Vo);
this.stream=this.Go(t$jscomp$0,e);this.stream.Hr(()=>{n(()=>(this.state=2,this.So=this.Yn.enqueueAfterDelay(this.Po,1E4,()=>(this.xo()&&(this.state=3),Promise.resolve())),this.listener.Hr()))});this.stream.Yr(t=>{n(()=>this.Ko(t))});this.stream.onMessage(t=>{n(()=>this.onMessage(t))})}No(){this.state=5;this.Do.To(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.state=0;$jscomp$async$this.start()})})}Ko(t){return O("PersistentStream",
`close with error: ${t}`),this.stream=null,this.close(4,t)}Uo(t){return e=>{this.Yn.enqueueAndForget(()=>this.Vo===t?e():(O("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Jo extends Ho{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r);this.M=i}Go(t,e){return this.bo.lo("Listen",t,e)}onMessage(t){this.Do.reset();const e=vs(this.M,t);"targetChange"in t?(t=t.targetChange,t=
t.targetIds&&t.targetIds.length?ct.min():t.readTime?ms(t.readTime):ct.min()):t=ct.min();return this.listener.Qo(e,t)}jo(t$jscomp$0){const e={};e.database=As(this.M);var t=this.M;let n;var JSCompiler_inline_result=t$jscomp$0.target;JSCompiler_inline_result=(n=ge(JSCompiler_inline_result)?{documents:{documents:[Ts(t,JSCompiler_inline_result.path)]}}:{query:Ns(t,JSCompiler_inline_result)},n.targetId=t$jscomp$0.targetId,0<t$jscomp$0.resumeToken.approximateByteSize()?n.resumeToken=_s(t,t$jscomp$0.resumeToken):
0<t$jscomp$0.snapshotVersion.compareTo(ct.min())&&(n.readTime=ds(t,t$jscomp$0.snapshotVersion.toTimestamp())),n);e.addTarget=JSCompiler_inline_result;(t$jscomp$0=Ms(this.M,t$jscomp$0))&&(e.labels=t$jscomp$0);this.Fo(e)}Wo(t){const e={};e.database=As(this.M);e.removeTarget=t;this.Fo(e)}}class Yo extends Ho{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r);this.M=i;this.zo=!1}get Ho(){return this.zo}start(){this.zo=!1;this.lastStreamToken=
void 0;super.start()}Lo(){this.zo&&this.Jo([])}Go(t,e){return this.bo.lo("Write",t,e)}onMessage(t){t.streamToken||L();if(this.lastStreamToken=t.streamToken,this.zo){this.Do.reset();const e=Cs(t.writeResults,t.commitTime);t=ms(t.commitTime);return this.listener.Yo(t,e)}!t.writeResults||0===t.writeResults.length||L();return this.zo=!0,this.listener.Xo()}Zo(){const t={};t.database=As(this.M);this.Fo(t)}Jo(t$jscomp$0){t$jscomp$0={streamToken:this.lastStreamToken,writes:t$jscomp$0.map(t=>Ss(this.M,t))};
this.Fo(t$jscomp$0)}}class Xo extends class{}{constructor(t,e,n,s){super();this.authCredentials=t;this.appCheckCredentials=e;this.bo=n;this.M=s;this.tu=!1}eu(){if(this.tu)throw new Q(G.FAILED_PRECONDITION,"The client has already been terminated.");}oo(t$jscomp$0,e,n){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.bo.oo(t$jscomp$0,e,n,s,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),
this.appCheckCredentials.invalidateToken()),t):new Q(G.UNKNOWN,t.toString());})}ho(t$jscomp$0,e,n){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.bo.ho(t$jscomp$0,e,n,s,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Q(G.UNKNOWN,t.toString());})}terminate(){this.tu=!0}}class Zo{constructor(t,e){this.asyncQueue=t;
this.onlineStateHandler=e;this.state="Unknown";this.nu=0;this.su=null;this.iu=!0}ru(){0===this.nu&&(this.ou("Unknown"),this.su=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1E4,()=>(this.su=null,this.uu("Backend didn't respond within 10 seconds."),this.ou("Offline"),Promise.resolve())))}au(t){"Online"===this.state?this.ou("Unknown"):(this.nu++,1<=this.nu&&(this.cu(),this.uu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ou("Offline")))}set(t){this.cu();this.nu=0;
"Online"===t&&(this.iu=!1);this.ou(t)}ou(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}uu(t){t=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.iu?(F(t),this.iu=!1):O("OnlineStateTracker",t)}cu(){null!==this.su&&(this.su.cancel(),this.su=null)}}class tu{constructor(t$jscomp$1,e,n,s,
i){this.localStore=t$jscomp$1;this.datastore=e;this.asyncQueue=n;this.remoteSyncer={};this.hu=[];this.lu=new Map;this.fu=new Set;this.du=[];this._u=i;this._u.Lr(t$jscomp$0=>{n.enqueueAndForget(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){cu($jscomp$async$this)&&(O("RemoteStore","Restarting streams for network reachability change."),yield function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){t.fu.add(4);yield nu(t);t.wu.set("Unknown");
t.fu.delete(4);yield eu(t)})}($jscomp$async$this))})})});this.wu=new Zo(n,s)}}class Su{constructor(t$jscomp$0,e,n,s,i){this.asyncQueue=t$jscomp$0;this.timerId=e;this.targetTimeMs=n;this.op=s;this.removalCallback=i;this.deferred=new j;this.then=this.deferred.promise.then.bind(this.deferred.promise);this.deferred.promise.catch(t=>{})}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n;t=new Su(t,e,r,s,i);return t.start(n),t}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==
this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Q(G.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Cu{constructor(t$jscomp$0){this.comparator=t$jscomp$0?(e,n)=>t$jscomp$0(e,n)||xt.comparator(e.key,
n.key):(t,e)=>xt.comparator(t.key,e.key);this.keyedMap=Wn;this.sortedSet=new Bn(this.comparator)}static emptySet(t){return new Cu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){return(t=this.keyedMap.get(t))?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),
!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t$jscomp$0){if(!(t$jscomp$0 instanceof Cu)||this.size!==t$jscomp$0.size)return!1;const e=this.sortedSet.getIterator();for(t$jscomp$0=t$jscomp$0.sortedSet.getIterator();e.hasNext();){const t=e.getNext().key,s=t$jscomp$0.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=
[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Cu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class xu{constructor(){this.pu=new Bn(xt.comparator)}track(t){const e=t.doc.key,n=this.pu.get(e);n?0!==t.type&&3===n.type?this.pu=this.pu.insert(e,t):3===t.type&&1!==n.type?this.pu=this.pu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.pu=this.pu.insert(e,{type:2,doc:t.doc}):
2===t.type&&0===n.type?this.pu=this.pu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.pu=this.pu.remove(e):1===t.type&&2===n.type?this.pu=this.pu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.pu=this.pu.insert(e,{type:2,doc:t.doc}):L():this.pu=this.pu.insert(e,t)}Iu(){const t=[];return this.pu.inorderTraversal((e,n)=>{t.push(n)}),t}}class Nu{constructor(t,e,n,s,i,r,o,u){this.query=t;this.docs=e;this.oldDocs=n;this.docChanges=s;this.mutatedKeys=i;this.fromCache=r;this.syncStateChanged=
o;this.excludesMetadataChanges=u}static fromInitialDocuments(t$jscomp$0,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Nu(t$jscomp$0,e,Cu.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t$jscomp$0){if(!(this.fromCache===t$jscomp$0.fromCache&&this.syncStateChanged===t$jscomp$0.syncStateChanged&&this.mutatedKeys.isEqual(t$jscomp$0.mutatedKeys)&&je(this.query,t$jscomp$0.query)&&this.docs.isEqual(t$jscomp$0.docs)&&this.oldDocs.isEqual(t$jscomp$0.oldDocs)))return!1;
const e=this.docChanges;t$jscomp$0=t$jscomp$0.docChanges;if(e.length!==t$jscomp$0.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==t$jscomp$0[t].type||!e[t].doc.isEqual(t$jscomp$0[t].doc))return!1;return!0}}class ku{constructor(){this.Tu=void 0;this.listeners=[]}}class Mu{constructor(){this.queries=new $n(t=>We(t),je);this.onlineState="Unknown";this.Eu=new Set}}class Uu{constructor(t,e,n){this.query=t;this.Pu=e;this.bu=!1;this.Vu=null;this.onlineState="Unknown";this.options=n||{}}Ru(t){if(!this.options.includeMetadataChanges){var e=
[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Nu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}e=!1;return this.bu?this.vu(t)&&(this.Pu.next(t),e=!0):this.Su(t,this.onlineState)&&(this.Du(t),e=!0),this.Vu=t,e}onError(t){this.Pu.error(t)}Au(t){this.onlineState=t;let e=!1;return this.Vu&&!this.bu&&this.Su(this.Vu,t)&&(this.Du(this.Vu),e=!0),e}Su(t,e){return t.fromCache?(!this.options.Cu||"Offline"===e)&&(!t.docs.isEmpty()||"Offline"===e):!0}vu(t){if(0<t.docChanges.length)return!0;
const e=this.Vu&&this.Vu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Du(t){t=Nu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache);this.bu=!0;this.Pu.next(t)}}class qu{constructor(t,e){this.payload=t;this.byteLength=e}xu(){return"metadata"in this.payload}}class Ku{constructor(t){this.M=t}fi(t){return Is(this.M,t)}di(t){return t.metadata.exists?bs(this.M,t.document,!1):ne.newNoDocument(this.fi(t.metadata.name),this._i(t.metadata.readTime))}_i(t){return ms(t)}}
class Gu{constructor(t,e,n){this.Nu=t;this.localStore=e;this.M=n;this.queries=[];this.documents=[];this.collectionGroups=new Set;this.progress=Qu(t)}ku(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e,t=_t.fromString(t.payload.documentMetadata.name),this.collectionGroups.add(t.get(t.length-
2))):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Mu(t){const e=new Map,n$jscomp$0=new Ku(this.M);for(const s$jscomp$0 of t)if(s$jscomp$0.metadata.queries){t=n$jscomp$0.fi(s$jscomp$0.metadata.name);for(const n of s$jscomp$0.metadata.queries){const s=(e.get(n)||Xn()).add(t);e.set(n,s)}}return e}complete(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t$jscomp$0=
yield go($jscomp$async$this.localStore,new Ku($jscomp$async$this.M),$jscomp$async$this.documents,$jscomp$async$this.Nu.id),e=$jscomp$async$this.Mu($jscomp$async$this.documents);for(const t of $jscomp$async$this.queries)yield yo($jscomp$async$this.localStore,t,e.get(t.name));return $jscomp$async$this.progress.taskState="Success",{progress:$jscomp$async$this.progress,Ou:$jscomp$async$this.collectionGroups,Fu:t$jscomp$0}})}}class ju{constructor(t){this.key=t}}class Wu{constructor(t){this.key=t}}class zu{constructor(t,
e){this.query=t;this.$u=e;this.Bu=null;this.current=!1;this.Lu=Xn();this.mutatedKeys=Xn();this.Uu=Ye(t);this.qu=new Cu(this.Uu)}get Ku(){return this.$u}Gu(t$jscomp$0,e$jscomp$0){const n=e$jscomp$0?e$jscomp$0.Qu:new xu,s=e$jscomp$0?e$jscomp$0.qu:this.qu;let i=e$jscomp$0?e$jscomp$0.mutatedKeys:this.mutatedKeys,r=s,o=!1;const u=$e(this.query)&&s.size===this.query.limit?s.last():null,a=Be(this.query)&&s.size===this.query.limit?s.first():null;if(t$jscomp$0.inorderTraversal((t,e)=>{const c=s.get(t);e=He(this.query,
e)?e:null;const l=!!c&&this.mutatedKeys.has(c.key),f=!!e&&(e.hasLocalMutations||this.mutatedKeys.has(e.key)&&e.hasCommittedMutations);let d=!1;c&&e?c.data.isEqual(e.data)?l!==f&&(n.track({type:3,doc:e}),d=!0):this.ju(c,e)||(n.track({type:2,doc:e}),d=!0,(u&&0<this.Uu(e,u)||a&&0>this.Uu(e,a))&&(o=!0)):!c&&e?(n.track({type:0,doc:e}),d=!0):c&&!e&&(n.track({type:1,doc:c}),d=!0,(u||a)&&(o=!0));d&&(e?(r=r.add(e),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),$e(this.query)||Be(this.query))for(;r.size>
this.query.limit;)t$jscomp$0=$e(this.query)?r.last():r.first(),r=r.delete(t$jscomp$0.key),i=i.delete(t$jscomp$0.key),n.track({type:1,doc:t$jscomp$0});return{qu:r,Qu:n,ni:o,mutatedKeys:i}}ju(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t$jscomp$2,e$jscomp$1,n$jscomp$0){const s=this.qu;this.qu=t$jscomp$2.qu;this.mutatedKeys=t$jscomp$2.mutatedKeys;const i=t$jscomp$2.Qu.Iu();i.sort((t$jscomp$1,e$jscomp$0)=>function(t$jscomp$0,e){const n=t=>{switch(t){case 0:return 1;
case 2:case 3:return 2;case 1:return 0;default:return L()}};return n(t$jscomp$0)-n(e)}(t$jscomp$1.type,e$jscomp$0.type)||this.Uu(t$jscomp$1.doc,e$jscomp$0.doc));this.Wu(n$jscomp$0);e$jscomp$1=e$jscomp$1?this.zu():[];n$jscomp$0=0===this.Lu.size&&this.current?1:0;const u=n$jscomp$0!==this.Bu;return(this.Bu=n$jscomp$0,0!==i.length||u)?{snapshot:new Nu(this.query,t$jscomp$2.qu,s,i,t$jscomp$2.mutatedKeys,0===n$jscomp$0,u,!1),Hu:e$jscomp$1}:{Hu:e$jscomp$1}}Au(t){return this.current&&"Offline"===t?(this.current=
!1,this.applyChanges({qu:this.qu,Qu:new xu,mutatedKeys:this.mutatedKeys,ni:!1},!1)):{Hu:[]}}Ju(t){return!this.$u.has(t)&&!!this.qu.has(t)&&!this.qu.get(t).hasLocalMutations}Wu(t$jscomp$0){t$jscomp$0&&(t$jscomp$0.addedDocuments.forEach(t=>this.$u=this.$u.add(t)),t$jscomp$0.modifiedDocuments.forEach(t=>{}),t$jscomp$0.removedDocuments.forEach(t=>this.$u=this.$u.delete(t)),this.current=t$jscomp$0.current)}zu(){if(!this.current)return[];const t$jscomp$0=this.Lu;this.Lu=Xn();this.qu.forEach(t=>{this.Ju(t.key)&&
(this.Lu=this.Lu.add(t.key))});const e=[];return t$jscomp$0.forEach(t=>{this.Lu.has(t)||e.push(new Wu(t))}),this.Lu.forEach(n=>{t$jscomp$0.has(n)||e.push(new ju(n))}),e}Yu(t){this.$u=t.li;this.Lu=Xn();t=this.Gu(t.documents);return this.applyChanges(t,!0)}Xu(){return Nu.fromInitialDocuments(this.query,this.qu,this.mutatedKeys,0===this.Bu)}}class Hu{constructor(t,e,n){this.query=t;this.targetId=e;this.view=n}}class Ju{constructor(t){this.key=t;this.Zu=!1}}class Yu{constructor(t$jscomp$0,e,n,s,i,r){this.localStore=
t$jscomp$0;this.remoteStore=e;this.eventManager=n;this.sharedClientState=s;this.currentUser=i;this.maxConcurrentLimboResolutions=r;this.ta={};this.ea=new $n(t=>We(t),je);this.na=new Map;this.sa=new Set;this.ia=new Bn(xt.comparator);this.ra=new Map;this.oa=new To;this.ua={};this.aa=new Map;this.ca=br.yn();this.onlineState="Unknown";this.ha=void 0}get isPrimaryClient(){return!0===this.ha}}class Da{constructor(){this.synchronizeTabs=!1}initialize(t){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.M=
new fs(t.databaseInfo.databaseId,!0);$jscomp$async$this.sharedClientState=$jscomp$async$this._a(t);$jscomp$async$this.persistence=$jscomp$async$this.wa(t);yield $jscomp$async$this.persistence.start();$jscomp$async$this.gcScheduler=$jscomp$async$this.ma(t);$jscomp$async$this.localStore=$jscomp$async$this.ga(t)})}ma(t){return null}ga(t){var e=new eo;return new no(this.persistence,e,t.initialUser,this.M)}wa(t){return new Vo(So.zi,this.M)}_a(t){return new Bo}terminate(){const $jscomp$async$this=this;
return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.gcScheduler&&$jscomp$async$this.gcScheduler.stop();yield $jscomp$async$this.sharedClientState.shutdown();yield $jscomp$async$this.persistence.shutdown()})}}class Ca extends Da{constructor(t,e,n){super();this.ya=t;this.cacheSizeBytes=e;this.forceOwnership=n;this.synchronizeTabs=!1}initialize(t){const $jscomp$async$this=this,$jscomp$async$super$get$initialize=()=>super.initialize;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield $jscomp$async$super$get$initialize().call($jscomp$async$this,
t);yield $jscomp$async$this.ya.initialize($jscomp$async$this,t);yield va($jscomp$async$this.ya.syncEngine);yield mu($jscomp$async$this.ya.remoteStore);yield $jscomp$async$this.persistence.Ts(()=>($jscomp$async$this.gcScheduler&&!$jscomp$async$this.gcScheduler.started&&$jscomp$async$this.gcScheduler.start($jscomp$async$this.localStore),Promise.resolve()))})}ga(t){var e=new eo;return new no(this.persistence,e,t.initialUser,this.M)}ma(t){return new kr(this.persistence.referenceDelegate.garbageCollector,
t.asyncQueue)}wa(t){const e=Xr(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?yr.withCacheSize(this.cacheSizeBytes):yr.DEFAULT;return new Hr(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,"undefined"!=typeof window?window:null,jo(),this.M,this.sharedClientState,!!this.forceOwnership)}_a(t){return new Bo}}class xa extends Ca{constructor(t,e){super(t,e,!1);this.ya=t;this.cacheSizeBytes=e;this.synchronizeTabs=!0}initialize(t$jscomp$0){const $jscomp$async$this=
this,$jscomp$async$super$get$initialize=()=>super.initialize;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield $jscomp$async$super$get$initialize().call($jscomp$async$this,t$jscomp$0);const e=$jscomp$async$this.ya.syncEngine;$jscomp$async$this.sharedClientState instanceof $o&&($jscomp$async$this.sharedClientState.syncEngine={Mr:Ia.bind(null,e),Or:Pa.bind(null,e),Fr:ba.bind(null,e),Fs:Ra.bind(null,e),kr:pa.bind(null,e)},yield $jscomp$async$this.sharedClientState.start());yield $jscomp$async$this.persistence.Ts(t=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield Ta($jscomp$async$this.ya.syncEngine,t);$jscomp$async$this.gcScheduler&&(t&&!$jscomp$async$this.gcScheduler.started?$jscomp$async$this.gcScheduler.start($jscomp$async$this.localStore):t||$jscomp$async$this.gcScheduler.stop())}))})}_a(t){const e="undefined"!=typeof window?window:null;if(!$o.vt(e))throw new Q(G.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Xr(t.databaseInfo.databaseId,
t.databaseInfo.persistenceKey);return new $o(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class Na{initialize(t$jscomp$0,e){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){$jscomp$async$this.localStore||($jscomp$async$this.localStore=t$jscomp$0.localStore,$jscomp$async$this.sharedClientState=t$jscomp$0.sharedClientState,$jscomp$async$this.datastore=$jscomp$async$this.createDatastore(e),$jscomp$async$this.remoteStore=$jscomp$async$this.createRemoteStore(e),
$jscomp$async$this.eventManager=$jscomp$async$this.createEventManager(e),$jscomp$async$this.syncEngine=$jscomp$async$this.createSyncEngine(e,!t$jscomp$0.synchronizeTabs),$jscomp$async$this.sharedClientState.onlineStateHandler=t=>sa($jscomp$async$this.syncEngine,t,1),$jscomp$async$this.remoteStore.remoteSyncer.handleCredentialChange=ma.bind(null,$jscomp$async$this.syncEngine),yield bu($jscomp$async$this.remoteStore,$jscomp$async$this.syncEngine.isPrimaryClient))})}createEventManager(t){return new Mu}createDatastore(t){const e=
new fs(t.databaseInfo.databaseId,!0),n=(s=t.databaseInfo,new Go(s));var s;return new Xo(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t$jscomp$0){return e=this.localStore,n=this.datastore,s=t$jscomp$0.asyncQueue,i=t=>sa(this.syncEngine,t,0),r=Uo.vt()?new Uo:new Lo,new tu(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){t=new Yu(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions);return e&&(t.ha=!0),t}terminate(){return function(t){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){O("RemoteStore",
"RemoteStore shutting down.");t.fu.add(5);yield nu(t);t._u.shutdown();t.wu.set("Unknown")})}(this.remoteStore)}}class Ma{constructor(t){this.observer=t;this.muted=!1}next(t){this.observer.next&&this.pa(this.observer.next,t)}error(t){this.observer.error?this.pa(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Ia(){this.muted=!0}pa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Oa{constructor(t$jscomp$0,e){this.Ta=t$jscomp$0;this.M=e;this.metadata=new j;this.buffer=
new Uint8Array;this.Ea=new TextDecoder("utf-8");this.Aa().then(t=>{t&&t.xu()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))},t=>this.metadata.reject(t))}close(){return this.Ta.cancel()}getMetadata(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return $jscomp$async$this.metadata.promise})}da(){const $jscomp$async$this=
this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return yield $jscomp$async$this.getMetadata(),$jscomp$async$this.Aa()})}Aa(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t=yield $jscomp$async$this.Ra();if(null===t)return null;var e=$jscomp$async$this.Ea.decode(t);const n=Number(e);isNaN(n)&&$jscomp$async$this.Pa(`length string (${e}) is not valid number`);e=yield $jscomp$async$this.ba(n);return new qu(JSON.parse(e),t.length+
n)})}Va(){return this.buffer.findIndex(t=>123===t)}Ra(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;0>$jscomp$async$this.Va()&&!(yield $jscomp$async$this.va()););if(0===$jscomp$async$this.buffer.length)return null;const t=$jscomp$async$this.Va();0>t&&$jscomp$async$this.Pa("Reached the end of bundle when a length string is expected.");const e=$jscomp$async$this.buffer.slice(0,t);return $jscomp$async$this.buffer=$jscomp$async$this.buffer.slice(t),
e})}ba(t){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;$jscomp$async$this.buffer.length<t;)(yield $jscomp$async$this.va())&&$jscomp$async$this.Pa("Reached the end of bundle when more is expected.");const e=$jscomp$async$this.Ea.decode($jscomp$async$this.buffer.slice(0,t));return $jscomp$async$this.buffer=$jscomp$async$this.buffer.slice(t),e})}Pa(t){throw this.Ta.cancel(),Error(`Invalid bundle format: ${t}`);}va(){const $jscomp$async$this=this;
return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t=yield $jscomp$async$this.Ta.read();if(!t.done){const e=new Uint8Array($jscomp$async$this.buffer.length+t.value.length);e.set($jscomp$async$this.buffer);e.set(t.value,$jscomp$async$this.buffer.length);$jscomp$async$this.buffer=e}return t.done})}}class Fa{constructor(t){this.datastore=t;this.readVersions=new Map;this.mutations=[];this.committed=!1;this.lastWriteError=null;this.writtenDocs=new Set}lookup(t$jscomp$1){const $jscomp$async$this=
this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.ensureCommitNotCalled(),0<$jscomp$async$this.mutations.length)throw new Q(G.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e$jscomp$0=yield function(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var s=As(t$jscomp$0.M)+"/documents";const i={documents:e.map(t=>gs(t$jscomp$0.M.databaseId,t.path))};s=yield t$jscomp$0.ho("BatchGetDocuments",
s,i);const o=new Map;s.forEach(t=>{t=Vs(t$jscomp$0.M,t);o.set(t.key.toString(),t)});const u=[];return e.forEach(t=>{(t=o.get(t.toString()))||L();u.push(t)}),u})}($jscomp$async$this.datastore,t$jscomp$1);return e$jscomp$0.forEach(t=>$jscomp$async$this.recordVersion(t)),e$jscomp$0})}set(t,e){this.write(e.toMutation(t,this.precondition(t)));this.writtenDocs.add(t.toString())}update(t$jscomp$0,e){try{this.write(e.toMutation(t$jscomp$0,this.preconditionForUpdate(t$jscomp$0)))}catch(t){this.lastWriteError=
t}this.writtenDocs.add(t$jscomp$0.toString())}delete(t){this.write(new Cn(t,this.precondition(t)));this.writtenDocs.add(t.toString())}commit(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if($jscomp$async$this.ensureCommitNotCalled(),$jscomp$async$this.lastWriteError)throw $jscomp$async$this.lastWriteError;const t$jscomp$1=$jscomp$async$this.readVersions;$jscomp$async$this.mutations.forEach(e=>{t$jscomp$1.delete(e.key.toString())});t$jscomp$1.forEach((t,
e)=>{t=xt.fromPath(e);$jscomp$async$this.mutations.push(new xn(t,$jscomp$async$this.precondition(t)))});yield function(t$jscomp$0,e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const s=As(t$jscomp$0.M)+"/documents",i={writes:e.map(t=>Ss(t$jscomp$0.M,t))};yield t$jscomp$0.oo("Commit",s,i)})}($jscomp$async$this.datastore,$jscomp$async$this.mutations);$jscomp$async$this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=
ct.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Q(G.ABORTED,"Document version changed between two reads.");}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?yn.updateTime(e):yn.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ct.min()))throw new Q(G.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");
return yn.updateTime(e)}return yn.exists(!0)}write(t){this.ensureCommitNotCalled();this.mutations.push(t)}ensureCommitNotCalled(){}}class $a{constructor(t,e,n,s){this.asyncQueue=t;this.datastore=e;this.updateFunction=n;this.deferred=s;this.Sa=5;this.Do=new zo(this.asyncQueue,"transaction_retry")}run(){--this.Sa;this.Da()}Da(){this.Do.To(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const t$jscomp$0=new Fa($jscomp$async$this.datastore),e$jscomp$0=
$jscomp$async$this.Ca(t$jscomp$0);e$jscomp$0&&e$jscomp$0.then(e=>{$jscomp$async$this.asyncQueue.enqueueAndForget(()=>t$jscomp$0.commit().then(()=>{$jscomp$async$this.deferred.resolve(e)}).catch(t=>{$jscomp$async$this.xa(t)}))}).catch(t=>{$jscomp$async$this.xa(t)})})})}Ca(t$jscomp$0){try{const e=this.updateFunction(t$jscomp$0);return null!=e&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}xa(t){0<this.Sa&&
this.Na(t)?(--this.Sa,this.asyncQueue.enqueueAndForget(()=>(this.Da(),Promise.resolve()))):this.deferred.reject(t)}Na(t){return"FirebaseError"===t.name?(t=t.code,"aborted"===t||"failed-precondition"===t||!On(t)):!1}}class Ba{constructor(t$jscomp$0,e,n,s){this.authCredentials=t$jscomp$0;this.appCheckCredentials=e;this.asyncQueue=n;this.databaseInfo=s;this.user=C.UNAUTHENTICATED;this.clientId=it.R();this.authCredentialListener=()=>Promise.resolve();this.appCheckCredentialListener=()=>Promise.resolve();
this.authCredentials.start(n,t=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){O("FirestoreClient","Received user\x3d",t.uid);yield $jscomp$async$this.authCredentialListener(t);$jscomp$async$this.user=t})});this.appCheckCredentials.start(n,t=>(O("FirestoreClient","Received new app check token\x3d",t),this.appCheckCredentialListener(t,this.user)))}getConfiguration(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return{asyncQueue:$jscomp$async$this.asyncQueue,
databaseInfo:$jscomp$async$this.databaseInfo,clientId:$jscomp$async$this.clientId,authCredentials:$jscomp$async$this.authCredentials,appCheckCredentials:$jscomp$async$this.appCheckCredentials,initialUser:$jscomp$async$this.user,maxConcurrentLimboResolutions:100}})}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Q(G.FAILED_PRECONDITION,"The client has already been terminated.");
}terminate(){this.asyncQueue.enterRestrictedMode();const t=new j;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>{const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){try{$jscomp$async$this.onlineComponents&&(yield $jscomp$async$this.onlineComponents.terminate()),$jscomp$async$this.offlineComponents&&(yield $jscomp$async$this.offlineComponents.terminate()),$jscomp$async$this.authCredentials.shutdown(),$jscomp$async$this.appCheckCredentials.shutdown(),
t.resolve()}catch(e){const n=Du(e,"Failed to shutdown persistence");t.reject(n)}})}),t.promise}}const rc=new Map;class dc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Q(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com";this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=
41943040;else{if(-1!==t.cacheSizeBytes&&1048576>t.cacheSizeBytes)throw new Q(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling;this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling;this.useFetchStreams=!!t.useFetchStreams;uc("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===
t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class _c{constructor(t,e,n){this._authCredentials=e;this._appCheckCredentials=n;this.type="firestore-lite";this._persistenceKey="(lite)";this._settings=
new dc({});this._settingsFrozen=!1;if(t instanceof vt)this._databaseId=t;else{this._app=t;if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Q(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');this._databaseId=new vt(t.options.projectId)}}get app(){if(!this._app)throw new Q(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==
this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Q(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new dc(t);if(void 0!==t.credentials){a:if(t=t.credentials)switch(t.type){case "gapi":const e=t.client;"object"==typeof e&&null!==e&&e.auth&&e.auth.getAuthHeaderValueForFirstParty||L();t=new X(e,t.sessionIndex||"0",t.iamToken||
null);break a;case "provider":t=t.client;break a;default:throw new Q(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type");}else t=new z;this._authCredentials=t}}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){const e=rc.get(this);
e&&(O("ComponentProvider","Removing Datastore"),rc.delete(this),e.terminate());return Promise.resolve()}}class mc{constructor(t,e,n){this.converter=e;this._key=n;this.type="document";this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new mc(this.firestore,t,this._key)}}exports.DocumentReference=mc;
class gc{constructor(t,e,n){this.converter=e;this._query=n;this.type="query";this.firestore=t}withConverter(t){return new gc(this.firestore,t,this._query)}}exports.Query=gc;class yc extends gc{constructor(t,e,n){super(t,e,new Me(n));this._path=n;this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new mc(this.firestore,null,new xt(t))}withConverter(t){return new yc(this.firestore,
t,this._path)}}exports.CollectionReference=yc;class Rc{constructor(){this.ka=Promise.resolve();this.Ma=[];this.Oa=!1;this.Fa=[];this.$a=null;this.La=this.Ba=!1;this.Ua=[];this.Do=new zo(this,"async_queue_retry");this.qa=()=>{const t=jo();t&&O("AsyncQueue","Visibility state changed to "+t.visibilityState);this.Do.Ao()};const t$jscomp$0=jo();t$jscomp$0&&"function"==typeof t$jscomp$0.addEventListener&&t$jscomp$0.addEventListener("visibilitychange",this.qa)}get isShuttingDown(){return this.Oa}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ka();
this.Ga(t)}enterRestrictedMode(t){this.Oa||(this.Oa=!0,this.La=t||!1,(t=jo())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.qa))}enqueue(t){if(this.Ka(),this.Oa)return new Promise(()=>{});const e=new j;return this.Ga(()=>this.Oa&&this.La?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ma.push(t),this.Qa()))}Qa(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(0!==
$jscomp$async$this.Ma.length){try{yield $jscomp$async$this.Ma[0](),$jscomp$async$this.Ma.shift(),$jscomp$async$this.Do.reset()}catch(t){if(!Ri(t))throw t;O("AsyncQueue","Operation failed with retryable error: "+t)}0<$jscomp$async$this.Ma.length&&$jscomp$async$this.Do.To(()=>$jscomp$async$this.Qa())}})}Ga(t$jscomp$0){const e$jscomp$0=this.ka.then(()=>(this.Ba=!0,t$jscomp$0().catch(t=>{this.$a=t;this.Ba=!1;let e=t.message||"";t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack);throw F("INTERNAL UNHANDLED ERROR: ",
e),t;}).then(t=>(this.Ba=!1,t))));return this.ka=e$jscomp$0,e$jscomp$0}enqueueAfterDelay(t$jscomp$0,e,n){this.Ka();-1<this.Ua.indexOf(t$jscomp$0)&&(e=0);t$jscomp$0=Su.createAndSchedule(this,t$jscomp$0,e,n,t=>this.ja(t));return this.Fa.push(t$jscomp$0),t$jscomp$0}Ka(){this.$a&&L()}verifyOperationInProgress(){}Wa(){const $jscomp$async$this=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let t;do t=$jscomp$async$this.ka,yield t;while(t!==$jscomp$async$this.ka)})}za(t){for(const e of this.Fa)if(e.timerId===
t)return!0;return!1}Ha(t$jscomp$0){return this.Wa().then(()=>{this.Fa.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.Fa)if(e.skipDelay(),"all"!==t$jscomp$0&&e.timerId===t$jscomp$0)break;return this.Wa()})}Ja(t){this.Ua.push(t)}ja(t){t=this.Fa.indexOf(t);this.Fa.splice(t,1)}}class bc{constructor(){this._progressObserver={};this._taskCompletionResolver=new j;this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver=
{next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t);this._progressObserver.complete&&this._progressObserver.complete();this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error";this._progressObserver.next&&this._progressObserver.next(this._lastProgress);this._progressObserver.error&&this._progressObserver.error(t);this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=
t;this._progressObserver.next&&this._progressObserver.next(t)}}exports.LoadBundleTask=bc;exports.CACHE_SIZE_UNLIMITED=-1;class vc extends _c{constructor(t,e,n){super(t,e,n);this.type="firestore";this._queue=new Rc;this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||xc(this),this._firestoreClient.terminate()}}exports.Firestore=vc;class Gc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Q(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");
this._internalPath=new mt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}exports.FieldPath=Gc;class jc{constructor(t){this._byteString=t}static fromBase64String(t$jscomp$0){try{return new jc(pt.fromBase64String(t$jscomp$0))}catch(t){throw new Q(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t);}}static fromUint8Array(t){return new jc(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+
this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}exports.Bytes=jc;class Wc{constructor(t){this._methodName=t}}exports.FieldValue=Wc;class zc{constructor(t,e){if(!isFinite(t)||-90>t||90<t)throw new Q(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||-180>e||180<e)throw new Q(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t;this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===
t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return rt(this._lat,t._lat)||rt(this._long,t._long)}}exports.GeoPoint=zc;const Hc=/^__.*__$/;class Jc{constructor(t,e,n){this.data=t;this.fieldMask=e;this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Vn(t,this.data,this.fieldMask,e,this.fieldTransforms):new bn(t,this.data,e,this.fieldTransforms)}}class Yc{constructor(t,e,n){this.data=t;this.fieldMask=e;this.fieldTransforms=n}toMutation(t,
e){return new Vn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}class Zc{constructor(t,e,n,s,i,r){this.settings=t;this.databaseId=e;this.M=n;this.ignoreUndefinedProperties=s;void 0===i&&this.Ya();this.fieldTransforms=i||[];this.fieldMask=r||[]}get path(){return this.settings.path}get Xa(){return this.settings.Xa}Za(t){return new Zc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}tc(t){var e;const n=null===
(e=this.path)||void 0===e?void 0:e.child(t);e=this.Za({path:n,ec:!1});return e.nc(t),e}sc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t);t=this.Za({path:n,ec:!1});return t.Ya(),t}ic(t){return this.Za({path:void 0,ec:!0})}rc(t){return ph(t,this.settings.methodName,this.settings.oc||!1,this.path,this.settings.uc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Ya(){if(this.path)for(let t=0;t<this.path.length;t++)this.nc(this.path.get(t))}nc(t){if(0===
t.length)throw this.rc("Document fields must not be empty");if(Xc(this.Xa)&&Hc.test(t))throw this.rc('Document fields cannot begin and end with "__"');}}class th{constructor(t,e,n){this.databaseId=t;this.ignoreUndefinedProperties=e;this.M=n||new fs(t,!0)}ac(t,e,n,s=!1){return new Zc({Xa:t,methodName:e,uc:n,path:mt.emptyPath(),ec:!1,oc:s},this.databaseId,this.M,this.ignoreUndefinedProperties)}}class sh extends Wc{_toFieldTransform(t){if(2!==t.Xa)throw 1===t.Xa?t.rc(`${this._methodName}() can only appear at the top level of your update data`):
t.rc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof sh}}class rh extends Wc{_toFieldTransform(t){return new wn(t.path,new un)}isEqual(t){return t instanceof rh}}class oh extends Wc{constructor(t,e){super(t);this.cc=e}_toFieldTransform(t$jscomp$0){const e=ih(this,t$jscomp$0,!0);var n=this.cc.map(t=>fh(t,e));n=new an(n);return new wn(t$jscomp$0.path,n)}isEqual(t){return this===t}}class uh extends Wc{constructor(t,
e){super(t);this.cc=e}_toFieldTransform(t$jscomp$0){const e=ih(this,t$jscomp$0,!0);var n=this.cc.map(t=>fh(t,e));n=new hn(n);return new wn(t$jscomp$0.path,n)}isEqual(t){return this===t}}class ah extends Wc{constructor(t,e){super(t);this.hc=e}_toFieldTransform(t){const e=new fn(t.M,en(t.M,this.hc));return new wn(t.path,e)}isEqual(t){return this===t}}const gh=RegExp("[~\\*/\\[\\]]");class Th{constructor(t,e,n,s,i){this._firestore=t;this._userDataWriter=e;this._key=n;this._document=s;this._converter=
i}get id(){return this._key.path.lastSegment()}get ref(){return new mc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Eh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document&&(t=this._document.data.field(Ah("DocumentSnapshot.get",t)),null!==t))return this._userDataWriter.convertValue(t)}}
class Eh extends Th{data(){return super.data()}}class Rh{constructor(t,e){this.hasPendingWrites=t;this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}exports.SnapshotMetadata=Rh;class Ph extends Th{constructor(t,e,n,s,i,r){super(t,e,n,s,r);this._firestoreImpl=this._firestore=t;this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new bh(this._firestore,this._userDataWriter,this._key,this._document,
this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document&&(t=this._document.data.field(Ah("DocumentSnapshot.get",t)),null!==t))return this._userDataWriter.convertValue(t,e.serverTimestamps)}}exports.DocumentSnapshot=Ph;class bh extends Ph{data(t={}){return super.data(t)}}exports.QueryDocumentSnapshot=bh;class Vh{constructor(t,e,n,s){this._firestore=t;this._userDataWriter=e;this._snapshot=
s;this.metadata=new Rh(s.hasPendingWrites,s.fromCache);this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new bh(this._firestore,this._userDataWriter,n.key,n,new Rh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t$jscomp$1={}){if((t$jscomp$1=!!t$jscomp$1.includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Q(G.INVALID_ARGUMENT,
"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t$jscomp$1||(this._cachedChanges=function(t$jscomp$0,e$jscomp$0){if(t$jscomp$0._snapshot.oldDocs.isEmpty()){let e=0;return t$jscomp$0._snapshot.docChanges.map(n=>({type:"added",doc:new bh(t$jscomp$0._firestore,t$jscomp$0._userDataWriter,n.doc.key,n.doc,new Rh(t$jscomp$0._snapshot.mutatedKeys.has(n.doc.key),
t$jscomp$0._snapshot.fromCache),t$jscomp$0.query.converter),oldIndex:-1,newIndex:e++}))}let n$jscomp$0=t$jscomp$0._snapshot.oldDocs;return t$jscomp$0._snapshot.docChanges.filter(t=>e$jscomp$0||3!==t.type).map(e=>{const s=new bh(t$jscomp$0._firestore,t$jscomp$0._userDataWriter,e.doc.key,e.doc,new Rh(t$jscomp$0._snapshot.mutatedKeys.has(e.doc.key),t$jscomp$0._snapshot.fromCache),t$jscomp$0.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n$jscomp$0.indexOf(e.doc.key),n$jscomp$0=n$jscomp$0.delete(e.doc.key)),
1!==e.type&&(n$jscomp$0=n$jscomp$0.add(e.doc),r=n$jscomp$0.indexOf(e.doc.key)),{type:vh(e.type),doc:s,oldIndex:i,newIndex:r}})}(this,t$jscomp$1),this._cachedChangesIncludeMetadataChanges=t$jscomp$1),this._cachedChanges}}exports.QuerySnapshot=Vh;class Ch{}exports.QueryConstraint=Ch;class Nh extends Ch{constructor(t,e,n){super();this.lc=t;this.fc=e;this.dc=n;this.type="where"}_apply(t$jscomp$2){var e$jscomp$2=eh(t$jscomp$2.firestore);e$jscomp$2=function(t$jscomp$1,e$jscomp$1,n$jscomp$1,s,i,r,o){if(i.isKeyField()){if("array-contains"===
r||"array-contains-any"===r)throw new Q(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){zh(o,r);e$jscomp$1=[];for(const n of o)e$jscomp$1.push(Wh(s,t$jscomp$1,n));s={arrayValue:{values:e$jscomp$1}}}else s=Wh(s,t$jscomp$1,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||zh(o,r),s=lh(n$jscomp$1,e$jscomp$1,o,"in"===r||"not-in"===r);i=Te.create(i,r,s);return function(t$jscomp$0,e$jscomp$0){if(e$jscomp$0.S()){var n$jscomp$0=Ue(t$jscomp$0);
if(null!==n$jscomp$0&&!n$jscomp$0.isEqual(e$jscomp$0.field))throw new Q(G.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n$jscomp$0.toString()}' and '${e$jscomp$0.field.toString()}'`);n$jscomp$0=Le(t$jscomp$0);null!==n$jscomp$0&&Hh(t$jscomp$0,e$jscomp$0.field,n$jscomp$0)}t$jscomp$0=function(t,e){for(const n of t.filters)if(0<=e.indexOf(n.op))return n.op;return null}(t$jscomp$0,function(t){switch(t){case "!\x3d":return["!\x3d",
"not-in"];case "array-contains":return["array-contains","array-contains-any","not-in"];case "in":return["array-contains-any","in","not-in"];case "array-contains-any":return["array-contains","array-contains-any","in","not-in"];case "not-in":return["array-contains","array-contains-any","in","not-in","!\x3d"];default:return[]}}(e$jscomp$0.op));if(null!==t$jscomp$0)throw t$jscomp$0===e$jscomp$0.op?new Q(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e$jscomp$0.op.toString()}' filter.`):
new Q(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e$jscomp$0.op.toString()}' filters with '${t$jscomp$0.toString()}' filters.`);}(t$jscomp$1,i),i}(t$jscomp$2._query,"where",e$jscomp$2,t$jscomp$2.firestore._databaseId,this.lc,this.fc,this.dc);return new gc(t$jscomp$2.firestore,t$jscomp$2.converter,function(t,e){e=t.filters.concat([e]);return new Me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)}(t$jscomp$2._query,e$jscomp$2))}}class Mh extends Ch{constructor(t,
e){super();this.lc=t;this._c=e;this.type="orderBy"}_apply(t$jscomp$0){const e$jscomp$0=function(t,e,n){if(null!==t.startAt)throw new Q(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Q(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");e=new Ce(e,n);null===Le(t)&&(n=Ue(t),null!==n&&Hh(t,n,e.field));return e}(t$jscomp$0._query,this.lc,this._c);return new gc(t$jscomp$0.firestore,
t$jscomp$0.converter,function(t,e){e=t.explicitOrderBy.concat([e]);return new Me(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t$jscomp$0._query,e$jscomp$0))}}class Fh extends Ch{constructor(t,e,n){super();this.type=t;this.wc=e;this.mc=n}_apply(t){return new gc(t.firestore,t.converter,Qe(t._query,this.wc,this.mc))}}class Lh extends Ch{constructor(t,e,n){super();this.type=t;this.gc=e;this.yc=n}_apply(t){var e=jh(t,this.type,this.gc,this.yc),JSCompiler_temp_const=
t.firestore,JSCompiler_temp_const$jscomp$0=t.converter;t=t._query;e=new Me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt);return new gc(JSCompiler_temp_const,JSCompiler_temp_const$jscomp$0,e)}}class Kh extends Ch{constructor(t,e,n){super();this.type=t;this.gc=e;this.yc=n}_apply(t){var e=jh(t,this.type,this.gc,this.yc),JSCompiler_temp_const=t.firestore,JSCompiler_temp_const$jscomp$0=t.converter;t=t._query;e=new Me(t.path,t.collectionGroup,t.explicitOrderBy.slice(),
t.filters.slice(),t.limit,t.limitType,t.startAt,e);return new gc(JSCompiler_temp_const,JSCompiler_temp_const$jscomp$0,e)}}class Jh{convertValue(t,e="none"){switch(Mt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Et(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(At(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);
case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw L();}}convertObject(t$jscomp$0,e){const n={};return lt(t$jscomp$0.fields,(t,s)=>{n[t]=this.convertValue(s,e)}),n}convertGeoPoint(t){return new zc(Et(t.latitude),Et(t.longitude))}convertArray(t$jscomp$0,e){return(t$jscomp$0.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case "previous":return t=Pt(t),null==t?null:this.convertValue(t,e);case "estimate":return this.convertTimestamp(bt(t));
default:return null}}convertTimestamp(t){t=Tt(t);return new at(t.seconds,t.nanos)}convertDocumentKey(t,e){var n=_t.fromString(t);Gs(n)||L();t=new vt(n.get(1),n.get(3));n=new xt(n.popFirst(5));return t.isEqual(e)||F(`Document ${n} contains a document reference within a different database (${t.projectId}/${t.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),n}}exports.AbstractUserDataWriter=Jh;class Xh extends Jh{constructor(t){super();
this.firestore=t}convertBytes(t){return new jc(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new mc(this.firestore,null,t)}}class Zh{constructor(t,e){this._firestore=t;this._commitHandler=e;this._mutations=[];this._committed=!1;this._dataReader=eh(t)}set(t,e,n){this._verifyNotCommitted();t=tl(t,this._firestore);e=Yh(t.converter,e,n);n=nh(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n);return this._mutations.push(n.toMutation(t._key,yn.none())),
this}update(t,e,n,...s){this._verifyNotCommitted();t=tl(t,this._firestore);let r;return r="string"==typeof(e=(0,_util.getModularInstance)(e))||e instanceof Gc?hh(this._dataReader,"WriteBatch.update",t._key,e,n,s):ch(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(r.toMutation(t._key,yn.exists(!0))),this}delete(t){this._verifyNotCommitted();t=tl(t,this._firestore);return this._mutations=this._mutations.concat(new Cn(t._key,yn.none())),this}commit(){return this._verifyNotCommitted(),
this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Q(G.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.");}}exports.WriteBatch=Zh;class nl extends Jh{constructor(t){super();this.firestore=t}convertBytes(t){return new jc(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new mc(this.firestore,null,t)}}class ml extends class{constructor(t,
e){this._firestore=t;this._transaction=e;this._dataReader=eh(t)}get(t$jscomp$0){const e=tl(t$jscomp$0,this._firestore),n=new Xh(this._firestore);return this._transaction.lookup([e._key]).then(t=>{if(!t||1!==t.length)return L();t=t[0];if(t.isFoundDocument())return new Th(this._firestore,n,t.key,t,e.converter);if(t.isNoDocument())return new Th(this._firestore,n,e._key,null,e.converter);throw L();})}set(t,e,n){t=tl(t,this._firestore);e=Yh(t.converter,e,n);n=nh(this._dataReader,"Transaction.set",t._key,
e,null!==t.converter,n);return this._transaction.set(t._key,n),this}update(t,e,n,...s){t=tl(t,this._firestore);let r;return r="string"==typeof(e=(0,_util.getModularInstance)(e))||e instanceof Gc?hh(this._dataReader,"Transaction.update",t._key,e,n,s):ch(this._dataReader,"Transaction.update",t._key,e),this._transaction.update(t._key,r),this}delete(t){t=tl(t,this._firestore);return this._transaction.delete(t._key),this}}{constructor(t,e){super(t,e);this._firestore=t}get(t$jscomp$0){const e=tl(t$jscomp$0,
this._firestore),n=new nl(this._firestore);return super.get(t$jscomp$0).then(t=>new Ph(this._firestore,n,e._key,t._document,new Rh(!1,!1),e.converter))}}exports.Transaction=ml;!function(t$jscomp$0,e=!0){x=_app.SDK_VERSION;!0;(0,_app._registerComponent)(new _component.Component("firestore",(t,{options:n})=>{const s=t.getProvider("app").getImmediate();t=new vc(s,new J(t.getProvider("auth-internal")),new tt(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),t._setSettings(n),
t},"PUBLIC"));(0,_app.registerVersion)("@firebase/firestore","3.4.8",t$jscomp$0);(0,_app.registerVersion)("@firebase/firestore","3.4.8","esm2017")}()}
//# sourceMappingURL=module$node_modules$$firebase$firestore$dist$index_esm2017.js.map
