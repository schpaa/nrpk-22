{"version":3,"sources":["booking/access.cljs"],"mappings":"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","names":["booking.access/can-modify?","route","users-access-tokens","vec__125348","cljs.core.nth","_route-status-requires","route-access-requires","cljs.core/seq","clojure.set.intersection","cljs.core/second","p__125351","map__125352","cljs.core/--destructure-map","cljs.core.get","booking.access/build-access-tuple","uid","user","map__125353","waitinglist","admin","godkjent","medlem","booking-godkjent","or__5043__auto__","cljs.core.into","cljs.core.remove","cljs.core/nil?","cljs.test/test-var","booking.access/access","rest__125354#","build-access-tuple","values__11321__auto__","cljs.core/List","result__11322__auto__","cljs.core.apply","cljs.test/report","cljs.core/cons","t__11372__auto__","e125358","e125361","e125363","e125365","e125367","e125369","e125371","e125373","cljs.core/="],"sourcesContent":["(ns booking.access\n  (:require [cljs.test :refer [deftest is are]]\n            [clojure.set :as set]\n            [user.database :refer [lookup-userinfo]]\n            [db.core :as db]))\n\n(defn can-modify? [route users-access-tokens]\n  (let [[_route-status-requires route-access-requires] (-> route :data :modify)]\n    (some? (seq (set/intersection (second users-access-tokens) route-access-requires)))))\n\n(defn build-access-tuple\n  \"looks up :uid and returns a tuple of [status access uid]\"\n  [{:keys [uid] :as user}]\n  (if uid\n    (let [{:keys [waitinglist admin godkjent medlem booking-godkjent]} user]\n      [(cond\n         waitinglist :waitinglist\n         (or admin godkjent medlem booking-godkjent) :member\n         :else :registered)\n       (into #{} (remove nil?\n                         [(when (:admin user) :admin)\n                          (when (:booking-godkjent user) :booking)\n                          (when (:n\u00f8kkelvakt user) :n\u00f8kkelvakt)]))\n       uid])\n    nil))\n\n(deftest access\n  (let [uid \"123\"\n        build-access-tuple #(build-access-tuple (into {:uid uid} %&))]\n    (are [a b] (= a b)\n               nil (booking.access/build-access-tuple {})\n               [:member #{:booking} uid] (build-access-tuple {:booking-godkjent true})\n               ;; with a valid uid:\n               [:registered #{} uid] (build-access-tuple {})\n               [:waitinglist #{} uid] (build-access-tuple {:waitinglist true})\n               [:member #{:admin} uid] (build-access-tuple {:admin true})\n               [:registered #{:n\u00f8kkelvakt} uid] (build-access-tuple {:n\u00f8kkelvakt true})\n               [:registered #{} uid] (build-access-tuple {:n\u00f8kkelvakt false})\n               [:registered #{:n\u00f8kkelvakt} uid] (build-access-tuple {:n\u00f8kkelvakt true}))))\n\n"]}